var Fe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Be=1e-6,Mt=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});function Ue(){var i=new Mt(9);return Mt!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function en(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[4],i[4]=t[5],i[5]=t[6],i[6]=t[8],i[7]=t[9],i[8]=t[10],i}function vr(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i}function rn(i,t){if(i===t){var e=t[1],r=t[2],n=t[5];i[1]=t[3],i[2]=t[6],i[3]=e,i[5]=t[7],i[6]=r,i[7]=n}else i[0]=t[0],i[1]=t[3],i[2]=t[6],i[3]=t[1],i[4]=t[4],i[5]=t[7],i[6]=t[2],i[7]=t[5],i[8]=t[8];return i}function nn(i,t){var e=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],c=t[6],d=t[7],v=t[8],_=v*a-o*d,b=-v*s+o*c,f=d*s-a*c,m=e*_+r*b+n*f;return m?(m=1/m,i[0]=_*m,i[1]=(-v*r+n*d)*m,i[2]=(o*r-n*a)*m,i[3]=b*m,i[4]=(v*e-n*c)*m,i[5]=(-o*e+n*s)*m,i[6]=f*m,i[7]=(-d*e+r*c)*m,i[8]=(a*e-r*s)*m,i):null}function ht(){var i=new Mt(16);return Mt!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function $t(i){var t=new Mt(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t}function ce(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function sn(i,t,e,r,n,s,a,o,c,d,v,_,b,f,m,l){var p=new Mt(16);return p[0]=i,p[1]=t,p[2]=e,p[3]=r,p[4]=n,p[5]=s,p[6]=a,p[7]=o,p[8]=c,p[9]=d,p[10]=v,p[11]=_,p[12]=b,p[13]=f,p[14]=m,p[15]=l,p}function an(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function me(i,t){var e=t[0],r=t[1],n=t[2],s=t[3],a=t[4],o=t[5],c=t[6],d=t[7],v=t[8],_=t[9],b=t[10],f=t[11],m=t[12],l=t[13],p=t[14],g=t[15],x=e*o-r*a,w=e*c-n*a,A=e*d-s*a,R=r*c-n*o,F=r*d-s*o,L=n*d-s*c,j=v*l-_*m,B=v*p-b*m,Q=v*g-f*m,X=_*p-b*l,T=_*g-f*l,U=b*g-f*p,u=x*U-w*T+A*X+R*Q-F*B+L*j;return u?(u=1/u,i[0]=(o*U-c*T+d*X)*u,i[1]=(n*T-r*U-s*X)*u,i[2]=(l*L-p*F+g*R)*u,i[3]=(b*F-_*L-f*R)*u,i[4]=(c*Q-a*U-d*B)*u,i[5]=(e*U-n*Q+s*B)*u,i[6]=(p*A-m*L-g*w)*u,i[7]=(v*L-b*A+f*w)*u,i[8]=(a*T-o*Q+d*j)*u,i[9]=(r*Q-e*T-s*j)*u,i[10]=(m*F-l*A+g*x)*u,i[11]=(_*A-v*F-f*x)*u,i[12]=(o*B-a*X-c*j)*u,i[13]=(e*X-r*B+n*j)*u,i[14]=(l*w-m*R-p*x)*u,i[15]=(v*R-_*w+b*x)*u,i):null}function Lt(i,t,e){var r=t[0],n=t[1],s=t[2],a=t[3],o=t[4],c=t[5],d=t[6],v=t[7],_=t[8],b=t[9],f=t[10],m=t[11],l=t[12],p=t[13],g=t[14],x=t[15],w=e[0],A=e[1],R=e[2],F=e[3];return i[0]=w*r+A*o+R*_+F*l,i[1]=w*n+A*c+R*b+F*p,i[2]=w*s+A*d+R*f+F*g,i[3]=w*a+A*v+R*m+F*x,w=e[4],A=e[5],R=e[6],F=e[7],i[4]=w*r+A*o+R*_+F*l,i[5]=w*n+A*c+R*b+F*p,i[6]=w*s+A*d+R*f+F*g,i[7]=w*a+A*v+R*m+F*x,w=e[8],A=e[9],R=e[10],F=e[11],i[8]=w*r+A*o+R*_+F*l,i[9]=w*n+A*c+R*b+F*p,i[10]=w*s+A*d+R*f+F*g,i[11]=w*a+A*v+R*m+F*x,w=e[12],A=e[13],R=e[14],F=e[15],i[12]=w*r+A*o+R*_+F*l,i[13]=w*n+A*c+R*b+F*p,i[14]=w*s+A*d+R*f+F*g,i[15]=w*a+A*v+R*m+F*x,i}function Ve(i,t,e){var r=e[0],n=e[1],s=e[2],a,o,c,d,v,_,b,f,m,l,p,g;return t===i?(i[12]=t[0]*r+t[4]*n+t[8]*s+t[12],i[13]=t[1]*r+t[5]*n+t[9]*s+t[13],i[14]=t[2]*r+t[6]*n+t[10]*s+t[14],i[15]=t[3]*r+t[7]*n+t[11]*s+t[15]):(a=t[0],o=t[1],c=t[2],d=t[3],v=t[4],_=t[5],b=t[6],f=t[7],m=t[8],l=t[9],p=t[10],g=t[11],i[0]=a,i[1]=o,i[2]=c,i[3]=d,i[4]=v,i[5]=_,i[6]=b,i[7]=f,i[8]=m,i[9]=l,i[10]=p,i[11]=g,i[12]=a*r+v*n+m*s+t[12],i[13]=o*r+_*n+l*s+t[13],i[14]=c*r+b*n+p*s+t[14],i[15]=d*r+f*n+g*s+t[15]),i}function on(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function cn(i,t){var e=Math.sin(t),r=Math.cos(t);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=r,i[6]=e,i[7]=0,i[8]=0,i[9]=-e,i[10]=r,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ln(i,t){var e=t[0],r=t[1],n=t[2],s=t[3],a=e+e,o=r+r,c=n+n,d=e*a,v=r*a,_=r*o,b=n*a,f=n*o,m=n*c,l=s*a,p=s*o,g=s*c;return i[0]=1-_-m,i[1]=v+g,i[2]=b-p,i[3]=0,i[4]=v-g,i[5]=1-d-m,i[6]=f+l,i[7]=0,i[8]=b+p,i[9]=f-l,i[10]=1-d-_,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function un(i,t,e,r){var n,s,a,o,c,d,v,_,b,f,m=t[0],l=t[1],p=t[2],g=r[0],x=r[1],w=r[2],A=e[0],R=e[1],F=e[2];return Math.abs(m-A)<Be&&Math.abs(l-R)<Be&&Math.abs(p-F)<Be?an(i):(v=m-A,_=l-R,b=p-F,f=1/Math.hypot(v,_,b),v*=f,_*=f,b*=f,n=x*b-w*_,s=w*v-g*b,a=g*_-x*v,f=Math.hypot(n,s,a),f?(f=1/f,n*=f,s*=f,a*=f):(n=0,s=0,a=0),o=_*a-b*s,c=b*n-v*a,d=v*s-_*n,f=Math.hypot(o,c,d),f?(f=1/f,o*=f,c*=f,d*=f):(o=0,c=0,d=0),i[0]=n,i[1]=o,i[2]=v,i[3]=0,i[4]=s,i[5]=c,i[6]=_,i[7]=0,i[8]=a,i[9]=d,i[10]=b,i[11]=0,i[12]=-(n*m+s*l+a*p),i[13]=-(o*m+c*l+d*p),i[14]=-(v*m+_*l+b*p),i[15]=1,i)}var br=Lt;function et(){var i=new Mt(3);return Mt!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function St(i){var t=new Mt(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t}function zt(i){var t=i[0],e=i[1],r=i[2];return Math.hypot(t,e,r)}function K(i,t,e){var r=new Mt(3);return r[0]=i,r[1]=t,r[2]=e,r}function le(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i}function ge(i,t,e,r){return i[0]=t,i[1]=e,i[2]=r,i}function dt(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i}function hn(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function zr(i,t,e){return i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.min(t[2],e[2]),i}function Ir(i,t,e){return i[0]=Math.max(t[0],e[0]),i[1]=Math.max(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i}function Ae(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i}function Te(i,t){var e=t[0]-i[0],r=t[1]-i[1],n=t[2]-i[2];return Math.hypot(e,r,n)}function Rr(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i}function wt(i,t){var e=t[0],r=t[1],n=t[2],s=e*e+r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i}function _t(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function Rt(i,t,e){var r=t[0],n=t[1],s=t[2],a=e[0],o=e[1],c=e[2];return i[0]=n*c-s*o,i[1]=s*a-r*c,i[2]=r*o-n*a,i}function Jt(i,t,e){var r=t[0],n=t[1],s=t[2],a=e[3]*r+e[7]*n+e[11]*s+e[15];return a=a||1,i[0]=(e[0]*r+e[4]*n+e[8]*s+e[12])/a,i[1]=(e[1]*r+e[5]*n+e[9]*s+e[13])/a,i[2]=(e[2]*r+e[6]*n+e[10]*s+e[14])/a,i}function Le(i,t){var e=i[0],r=i[1],n=i[2],s=t[0],a=t[1],o=t[2],c=Math.sqrt(e*e+r*r+n*n),d=Math.sqrt(s*s+a*a+o*o),v=c*d,_=v&&_t(i,t)/v;return Math.acos(Math.min(Math.max(_,-1),1))}var Tt=hn,fn=zt;(function(){var i=et();return function(t,e,r,n,s,a){var o,c;for(e||(e=3),r||(r=0),n?c=Math.min(n*e+r,t.length):c=t.length,o=r;o<c;o+=e)i[0]=t[o],i[1]=t[o+1],i[2]=t[o+2],s(i,i,a),t[o]=i[0],t[o+1]=i[1],t[o+2]=i[2];return t}})();function Pr(){var i=new Mt(4);return Mt!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function fe(i,t,e,r){var n=new Mt(4);return n[0]=i,n[1]=t,n[2]=e,n[3]=r,n}function dn(i,t){var e=t[0],r=t[1],n=t[2],s=t[3],a=e*e+r*r+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),i[0]=e*a,i[1]=r*a,i[2]=n*a,i[3]=s*a,i}function mn(i,t,e){var r=t[0],n=t[1],s=t[2],a=t[3];return i[0]=e[0]*r+e[4]*n+e[8]*s+e[12]*a,i[1]=e[1]*r+e[5]*n+e[9]*s+e[13]*a,i[2]=e[2]*r+e[6]*n+e[10]*s+e[14]*a,i[3]=e[3]*r+e[7]*n+e[11]*s+e[15]*a,i}(function(){var i=Pr();return function(t,e,r,n,s,a){var o,c;for(e||(e=4),r||(r=0),n?c=Math.min(n*e+r,t.length):c=t.length,o=r;o<c;o+=e)i[0]=t[o],i[1]=t[o+1],i[2]=t[o+2],i[3]=t[o+3],s(i,i,a),t[o]=i[0],t[o+1]=i[1],t[o+2]=i[2],t[o+3]=i[3];return t}})();function er(){var i=new Mt(4);return Mt!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Fr(i,t,e){e=e*.5;var r=Math.sin(e);return i[0]=r*t[0],i[1]=r*t[1],i[2]=r*t[2],i[3]=Math.cos(e),i}function Ke(i,t,e,r){var n=t[0],s=t[1],a=t[2],o=t[3],c=e[0],d=e[1],v=e[2],_=e[3],b,f,m,l,p;return f=n*c+s*d+a*v+o*_,f<0&&(f=-f,c=-c,d=-d,v=-v,_=-_),1-f>Be?(b=Math.acos(f),m=Math.sin(b),l=Math.sin((1-r)*b)/m,p=Math.sin(r*b)/m):(l=1-r,p=r),i[0]=l*n+p*c,i[1]=l*s+p*d,i[2]=l*a+p*v,i[3]=l*o+p*_,i}function pn(i,t){var e=t[0]+t[4]+t[8],r;if(e>0)r=Math.sqrt(e+1),i[3]=.5*r,r=.5/r,i[0]=(t[5]-t[7])*r,i[1]=(t[6]-t[2])*r,i[2]=(t[1]-t[3])*r;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var s=(n+1)%3,a=(n+2)%3;r=Math.sqrt(t[n*3+n]-t[s*3+s]-t[a*3+a]+1),i[n]=.5*r,r=.5/r,i[3]=(t[s*3+a]-t[a*3+s])*r,i[s]=(t[s*3+n]+t[n*3+s])*r,i[a]=(t[a*3+n]+t[n*3+a])*r}return i}var Lr=dn;(function(){var i=et(),t=K(1,0,0),e=K(0,1,0);return function(r,n,s){var a=_t(n,s);return a<-.999999?(Rt(i,t,n),fn(i)<1e-6&&Rt(i,e,n),wt(i,i),Fr(r,i,Math.PI),r):a>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Rt(i,n,s),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=1+a,Lr(r,r))}})();(function(){var i=er(),t=er();return function(e,r,n,s,a,o){return Ke(i,r,a,o),Ke(t,n,s,o),Ke(e,i,t,2*o*(1-o)),e}})();(function(){var i=Ue();return function(t,e,r,n){return i[0]=r[0],i[3]=r[1],i[6]=r[2],i[1]=n[0],i[4]=n[1],i[7]=n[2],i[2]=-e[0],i[5]=-e[1],i[8]=-e[2],Lr(t,pn(t,i))}})();function ir(){var i=new Mt(2);return Mt!=Float32Array&&(i[0]=0,i[1]=0),i}function Wt(i,t){var e=new Mt(2);return e[0]=i,e[1]=t,e}function Nr(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i}function _n(i){var t=i[0],e=i[1];return Math.hypot(t,e)}function gn(i,t){var e=t[0],r=t[1],n=e*e+r*r;return n>0&&(n=1/Math.sqrt(n)),i[0]=t[0]*n,i[1]=t[1]*n,i}function xr(i,t){return i[0]*t[0]+i[1]*t[1]}(function(){var i=ir();return function(t,e,r,n,s,a){var o,c;for(e||(e=2),r||(r=0),n?c=Math.min(n*e+r,t.length):c=t.length,o=r;o<c;o+=e)i[0]=t[o],i[1]=t[o+1],s(i,i,a),t[o]=i[0],t[o+1]=i[1];return t}})();function Ne(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var tr={exports:{}};var wr;function vn(){return wr||(wr=1,(function(i,t){(function(e){i.exports=e()})(function(){return(function e(r,n,s){function a(d,v){if(!n[d]){if(!r[d]){var _=typeof Ne=="function"&&Ne;if(!v&&_)return _(d,!0);if(o)return o(d,!0);var b=new Error("Cannot find module '"+d+"'");throw b.code="MODULE_NOT_FOUND",b}var f=n[d]={exports:{}};r[d][0].call(f.exports,function(m){var l=r[d][1][m];return a(l||m)},f,f.exports,e,r,n,s)}return n[d].exports}for(var o=typeof Ne=="function"&&Ne,c=0;c<s.length;c++)a(s[c]);return a})({1:[function(e,r,n){var s=e("./utils"),a=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(c){for(var d,v,_,b,f,m,l,p=[],g=0,x=c.length,w=x,A=s.getTypeOf(c)!=="string";g<c.length;)w=x-g,_=A?(d=c[g++],v=g<x?c[g++]:0,g<x?c[g++]:0):(d=c.charCodeAt(g++),v=g<x?c.charCodeAt(g++):0,g<x?c.charCodeAt(g++):0),b=d>>2,f=(3&d)<<4|v>>4,m=1<w?(15&v)<<2|_>>6:64,l=2<w?63&_:64,p.push(o.charAt(b)+o.charAt(f)+o.charAt(m)+o.charAt(l));return p.join("")},n.decode=function(c){var d,v,_,b,f,m,l=0,p=0,g="data:";if(c.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var x,w=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===o.charAt(64)&&w--,c.charAt(c.length-2)===o.charAt(64)&&w--,w%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=a.uint8array?new Uint8Array(0|w):new Array(0|w);l<c.length;)d=o.indexOf(c.charAt(l++))<<2|(b=o.indexOf(c.charAt(l++)))>>4,v=(15&b)<<4|(f=o.indexOf(c.charAt(l++)))>>2,_=(3&f)<<6|(m=o.indexOf(c.charAt(l++))),x[p++]=d,f!==64&&(x[p++]=v),m!==64&&(x[p++]=_);return x}},{"./support":30,"./utils":32}],2:[function(e,r,n){var s=e("./external"),a=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),c=e("./stream/DataLengthProbe");function d(v,_,b,f,m){this.compressedSize=v,this.uncompressedSize=_,this.crc32=b,this.compression=f,this.compressedContent=m}d.prototype={getContentWorker:function(){var v=new a(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),_=this;return v.on("end",function(){if(this.streamInfo.data_length!==_.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),v},getCompressedWorker:function(){return new a(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(v,_,b){return v.pipe(new o).pipe(new c("uncompressedSize")).pipe(_.compressWorker(b)).pipe(new c("compressedSize")).withStreamInfo("compression",_)},r.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,r,n){var s=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,r,n){var s=e("./utils"),a=(function(){for(var o,c=[],d=0;d<256;d++){o=d;for(var v=0;v<8;v++)o=1&o?3988292384^o>>>1:o>>>1;c[d]=o}return c})();r.exports=function(o,c){return o!==void 0&&o.length?s.getTypeOf(o)!=="string"?(function(d,v,_,b){var f=a,m=b+_;d^=-1;for(var l=b;l<m;l++)d=d>>>8^f[255&(d^v[l])];return-1^d})(0|c,o,o.length,0):(function(d,v,_,b){var f=a,m=b+_;d^=-1;for(var l=b;l<m;l++)d=d>>>8^f[255&(d^v.charCodeAt(l))];return-1^d})(0|c,o,o.length,0):0}},{"./utils":32}],5:[function(e,r,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,r,n){var s=null;s=typeof Promise<"u"?Promise:e("lie"),r.exports={Promise:s}},{lie:37}],7:[function(e,r,n){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=e("pako"),o=e("./utils"),c=e("./stream/GenericWorker"),d=s?"uint8array":"array";function v(_,b){c.call(this,"FlateWorker/"+_),this._pako=null,this._pakoAction=_,this._pakoOptions=b,this.meta={}}n.magic="\b\0",o.inherits(v,c),v.prototype.processChunk=function(_){this.meta=_.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(d,_.data),!1)},v.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},v.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},v.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var _=this;this._pako.onData=function(b){_.push({data:b,meta:_.meta})}},n.compressWorker=function(_){return new v("Deflate",_)},n.uncompressWorker=function(){return new v("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,r,n){function s(f,m){var l,p="";for(l=0;l<m;l++)p+=String.fromCharCode(255&f),f>>>=8;return p}function a(f,m,l,p,g,x){var w,A,R=f.file,F=f.compression,L=x!==d.utf8encode,j=o.transformTo("string",x(R.name)),B=o.transformTo("string",d.utf8encode(R.name)),Q=R.comment,X=o.transformTo("string",x(Q)),T=o.transformTo("string",d.utf8encode(Q)),U=B.length!==R.name.length,u=T.length!==Q.length,W="",C="",S="",I=R.dir,P=R.date,N={crc32:0,compressedSize:0,uncompressedSize:0};m&&!l||(N.crc32=f.crc32,N.compressedSize=f.compressedSize,N.uncompressedSize=f.uncompressedSize);var k=0;m&&(k|=8),L||!U&&!u||(k|=2048);var M=0,Z=0;I&&(M|=16),g==="UNIX"?(Z=798,M|=(function(H,ot){var lt=H;return H||(lt=ot?16893:33204),(65535&lt)<<16})(R.unixPermissions,I)):(Z=20,M|=(function(H){return 63&(H||0)})(R.dosPermissions)),w=P.getUTCHours(),w<<=6,w|=P.getUTCMinutes(),w<<=5,w|=P.getUTCSeconds()/2,A=P.getUTCFullYear()-1980,A<<=4,A|=P.getUTCMonth()+1,A<<=5,A|=P.getUTCDate(),U&&(C=s(1,1)+s(v(j),4)+B,W+="up"+s(C.length,2)+C),u&&(S=s(1,1)+s(v(X),4)+T,W+="uc"+s(S.length,2)+S);var $="";return $+=`
\0`,$+=s(k,2),$+=F.magic,$+=s(w,2),$+=s(A,2),$+=s(N.crc32,4),$+=s(N.compressedSize,4),$+=s(N.uncompressedSize,4),$+=s(j.length,2),$+=s(W.length,2),{fileRecord:_.LOCAL_FILE_HEADER+$+j+W,dirRecord:_.CENTRAL_FILE_HEADER+s(Z,2)+$+s(X.length,2)+"\0\0\0\0"+s(M,4)+s(p,4)+j+W+X}}var o=e("../utils"),c=e("../stream/GenericWorker"),d=e("../utf8"),v=e("../crc32"),_=e("../signature");function b(f,m,l,p){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=l,this.encodeFileName=p,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(b,c),b.prototype.push=function(f){var m=f.meta.percent||0,l=this.entriesCount,p=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,c.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:l?(m+100*(l-p-1))/l:100}}))},b.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var m=this.streamFiles&&!f.file.dir;if(m){var l=a(f,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:l.fileRecord,meta:{percent:0}})}else this.accumulate=!0},b.prototype.closedSource=function(f){this.accumulate=!1;var m=this.streamFiles&&!f.file.dir,l=a(f,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(l.dirRecord),m)this.push({data:(function(p){return _.DATA_DESCRIPTOR+s(p.crc32,4)+s(p.compressedSize,4)+s(p.uncompressedSize,4)})(f),meta:{percent:100}});else for(this.push({data:l.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},b.prototype.flush=function(){for(var f=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var l=this.bytesWritten-f,p=(function(g,x,w,A,R){var F=o.transformTo("string",R(A));return _.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(g,2)+s(g,2)+s(x,4)+s(w,4)+s(F.length,2)+F})(this.dirRecords.length,l,f,this.zipComment,this.encodeFileName);this.push({data:p,meta:{percent:100}})},b.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},b.prototype.registerPrevious=function(f){this._sources.push(f);var m=this;return f.on("data",function(l){m.processChunk(l)}),f.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),f.on("error",function(l){m.error(l)}),this},b.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},b.prototype.error=function(f){var m=this._sources;if(!c.prototype.error.call(this,f))return!1;for(var l=0;l<m.length;l++)try{m[l].error(f)}catch{}return!0},b.prototype.lock=function(){c.prototype.lock.call(this);for(var f=this._sources,m=0;m<f.length;m++)f[m].lock()},r.exports=b},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,r,n){var s=e("../compressions"),a=e("./ZipFileWorker");n.generateWorker=function(o,c,d){var v=new a(c.streamFiles,d,c.platform,c.encodeFileName),_=0;try{o.forEach(function(b,f){_++;var m=(function(x,w){var A=x||w,R=s[A];if(!R)throw new Error(A+" is not a valid compression method !");return R})(f.options.compression,c.compression),l=f.options.compressionOptions||c.compressionOptions||{},p=f.dir,g=f.date;f._compressWorker(m,l).withStreamInfo("file",{name:b,dir:p,date:g,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(v)}),v.entriesCount=_}catch(b){v.error(b)}return v}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,r,n){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new s;for(var o in this)typeof this[o]!="function"&&(a[o]=this[o]);return a}}(s.prototype=e("./object")).loadAsync=e("./load"),s.support=e("./support"),s.defaults=e("./defaults"),s.version="3.10.1",s.loadAsync=function(a,o){return new s().loadAsync(a,o)},s.external=e("./external"),r.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,r,n){var s=e("./utils"),a=e("./external"),o=e("./utf8"),c=e("./zipEntries"),d=e("./stream/Crc32Probe"),v=e("./nodejsUtils");function _(b){return new a.Promise(function(f,m){var l=b.decompressed.getContentWorker().pipe(new d);l.on("error",function(p){m(p)}).on("end",function(){l.streamInfo.crc32!==b.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}r.exports=function(b,f){var m=this;return f=s.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),v.isNode&&v.isStream(b)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",b,!0,f.optimizedBinaryString,f.base64).then(function(l){var p=new c(f);return p.load(l),p}).then(function(l){var p=[a.Promise.resolve(l)],g=l.files;if(f.checkCRC32)for(var x=0;x<g.length;x++)p.push(_(g[x]));return a.Promise.all(p)}).then(function(l){for(var p=l.shift(),g=p.files,x=0;x<g.length;x++){var w=g[x],A=w.fileNameStr,R=s.resolve(w.fileNameStr);m.file(R,w.decompressed,{binary:!0,optimizedBinaryString:!0,date:w.date,dir:w.dir,comment:w.fileCommentStr.length?w.fileCommentStr:null,unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions,createFolders:f.createFolders}),w.dir||(m.file(R).unsafeOriginalName=A)}return p.zipComment.length&&(m.comment=p.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,r,n){var s=e("../utils"),a=e("../stream/GenericWorker");function o(c,d){a.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(d)}s.inherits(o,a),o.prototype._bindStream=function(c){var d=this;(this._stream=c).pause(),c.on("data",function(v){d.push({data:v,meta:{percent:0}})}).on("error",function(v){d.isPaused?this.generatedError=v:d.error(v)}).on("end",function(){d.isPaused?d._upstreamEnded=!0:d.end()})},o.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,r,n){var s=e("readable-stream").Readable;function a(o,c,d){s.call(this,c),this._helper=o;var v=this;o.on("data",function(_,b){v.push(_)||v._helper.pause(),d&&d(b)}).on("error",function(_){v.emit("error",_)}).on("end",function(){v.push(null)})}e("../utils").inherits(a,s),a.prototype._read=function(){this._helper.resume()},r.exports=a},{"../utils":32,"readable-stream":16}],14:[function(e,r,n){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,a);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,a)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var a=new Buffer(s);return a.fill(0),a},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(e,r,n){function s(R,F,L){var j,B=o.getTypeOf(F),Q=o.extend(L||{},v);Q.date=Q.date||new Date,Q.compression!==null&&(Q.compression=Q.compression.toUpperCase()),typeof Q.unixPermissions=="string"&&(Q.unixPermissions=parseInt(Q.unixPermissions,8)),Q.unixPermissions&&16384&Q.unixPermissions&&(Q.dir=!0),Q.dosPermissions&&16&Q.dosPermissions&&(Q.dir=!0),Q.dir&&(R=g(R)),Q.createFolders&&(j=p(R))&&x.call(this,j,!0);var X=B==="string"&&Q.binary===!1&&Q.base64===!1;L&&L.binary!==void 0||(Q.binary=!X),(F instanceof _&&F.uncompressedSize===0||Q.dir||!F||F.length===0)&&(Q.base64=!1,Q.binary=!0,F="",Q.compression="STORE",B="string");var T=null;T=F instanceof _||F instanceof c?F:m.isNode&&m.isStream(F)?new l(R,F):o.prepareContent(R,F,Q.binary,Q.optimizedBinaryString,Q.base64);var U=new b(R,T,Q);this.files[R]=U}var a=e("./utf8"),o=e("./utils"),c=e("./stream/GenericWorker"),d=e("./stream/StreamHelper"),v=e("./defaults"),_=e("./compressedObject"),b=e("./zipObject"),f=e("./generate"),m=e("./nodejsUtils"),l=e("./nodejs/NodejsStreamInputAdapter"),p=function(R){R.slice(-1)==="/"&&(R=R.substring(0,R.length-1));var F=R.lastIndexOf("/");return 0<F?R.substring(0,F):""},g=function(R){return R.slice(-1)!=="/"&&(R+="/"),R},x=function(R,F){return F=F!==void 0?F:v.createFolders,R=g(R),this.files[R]||s.call(this,R,null,{dir:!0,createFolders:F}),this.files[R]};function w(R){return Object.prototype.toString.call(R)==="[object RegExp]"}var A={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(R){var F,L,j;for(F in this.files)j=this.files[F],(L=F.slice(this.root.length,F.length))&&F.slice(0,this.root.length)===this.root&&R(L,j)},filter:function(R){var F=[];return this.forEach(function(L,j){R(L,j)&&F.push(j)}),F},file:function(R,F,L){if(arguments.length!==1)return R=this.root+R,s.call(this,R,F,L),this;if(w(R)){var j=R;return this.filter(function(Q,X){return!X.dir&&j.test(Q)})}var B=this.files[this.root+R];return B&&!B.dir?B:null},folder:function(R){if(!R)return this;if(w(R))return this.filter(function(B,Q){return Q.dir&&R.test(B)});var F=this.root+R,L=x.call(this,F),j=this.clone();return j.root=L.name,j},remove:function(R){R=this.root+R;var F=this.files[R];if(F||(R.slice(-1)!=="/"&&(R+="/"),F=this.files[R]),F&&!F.dir)delete this.files[R];else for(var L=this.filter(function(B,Q){return Q.name.slice(0,R.length)===R}),j=0;j<L.length;j++)delete this.files[L[j].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(R){var F,L={};try{if((L=o.extend(R||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=L.type.toLowerCase(),L.compression=L.compression.toUpperCase(),L.type==="binarystring"&&(L.type="string"),!L.type)throw new Error("No output type specified.");o.checkSupport(L.type),L.platform!=="darwin"&&L.platform!=="freebsd"&&L.platform!=="linux"&&L.platform!=="sunos"||(L.platform="UNIX"),L.platform==="win32"&&(L.platform="DOS");var j=L.comment||this.comment||"";F=f.generateWorker(this,L,j)}catch(B){(F=new c("error")).error(B)}return new d(F,L.type||"string",L.mimeType)},generateAsync:function(R,F){return this.generateInternalStream(R).accumulate(F)},generateNodeStream:function(R,F){return(R=R||{}).type||(R.type="nodebuffer"),this.generateInternalStream(R).toNodejsStream(F)}};r.exports=A},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,r,n){r.exports=e("stream")},{stream:void 0}],17:[function(e,r,n){var s=e("./DataReader");function a(o){s.call(this,o);for(var c=0;c<this.data.length;c++)o[c]=255&o[c]}e("../utils").inherits(a,s),a.prototype.byteAt=function(o){return this.data[this.zero+o]},a.prototype.lastIndexOfSignature=function(o){for(var c=o.charCodeAt(0),d=o.charCodeAt(1),v=o.charCodeAt(2),_=o.charCodeAt(3),b=this.length-4;0<=b;--b)if(this.data[b]===c&&this.data[b+1]===d&&this.data[b+2]===v&&this.data[b+3]===_)return b-this.zero;return-1},a.prototype.readAndCheckSignature=function(o){var c=o.charCodeAt(0),d=o.charCodeAt(1),v=o.charCodeAt(2),_=o.charCodeAt(3),b=this.readData(4);return c===b[0]&&d===b[1]&&v===b[2]&&_===b[3]},a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},r.exports=a},{"../utils":32,"./DataReader":18}],18:[function(e,r,n){var s=e("../utils");function a(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var c,d=0;for(this.checkOffset(o),c=this.index+o-1;c>=this.index;c--)d=(d<<8)+this.byteAt(c);return this.index+=o,d},readString:function(o){return s.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},r.exports=a},{"../utils":32}],19:[function(e,r,n){var s=e("./Uint8ArrayReader");function a(o){s.call(this,o)}e("../utils").inherits(a,s),a.prototype.readData=function(o){this.checkOffset(o);var c=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},r.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,r,n){var s=e("./DataReader");function a(o){s.call(this,o)}e("../utils").inherits(a,s),a.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},a.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},a.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},a.prototype.readData=function(o){this.checkOffset(o);var c=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},r.exports=a},{"../utils":32,"./DataReader":18}],21:[function(e,r,n){var s=e("./ArrayReader");function a(o){s.call(this,o)}e("../utils").inherits(a,s),a.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},r.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(e,r,n){var s=e("../utils"),a=e("../support"),o=e("./ArrayReader"),c=e("./StringReader"),d=e("./NodeBufferReader"),v=e("./Uint8ArrayReader");r.exports=function(_){var b=s.getTypeOf(_);return s.checkSupport(b),b!=="string"||a.uint8array?b==="nodebuffer"?new d(_):a.uint8array?new v(s.transformTo("uint8array",_)):new o(s.transformTo("array",_)):new c(_)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,r,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,r,n){var s=e("./GenericWorker"),a=e("../utils");function o(c){s.call(this,"ConvertWorker to "+c),this.destType=c}a.inherits(o,s),o.prototype.processChunk=function(c){this.push({data:a.transformTo(this.destType,c.data),meta:c.meta})},r.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,r,n){var s=e("./GenericWorker"),a=e("../crc32");function o(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,s),o.prototype.processChunk=function(c){this.streamInfo.crc32=a(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,r,n){var s=e("../utils"),a=e("./GenericWorker");function o(c){a.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}s.inherits(o,a),o.prototype.processChunk=function(c){if(c){var d=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=d+c.data.length}a.prototype.processChunk.call(this,c)},r.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,r,n){var s=e("../utils"),a=e("./GenericWorker");function o(c){a.call(this,"DataWorker");var d=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(v){d.dataIsReady=!0,d.data=v,d.max=v&&v.length||0,d.type=s.getTypeOf(v),d.isPaused||d._tickAndRepeat()},function(v){d.error(v)})}s.inherits(o,a),o.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,d=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,d);break;case"uint8array":c=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":c=this.data.slice(this.index,d)}return this.index=d,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,r,n){function s(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,o){return this._listeners[a].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,o){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,o)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var o=this;return a.on("data",function(c){o.processChunk(c)}),a.on("end",function(){o.end()}),a.on("error",function(c){o.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,o){return this.extraStreamInfo[a]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},r.exports=s},{}],29:[function(e,r,n){var s=e("../utils"),a=e("./ConvertWorker"),o=e("./GenericWorker"),c=e("../base64"),d=e("../support"),v=e("../external"),_=null;if(d.nodestream)try{_=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function b(m,l){return new v.Promise(function(p,g){var x=[],w=m._internalType,A=m._outputType,R=m._mimeType;m.on("data",function(F,L){x.push(F),l&&l(L)}).on("error",function(F){x=[],g(F)}).on("end",function(){try{var F=(function(L,j,B){switch(L){case"blob":return s.newBlob(s.transformTo("arraybuffer",j),B);case"base64":return c.encode(j);default:return s.transformTo(L,j)}})(A,(function(L,j){var B,Q=0,X=null,T=0;for(B=0;B<j.length;B++)T+=j[B].length;switch(L){case"string":return j.join("");case"array":return Array.prototype.concat.apply([],j);case"uint8array":for(X=new Uint8Array(T),B=0;B<j.length;B++)X.set(j[B],Q),Q+=j[B].length;return X;case"nodebuffer":return Buffer.concat(j);default:throw new Error("concat : unsupported type '"+L+"'")}})(w,x),R);p(F)}catch(L){g(L)}x=[]}).resume()})}function f(m,l,p){var g=l;switch(l){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=l,this._mimeType=p,s.checkSupport(g),this._worker=m.pipe(new a(g)),m.lock()}catch(x){this._worker=new o("error"),this._worker.error(x)}}f.prototype={accumulate:function(m){return b(this,m)},on:function(m,l){var p=this;return m==="data"?this._worker.on(m,function(g){l.call(p,g.data,g.meta)}):this._worker.on(m,function(){s.delay(l,arguments,p)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new _(this,{objectMode:this._outputType!=="nodebuffer"},m)}},r.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,r,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var s=new ArrayBuffer(0);try{n.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(s),n.blob=a.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!e("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(e,r,n){for(var s=e("./utils"),a=e("./support"),o=e("./nodejsUtils"),c=e("./stream/GenericWorker"),d=new Array(256),v=0;v<256;v++)d[v]=252<=v?6:248<=v?5:240<=v?4:224<=v?3:192<=v?2:1;d[254]=d[254]=1;function _(){c.call(this,"utf-8 decode"),this.leftOver=null}function b(){c.call(this,"utf-8 encode")}n.utf8encode=function(f){return a.nodebuffer?o.newBufferFrom(f,"utf-8"):(function(m){var l,p,g,x,w,A=m.length,R=0;for(x=0;x<A;x++)(64512&(p=m.charCodeAt(x)))==55296&&x+1<A&&(64512&(g=m.charCodeAt(x+1)))==56320&&(p=65536+(p-55296<<10)+(g-56320),x++),R+=p<128?1:p<2048?2:p<65536?3:4;for(l=a.uint8array?new Uint8Array(R):new Array(R),x=w=0;w<R;x++)(64512&(p=m.charCodeAt(x)))==55296&&x+1<A&&(64512&(g=m.charCodeAt(x+1)))==56320&&(p=65536+(p-55296<<10)+(g-56320),x++),p<128?l[w++]=p:(p<2048?l[w++]=192|p>>>6:(p<65536?l[w++]=224|p>>>12:(l[w++]=240|p>>>18,l[w++]=128|p>>>12&63),l[w++]=128|p>>>6&63),l[w++]=128|63&p);return l})(f)},n.utf8decode=function(f){return a.nodebuffer?s.transformTo("nodebuffer",f).toString("utf-8"):(function(m){var l,p,g,x,w=m.length,A=new Array(2*w);for(l=p=0;l<w;)if((g=m[l++])<128)A[p++]=g;else if(4<(x=d[g]))A[p++]=65533,l+=x-1;else{for(g&=x===2?31:x===3?15:7;1<x&&l<w;)g=g<<6|63&m[l++],x--;1<x?A[p++]=65533:g<65536?A[p++]=g:(g-=65536,A[p++]=55296|g>>10&1023,A[p++]=56320|1023&g)}return A.length!==p&&(A.subarray?A=A.subarray(0,p):A.length=p),s.applyFromCharCode(A)})(f=s.transformTo(a.uint8array?"uint8array":"array",f))},s.inherits(_,c),_.prototype.processChunk=function(f){var m=s.transformTo(a.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var l=m;(m=new Uint8Array(l.length+this.leftOver.length)).set(this.leftOver,0),m.set(l,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var p=(function(x,w){var A;for((w=w||x.length)>x.length&&(w=x.length),A=w-1;0<=A&&(192&x[A])==128;)A--;return A<0||A===0?w:A+d[x[A]]>w?A:w})(m),g=m;p!==m.length&&(a.uint8array?(g=m.subarray(0,p),this.leftOver=m.subarray(p,m.length)):(g=m.slice(0,p),this.leftOver=m.slice(p,m.length))),this.push({data:n.utf8decode(g),meta:f.meta})},_.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=_,s.inherits(b,c),b.prototype.processChunk=function(f){this.push({data:n.utf8encode(f.data),meta:f.meta})},n.Utf8EncodeWorker=b},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,r,n){var s=e("./support"),a=e("./base64"),o=e("./nodejsUtils"),c=e("./external");function d(l){return l}function v(l,p){for(var g=0;g<l.length;++g)p[g]=255&l.charCodeAt(g);return p}e("setimmediate"),n.newBlob=function(l,p){n.checkSupport("blob");try{return new Blob([l],{type:p})}catch{try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(l),g.getBlob(p)}catch{throw new Error("Bug : can't construct the Blob.")}}};var _={stringifyByChunk:function(l,p,g){var x=[],w=0,A=l.length;if(A<=g)return String.fromCharCode.apply(null,l);for(;w<A;)p==="array"||p==="nodebuffer"?x.push(String.fromCharCode.apply(null,l.slice(w,Math.min(w+g,A)))):x.push(String.fromCharCode.apply(null,l.subarray(w,Math.min(w+g,A)))),w+=g;return x.join("")},stringifyByChar:function(l){for(var p="",g=0;g<l.length;g++)p+=String.fromCharCode(l[g]);return p},applyCanBeUsed:{uint8array:(function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}})()}};function b(l){var p=65536,g=n.getTypeOf(l),x=!0;if(g==="uint8array"?x=_.applyCanBeUsed.uint8array:g==="nodebuffer"&&(x=_.applyCanBeUsed.nodebuffer),x)for(;1<p;)try{return _.stringifyByChunk(l,g,p)}catch{p=Math.floor(p/2)}return _.stringifyByChar(l)}function f(l,p){for(var g=0;g<l.length;g++)p[g]=l[g];return p}n.applyFromCharCode=b;var m={};m.string={string:d,array:function(l){return v(l,new Array(l.length))},arraybuffer:function(l){return m.string.uint8array(l).buffer},uint8array:function(l){return v(l,new Uint8Array(l.length))},nodebuffer:function(l){return v(l,o.allocBuffer(l.length))}},m.array={string:b,array:d,arraybuffer:function(l){return new Uint8Array(l).buffer},uint8array:function(l){return new Uint8Array(l)},nodebuffer:function(l){return o.newBufferFrom(l)}},m.arraybuffer={string:function(l){return b(new Uint8Array(l))},array:function(l){return f(new Uint8Array(l),new Array(l.byteLength))},arraybuffer:d,uint8array:function(l){return new Uint8Array(l)},nodebuffer:function(l){return o.newBufferFrom(new Uint8Array(l))}},m.uint8array={string:b,array:function(l){return f(l,new Array(l.length))},arraybuffer:function(l){return l.buffer},uint8array:d,nodebuffer:function(l){return o.newBufferFrom(l)}},m.nodebuffer={string:b,array:function(l){return f(l,new Array(l.length))},arraybuffer:function(l){return m.nodebuffer.uint8array(l).buffer},uint8array:function(l){return f(l,new Uint8Array(l.length))},nodebuffer:d},n.transformTo=function(l,p){if(p=p||"",!l)return p;n.checkSupport(l);var g=n.getTypeOf(p);return m[g][l](p)},n.resolve=function(l){for(var p=l.split("/"),g=[],x=0;x<p.length;x++){var w=p[x];w==="."||w===""&&x!==0&&x!==p.length-1||(w===".."?g.pop():g.push(w))}return g.join("/")},n.getTypeOf=function(l){return typeof l=="string"?"string":Object.prototype.toString.call(l)==="[object Array]"?"array":s.nodebuffer&&o.isBuffer(l)?"nodebuffer":s.uint8array&&l instanceof Uint8Array?"uint8array":s.arraybuffer&&l instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(l){if(!s[l.toLowerCase()])throw new Error(l+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(l){var p,g,x="";for(g=0;g<(l||"").length;g++)x+="\\x"+((p=l.charCodeAt(g))<16?"0":"")+p.toString(16).toUpperCase();return x},n.delay=function(l,p,g){setImmediate(function(){l.apply(g||null,p||[])})},n.inherits=function(l,p){function g(){}g.prototype=p.prototype,l.prototype=new g},n.extend=function(){var l,p,g={};for(l=0;l<arguments.length;l++)for(p in arguments[l])Object.prototype.hasOwnProperty.call(arguments[l],p)&&g[p]===void 0&&(g[p]=arguments[l][p]);return g},n.prepareContent=function(l,p,g,x,w){return c.Promise.resolve(p).then(function(A){return s.blob&&(A instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(A))!==-1)&&typeof FileReader<"u"?new c.Promise(function(R,F){var L=new FileReader;L.onload=function(j){R(j.target.result)},L.onerror=function(j){F(j.target.error)},L.readAsArrayBuffer(A)}):A}).then(function(A){var R=n.getTypeOf(A);return R?(R==="arraybuffer"?A=n.transformTo("uint8array",A):R==="string"&&(w?A=a.decode(A):g&&x!==!0&&(A=(function(F){return v(F,s.uint8array?new Uint8Array(F.length):new Array(F.length))})(A))),A):c.Promise.reject(new Error("Can't read the data of '"+l+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,r,n){var s=e("./reader/readerFor"),a=e("./utils"),o=e("./signature"),c=e("./zipEntry"),d=e("./support");function v(_){this.files=[],this.loadOptions=_}v.prototype={checkSignature:function(_){if(!this.reader.readAndCheckSignature(_)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(b)+", expected "+a.pretty(_)+")")}},isSignature:function(_,b){var f=this.reader.index;this.reader.setIndex(_);var m=this.reader.readString(4)===b;return this.reader.setIndex(f),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var _=this.reader.readData(this.zipCommentLength),b=d.uint8array?"uint8array":"array",f=a.transformTo(b,_);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var _,b,f,m=this.zip64EndOfCentralSize-44;0<m;)_=this.reader.readInt(2),b=this.reader.readInt(4),f=this.reader.readData(b),this.zip64ExtensibleData[_]={id:_,length:b,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var _,b;for(_=0;_<this.files.length;_++)b=this.files[_],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var _;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(_=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(_);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var _=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(_<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(_);var b=_;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(_=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(_),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var m=b-f;if(0<m)this.isSignature(b,o.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(_){this.reader=s(_)},load:function(_){this.prepareReader(_),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=v},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,r,n){var s=e("./reader/readerFor"),a=e("./utils"),o=e("./compressedObject"),c=e("./crc32"),d=e("./utf8"),v=e("./compressions"),_=e("./support");function b(f,m){this.options=f,this.loadOptions=m}b.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var m,l;if(f.skip(22),this.fileNameLength=f.readInt(2),l=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(l),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=(function(p){for(var g in v)if(Object.prototype.hasOwnProperty.call(v,g)&&v[g].magic===p)return v[g];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,m,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var m=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(m),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=s(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var m,l,p,g=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<g;)m=f.readInt(2),l=f.readInt(2),p=f.readData(l),this.extraFields[m]={id:m,length:l,value:p};f.setIndex(g)},handleUTF8:function(){var f=_.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=d.utf8decode(this.fileName),this.fileCommentStr=d.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var l=a.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(l)}var p=this.findExtraFieldUnicodeComment();if(p!==null)this.fileCommentStr=p;else{var g=a.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var m=s(f.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:d.utf8decode(m.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var m=s(f.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:d.utf8decode(m.readData(f.length-5))}return null}},r.exports=b},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,r,n){function s(m,l,p){this.name=m,this.dir=p.dir,this.date=p.date,this.comment=p.comment,this.unixPermissions=p.unixPermissions,this.dosPermissions=p.dosPermissions,this._data=l,this._dataBinary=p.binary,this.options={compression:p.compression,compressionOptions:p.compressionOptions}}var a=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),c=e("./utf8"),d=e("./compressedObject"),v=e("./stream/GenericWorker");s.prototype={internalStream:function(m){var l=null,p="string";try{if(!m)throw new Error("No output type specified.");var g=(p=m.toLowerCase())==="string"||p==="text";p!=="binarystring"&&p!=="text"||(p="string"),l=this._decompressWorker();var x=!this._dataBinary;x&&!g&&(l=l.pipe(new c.Utf8EncodeWorker)),!x&&g&&(l=l.pipe(new c.Utf8DecodeWorker))}catch(w){(l=new v("error")).error(w)}return new a(l,p,"")},async:function(m,l){return this.internalStream(m).accumulate(l)},nodeStream:function(m,l){return this.internalStream(m||"nodebuffer").toNodejsStream(l)},_compressWorker:function(m,l){if(this._data instanceof d&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var p=this._decompressWorker();return this._dataBinary||(p=p.pipe(new c.Utf8EncodeWorker)),d.createWorkerFrom(p,m,l)},_decompressWorker:function(){return this._data instanceof d?this._data.getContentWorker():this._data instanceof v?this._data:new o(this._data)}};for(var _=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],b=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<_.length;f++)s.prototype[_[f]]=b;r.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,r,n){(function(s){var a,o,c=s.MutationObserver||s.WebKitMutationObserver;if(c){var d=0,v=new c(m),_=s.document.createTextNode("");v.observe(_,{characterData:!0}),a=function(){_.data=d=++d%2}}else if(s.setImmediate||s.MessageChannel===void 0)a="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var l=s.document.createElement("script");l.onreadystatechange=function(){m(),l.onreadystatechange=null,l.parentNode.removeChild(l),l=null},s.document.documentElement.appendChild(l)}:function(){setTimeout(m,0)};else{var b=new s.MessageChannel;b.port1.onmessage=m,a=function(){b.port2.postMessage(0)}}var f=[];function m(){var l,p;o=!0;for(var g=f.length;g;){for(p=f,f=[],l=-1;++l<g;)p[l]();g=f.length}o=!1}r.exports=function(l){f.push(l)!==1||o||a()}}).call(this,typeof Fe<"u"?Fe:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,r,n){var s=e("immediate");function a(){}var o={},c=["REJECTED"],d=["FULFILLED"],v=["PENDING"];function _(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=v,this.queue=[],this.outcome=void 0,g!==a&&l(this,g)}function b(g,x,w){this.promise=g,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}function f(g,x,w){s(function(){var A;try{A=x(w)}catch(R){return o.reject(g,R)}A===g?o.reject(g,new TypeError("Cannot resolve promise with itself")):o.resolve(g,A)})}function m(g){var x=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof x=="function")return function(){x.apply(g,arguments)}}function l(g,x){var w=!1;function A(L){w||(w=!0,o.reject(g,L))}function R(L){w||(w=!0,o.resolve(g,L))}var F=p(function(){x(R,A)});F.status==="error"&&A(F.value)}function p(g,x){var w={};try{w.value=g(x),w.status="success"}catch(A){w.status="error",w.value=A}return w}(r.exports=_).prototype.finally=function(g){if(typeof g!="function")return this;var x=this.constructor;return this.then(function(w){return x.resolve(g()).then(function(){return w})},function(w){return x.resolve(g()).then(function(){throw w})})},_.prototype.catch=function(g){return this.then(null,g)},_.prototype.then=function(g,x){if(typeof g!="function"&&this.state===d||typeof x!="function"&&this.state===c)return this;var w=new this.constructor(a);return this.state!==v?f(w,this.state===d?g:x,this.outcome):this.queue.push(new b(w,g,x)),w},b.prototype.callFulfilled=function(g){o.resolve(this.promise,g)},b.prototype.otherCallFulfilled=function(g){f(this.promise,this.onFulfilled,g)},b.prototype.callRejected=function(g){o.reject(this.promise,g)},b.prototype.otherCallRejected=function(g){f(this.promise,this.onRejected,g)},o.resolve=function(g,x){var w=p(m,x);if(w.status==="error")return o.reject(g,w.value);var A=w.value;if(A)l(g,A);else{g.state=d,g.outcome=x;for(var R=-1,F=g.queue.length;++R<F;)g.queue[R].callFulfilled(x)}return g},o.reject=function(g,x){g.state=c,g.outcome=x;for(var w=-1,A=g.queue.length;++w<A;)g.queue[w].callRejected(x);return g},_.resolve=function(g){return g instanceof this?g:o.resolve(new this(a),g)},_.reject=function(g){var x=new this(a);return o.reject(x,g)},_.all=function(g){var x=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=g.length,A=!1;if(!w)return this.resolve([]);for(var R=new Array(w),F=0,L=-1,j=new this(a);++L<w;)B(g[L],L);return j;function B(Q,X){x.resolve(Q).then(function(T){R[X]=T,++F!==w||A||(A=!0,o.resolve(j,R))},function(T){A||(A=!0,o.reject(j,T))})}},_.race=function(g){var x=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=g.length,A=!1;if(!w)return this.resolve([]);for(var R=-1,F=new this(a);++R<w;)L=g[R],x.resolve(L).then(function(j){A||(A=!0,o.resolve(F,j))},function(j){A||(A=!0,o.reject(F,j))});var L;return F}},{immediate:36}],38:[function(e,r,n){var s={};(0,e("./lib/utils/common").assign)(s,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),r.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,r,n){var s=e("./zlib/deflate"),a=e("./utils/common"),o=e("./utils/strings"),c=e("./zlib/messages"),d=e("./zlib/zstream"),v=Object.prototype.toString,_=0,b=-1,f=0,m=8;function l(g){if(!(this instanceof l))return new l(g);this.options=a.assign({level:b,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},g||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var w=s.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(w!==_)throw new Error(c[w]);if(x.header&&s.deflateSetHeader(this.strm,x.header),x.dictionary){var A;if(A=typeof x.dictionary=="string"?o.string2buf(x.dictionary):v.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(w=s.deflateSetDictionary(this.strm,A))!==_)throw new Error(c[w]);this._dict_set=!0}}function p(g,x){var w=new l(x);if(w.push(g,!0),w.err)throw w.msg||c[w.err];return w.result}l.prototype.push=function(g,x){var w,A,R=this.strm,F=this.options.chunkSize;if(this.ended)return!1;A=x===~~x?x:x===!0?4:0,typeof g=="string"?R.input=o.string2buf(g):v.call(g)==="[object ArrayBuffer]"?R.input=new Uint8Array(g):R.input=g,R.next_in=0,R.avail_in=R.input.length;do{if(R.avail_out===0&&(R.output=new a.Buf8(F),R.next_out=0,R.avail_out=F),(w=s.deflate(R,A))!==1&&w!==_)return this.onEnd(w),!(this.ended=!0);R.avail_out!==0&&(R.avail_in!==0||A!==4&&A!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(a.shrinkBuf(R.output,R.next_out))):this.onData(a.shrinkBuf(R.output,R.next_out)))}while((0<R.avail_in||R.avail_out===0)&&w!==1);return A===4?(w=s.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===_):A!==2||(this.onEnd(_),!(R.avail_out=0))},l.prototype.onData=function(g){this.chunks.push(g)},l.prototype.onEnd=function(g){g===_&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},n.Deflate=l,n.deflate=p,n.deflateRaw=function(g,x){return(x=x||{}).raw=!0,p(g,x)},n.gzip=function(g,x){return(x=x||{}).gzip=!0,p(g,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,r,n){var s=e("./zlib/inflate"),a=e("./utils/common"),o=e("./utils/strings"),c=e("./zlib/constants"),d=e("./zlib/messages"),v=e("./zlib/zstream"),_=e("./zlib/gzheader"),b=Object.prototype.toString;function f(l){if(!(this instanceof f))return new f(l);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},l||{});var p=this.options;p.raw&&0<=p.windowBits&&p.windowBits<16&&(p.windowBits=-p.windowBits,p.windowBits===0&&(p.windowBits=-15)),!(0<=p.windowBits&&p.windowBits<16)||l&&l.windowBits||(p.windowBits+=32),15<p.windowBits&&p.windowBits<48&&(15&p.windowBits)==0&&(p.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var g=s.inflateInit2(this.strm,p.windowBits);if(g!==c.Z_OK)throw new Error(d[g]);this.header=new _,s.inflateGetHeader(this.strm,this.header)}function m(l,p){var g=new f(p);if(g.push(l,!0),g.err)throw g.msg||d[g.err];return g.result}f.prototype.push=function(l,p){var g,x,w,A,R,F,L=this.strm,j=this.options.chunkSize,B=this.options.dictionary,Q=!1;if(this.ended)return!1;x=p===~~p?p:p===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof l=="string"?L.input=o.binstring2buf(l):b.call(l)==="[object ArrayBuffer]"?L.input=new Uint8Array(l):L.input=l,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new a.Buf8(j),L.next_out=0,L.avail_out=j),(g=s.inflate(L,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&B&&(F=typeof B=="string"?o.string2buf(B):b.call(B)==="[object ArrayBuffer]"?new Uint8Array(B):B,g=s.inflateSetDictionary(this.strm,F)),g===c.Z_BUF_ERROR&&Q===!0&&(g=c.Z_OK,Q=!1),g!==c.Z_STREAM_END&&g!==c.Z_OK)return this.onEnd(g),!(this.ended=!0);L.next_out&&(L.avail_out!==0&&g!==c.Z_STREAM_END&&(L.avail_in!==0||x!==c.Z_FINISH&&x!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(w=o.utf8border(L.output,L.next_out),A=L.next_out-w,R=o.buf2string(L.output,w),L.next_out=A,L.avail_out=j-A,A&&a.arraySet(L.output,L.output,w,A,0),this.onData(R)):this.onData(a.shrinkBuf(L.output,L.next_out)))),L.avail_in===0&&L.avail_out===0&&(Q=!0)}while((0<L.avail_in||L.avail_out===0)&&g!==c.Z_STREAM_END);return g===c.Z_STREAM_END&&(x=c.Z_FINISH),x===c.Z_FINISH?(g=s.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===c.Z_OK):x!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(L.avail_out=0))},f.prototype.onData=function(l){this.chunks.push(l)},f.prototype.onEnd=function(l){l===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg},n.Inflate=f,n.inflate=m,n.inflateRaw=function(l,p){return(p=p||{}).raw=!0,m(l,p)},n.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,r,n){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(c){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var v=d.shift();if(v){if(typeof v!="object")throw new TypeError(v+"must be non-object");for(var _ in v)v.hasOwnProperty(_)&&(c[_]=v[_])}}return c},n.shrinkBuf=function(c,d){return c.length===d?c:c.subarray?c.subarray(0,d):(c.length=d,c)};var a={arraySet:function(c,d,v,_,b){if(d.subarray&&c.subarray)c.set(d.subarray(v,v+_),b);else for(var f=0;f<_;f++)c[b+f]=d[v+f]},flattenChunks:function(c){var d,v,_,b,f,m;for(d=_=0,v=c.length;d<v;d++)_+=c[d].length;for(m=new Uint8Array(_),d=b=0,v=c.length;d<v;d++)f=c[d],m.set(f,b),b+=f.length;return m}},o={arraySet:function(c,d,v,_,b){for(var f=0;f<_;f++)c[b+f]=d[v+f]},flattenChunks:function(c){return[].concat.apply([],c)}};n.setTyped=function(c){c?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,a)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(s)},{}],42:[function(e,r,n){var s=e("./common"),a=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var c=new s.Buf8(256),d=0;d<256;d++)c[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;function v(_,b){if(b<65537&&(_.subarray&&o||!_.subarray&&a))return String.fromCharCode.apply(null,s.shrinkBuf(_,b));for(var f="",m=0;m<b;m++)f+=String.fromCharCode(_[m]);return f}c[254]=c[254]=1,n.string2buf=function(_){var b,f,m,l,p,g=_.length,x=0;for(l=0;l<g;l++)(64512&(f=_.charCodeAt(l)))==55296&&l+1<g&&(64512&(m=_.charCodeAt(l+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),l++),x+=f<128?1:f<2048?2:f<65536?3:4;for(b=new s.Buf8(x),l=p=0;p<x;l++)(64512&(f=_.charCodeAt(l)))==55296&&l+1<g&&(64512&(m=_.charCodeAt(l+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),l++),f<128?b[p++]=f:(f<2048?b[p++]=192|f>>>6:(f<65536?b[p++]=224|f>>>12:(b[p++]=240|f>>>18,b[p++]=128|f>>>12&63),b[p++]=128|f>>>6&63),b[p++]=128|63&f);return b},n.buf2binstring=function(_){return v(_,_.length)},n.binstring2buf=function(_){for(var b=new s.Buf8(_.length),f=0,m=b.length;f<m;f++)b[f]=_.charCodeAt(f);return b},n.buf2string=function(_,b){var f,m,l,p,g=b||_.length,x=new Array(2*g);for(f=m=0;f<g;)if((l=_[f++])<128)x[m++]=l;else if(4<(p=c[l]))x[m++]=65533,f+=p-1;else{for(l&=p===2?31:p===3?15:7;1<p&&f<g;)l=l<<6|63&_[f++],p--;1<p?x[m++]=65533:l<65536?x[m++]=l:(l-=65536,x[m++]=55296|l>>10&1023,x[m++]=56320|1023&l)}return v(x,m)},n.utf8border=function(_,b){var f;for((b=b||_.length)>_.length&&(b=_.length),f=b-1;0<=f&&(192&_[f])==128;)f--;return f<0||f===0?b:f+c[_[f]]>b?f:b}},{"./common":41}],43:[function(e,r,n){r.exports=function(s,a,o,c){for(var d=65535&s|0,v=s>>>16&65535|0,_=0;o!==0;){for(o-=_=2e3<o?2e3:o;v=v+(d=d+a[c++]|0)|0,--_;);d%=65521,v%=65521}return d|v<<16|0}},{}],44:[function(e,r,n){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,r,n){var s=(function(){for(var a,o=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;o[c]=a}return o})();r.exports=function(a,o,c,d){var v=s,_=d+c;a^=-1;for(var b=d;b<_;b++)a=a>>>8^v[255&(a^o[b])];return-1^a}},{}],46:[function(e,r,n){var s,a=e("../utils/common"),o=e("./trees"),c=e("./adler32"),d=e("./crc32"),v=e("./messages"),_=0,b=4,f=0,m=-2,l=-1,p=4,g=2,x=8,w=9,A=286,R=30,F=19,L=2*A+1,j=15,B=3,Q=258,X=Q+B+1,T=42,U=113,u=1,W=2,C=3,S=4;function I(h,G){return h.msg=v[G],G}function P(h){return(h<<1)-(4<h?9:0)}function N(h){for(var G=h.length;0<=--G;)h[G]=0}function k(h){var G=h.state,D=G.pending;D>h.avail_out&&(D=h.avail_out),D!==0&&(a.arraySet(h.output,G.pending_buf,G.pending_out,D,h.next_out),h.next_out+=D,G.pending_out+=D,h.total_out+=D,h.avail_out-=D,G.pending-=D,G.pending===0&&(G.pending_out=0))}function M(h,G){o._tr_flush_block(h,0<=h.block_start?h.block_start:-1,h.strstart-h.block_start,G),h.block_start=h.strstart,k(h.strm)}function Z(h,G){h.pending_buf[h.pending++]=G}function $(h,G){h.pending_buf[h.pending++]=G>>>8&255,h.pending_buf[h.pending++]=255&G}function H(h,G){var D,z,E=h.max_chain_length,O=h.strstart,q=h.prev_length,J=h.nice_match,V=h.strstart>h.w_size-X?h.strstart-(h.w_size-X):0,Y=h.window,rt=h.w_mask,tt=h.prev,st=h.strstart+Q,bt=Y[O+q-1],ft=Y[O+q];h.prev_length>=h.good_match&&(E>>=2),J>h.lookahead&&(J=h.lookahead);do if(Y[(D=G)+q]===ft&&Y[D+q-1]===bt&&Y[D]===Y[O]&&Y[++D]===Y[O+1]){O+=2,D++;do;while(Y[++O]===Y[++D]&&Y[++O]===Y[++D]&&Y[++O]===Y[++D]&&Y[++O]===Y[++D]&&Y[++O]===Y[++D]&&Y[++O]===Y[++D]&&Y[++O]===Y[++D]&&Y[++O]===Y[++D]&&O<st);if(z=Q-(st-O),O=st-Q,q<z){if(h.match_start=G,J<=(q=z))break;bt=Y[O+q-1],ft=Y[O+q]}}while((G=tt[G&rt])>V&&--E!=0);return q<=h.lookahead?q:h.lookahead}function ot(h){var G,D,z,E,O,q,J,V,Y,rt,tt=h.w_size;do{if(E=h.window_size-h.lookahead-h.strstart,h.strstart>=tt+(tt-X)){for(a.arraySet(h.window,h.window,tt,tt,0),h.match_start-=tt,h.strstart-=tt,h.block_start-=tt,G=D=h.hash_size;z=h.head[--G],h.head[G]=tt<=z?z-tt:0,--D;);for(G=D=tt;z=h.prev[--G],h.prev[G]=tt<=z?z-tt:0,--D;);E+=tt}if(h.strm.avail_in===0)break;if(q=h.strm,J=h.window,V=h.strstart+h.lookahead,Y=E,rt=void 0,rt=q.avail_in,Y<rt&&(rt=Y),D=rt===0?0:(q.avail_in-=rt,a.arraySet(J,q.input,q.next_in,rt,V),q.state.wrap===1?q.adler=c(q.adler,J,rt,V):q.state.wrap===2&&(q.adler=d(q.adler,J,rt,V)),q.next_in+=rt,q.total_in+=rt,rt),h.lookahead+=D,h.lookahead+h.insert>=B)for(O=h.strstart-h.insert,h.ins_h=h.window[O],h.ins_h=(h.ins_h<<h.hash_shift^h.window[O+1])&h.hash_mask;h.insert&&(h.ins_h=(h.ins_h<<h.hash_shift^h.window[O+B-1])&h.hash_mask,h.prev[O&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=O,O++,h.insert--,!(h.lookahead+h.insert<B)););}while(h.lookahead<X&&h.strm.avail_in!==0)}function lt(h,G){for(var D,z;;){if(h.lookahead<X){if(ot(h),h.lookahead<X&&G===_)return u;if(h.lookahead===0)break}if(D=0,h.lookahead>=B&&(h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+B-1])&h.hash_mask,D=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),D!==0&&h.strstart-D<=h.w_size-X&&(h.match_length=H(h,D)),h.match_length>=B)if(z=o._tr_tally(h,h.strstart-h.match_start,h.match_length-B),h.lookahead-=h.match_length,h.match_length<=h.max_lazy_match&&h.lookahead>=B){for(h.match_length--;h.strstart++,h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+B-1])&h.hash_mask,D=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart,--h.match_length!=0;);h.strstart++}else h.strstart+=h.match_length,h.match_length=0,h.ins_h=h.window[h.strstart],h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+1])&h.hash_mask;else z=o._tr_tally(h,0,h.window[h.strstart]),h.lookahead--,h.strstart++;if(z&&(M(h,!1),h.strm.avail_out===0))return u}return h.insert=h.strstart<B-1?h.strstart:B-1,G===b?(M(h,!0),h.strm.avail_out===0?C:S):h.last_lit&&(M(h,!1),h.strm.avail_out===0)?u:W}function nt(h,G){for(var D,z,E;;){if(h.lookahead<X){if(ot(h),h.lookahead<X&&G===_)return u;if(h.lookahead===0)break}if(D=0,h.lookahead>=B&&(h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+B-1])&h.hash_mask,D=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),h.prev_length=h.match_length,h.prev_match=h.match_start,h.match_length=B-1,D!==0&&h.prev_length<h.max_lazy_match&&h.strstart-D<=h.w_size-X&&(h.match_length=H(h,D),h.match_length<=5&&(h.strategy===1||h.match_length===B&&4096<h.strstart-h.match_start)&&(h.match_length=B-1)),h.prev_length>=B&&h.match_length<=h.prev_length){for(E=h.strstart+h.lookahead-B,z=o._tr_tally(h,h.strstart-1-h.prev_match,h.prev_length-B),h.lookahead-=h.prev_length-1,h.prev_length-=2;++h.strstart<=E&&(h.ins_h=(h.ins_h<<h.hash_shift^h.window[h.strstart+B-1])&h.hash_mask,D=h.prev[h.strstart&h.w_mask]=h.head[h.ins_h],h.head[h.ins_h]=h.strstart),--h.prev_length!=0;);if(h.match_available=0,h.match_length=B-1,h.strstart++,z&&(M(h,!1),h.strm.avail_out===0))return u}else if(h.match_available){if((z=o._tr_tally(h,0,h.window[h.strstart-1]))&&M(h,!1),h.strstart++,h.lookahead--,h.strm.avail_out===0)return u}else h.match_available=1,h.strstart++,h.lookahead--}return h.match_available&&(z=o._tr_tally(h,0,h.window[h.strstart-1]),h.match_available=0),h.insert=h.strstart<B-1?h.strstart:B-1,G===b?(M(h,!0),h.strm.avail_out===0?C:S):h.last_lit&&(M(h,!1),h.strm.avail_out===0)?u:W}function at(h,G,D,z,E){this.good_length=h,this.max_lazy=G,this.nice_length=D,this.max_chain=z,this.func=E}function ct(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*L),this.dyn_dtree=new a.Buf16(2*(2*R+1)),this.bl_tree=new a.Buf16(2*(2*F+1)),N(this.dyn_ltree),N(this.dyn_dtree),N(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(j+1),this.heap=new a.Buf16(2*A+1),N(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*A+1),N(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function gt(h){var G;return h&&h.state?(h.total_in=h.total_out=0,h.data_type=g,(G=h.state).pending=0,G.pending_out=0,G.wrap<0&&(G.wrap=-G.wrap),G.status=G.wrap?T:U,h.adler=G.wrap===2?0:1,G.last_flush=_,o._tr_init(G),f):I(h,m)}function Ft(h){var G=gt(h);return G===f&&(function(D){D.window_size=2*D.w_size,N(D.head),D.max_lazy_match=s[D.level].max_lazy,D.good_match=s[D.level].good_length,D.nice_match=s[D.level].nice_length,D.max_chain_length=s[D.level].max_chain,D.strstart=0,D.block_start=0,D.lookahead=0,D.insert=0,D.match_length=D.prev_length=B-1,D.match_available=0,D.ins_h=0})(h.state),G}function Dt(h,G,D,z,E,O){if(!h)return m;var q=1;if(G===l&&(G=6),z<0?(q=0,z=-z):15<z&&(q=2,z-=16),E<1||w<E||D!==x||z<8||15<z||G<0||9<G||O<0||p<O)return I(h,m);z===8&&(z=9);var J=new ct;return(h.state=J).strm=h,J.wrap=q,J.gzhead=null,J.w_bits=z,J.w_size=1<<J.w_bits,J.w_mask=J.w_size-1,J.hash_bits=E+7,J.hash_size=1<<J.hash_bits,J.hash_mask=J.hash_size-1,J.hash_shift=~~((J.hash_bits+B-1)/B),J.window=new a.Buf8(2*J.w_size),J.head=new a.Buf16(J.hash_size),J.prev=new a.Buf16(J.w_size),J.lit_bufsize=1<<E+6,J.pending_buf_size=4*J.lit_bufsize,J.pending_buf=new a.Buf8(J.pending_buf_size),J.d_buf=1*J.lit_bufsize,J.l_buf=3*J.lit_bufsize,J.level=G,J.strategy=O,J.method=D,Ft(h)}s=[new at(0,0,0,0,function(h,G){var D=65535;for(D>h.pending_buf_size-5&&(D=h.pending_buf_size-5);;){if(h.lookahead<=1){if(ot(h),h.lookahead===0&&G===_)return u;if(h.lookahead===0)break}h.strstart+=h.lookahead,h.lookahead=0;var z=h.block_start+D;if((h.strstart===0||h.strstart>=z)&&(h.lookahead=h.strstart-z,h.strstart=z,M(h,!1),h.strm.avail_out===0)||h.strstart-h.block_start>=h.w_size-X&&(M(h,!1),h.strm.avail_out===0))return u}return h.insert=0,G===b?(M(h,!0),h.strm.avail_out===0?C:S):(h.strstart>h.block_start&&(M(h,!1),h.strm.avail_out),u)}),new at(4,4,8,4,lt),new at(4,5,16,8,lt),new at(4,6,32,32,lt),new at(4,4,16,16,nt),new at(8,16,32,32,nt),new at(8,16,128,128,nt),new at(8,32,128,256,nt),new at(32,128,258,1024,nt),new at(32,258,258,4096,nt)],n.deflateInit=function(h,G){return Dt(h,G,x,15,8,0)},n.deflateInit2=Dt,n.deflateReset=Ft,n.deflateResetKeep=gt,n.deflateSetHeader=function(h,G){return h&&h.state?h.state.wrap!==2?m:(h.state.gzhead=G,f):m},n.deflate=function(h,G){var D,z,E,O;if(!h||!h.state||5<G||G<0)return h?I(h,m):m;if(z=h.state,!h.output||!h.input&&h.avail_in!==0||z.status===666&&G!==b)return I(h,h.avail_out===0?-5:m);if(z.strm=h,D=z.last_flush,z.last_flush=G,z.status===T)if(z.wrap===2)h.adler=0,Z(z,31),Z(z,139),Z(z,8),z.gzhead?(Z(z,(z.gzhead.text?1:0)+(z.gzhead.hcrc?2:0)+(z.gzhead.extra?4:0)+(z.gzhead.name?8:0)+(z.gzhead.comment?16:0)),Z(z,255&z.gzhead.time),Z(z,z.gzhead.time>>8&255),Z(z,z.gzhead.time>>16&255),Z(z,z.gzhead.time>>24&255),Z(z,z.level===9?2:2<=z.strategy||z.level<2?4:0),Z(z,255&z.gzhead.os),z.gzhead.extra&&z.gzhead.extra.length&&(Z(z,255&z.gzhead.extra.length),Z(z,z.gzhead.extra.length>>8&255)),z.gzhead.hcrc&&(h.adler=d(h.adler,z.pending_buf,z.pending,0)),z.gzindex=0,z.status=69):(Z(z,0),Z(z,0),Z(z,0),Z(z,0),Z(z,0),Z(z,z.level===9?2:2<=z.strategy||z.level<2?4:0),Z(z,3),z.status=U);else{var q=x+(z.w_bits-8<<4)<<8;q|=(2<=z.strategy||z.level<2?0:z.level<6?1:z.level===6?2:3)<<6,z.strstart!==0&&(q|=32),q+=31-q%31,z.status=U,$(z,q),z.strstart!==0&&($(z,h.adler>>>16),$(z,65535&h.adler)),h.adler=1}if(z.status===69)if(z.gzhead.extra){for(E=z.pending;z.gzindex<(65535&z.gzhead.extra.length)&&(z.pending!==z.pending_buf_size||(z.gzhead.hcrc&&z.pending>E&&(h.adler=d(h.adler,z.pending_buf,z.pending-E,E)),k(h),E=z.pending,z.pending!==z.pending_buf_size));)Z(z,255&z.gzhead.extra[z.gzindex]),z.gzindex++;z.gzhead.hcrc&&z.pending>E&&(h.adler=d(h.adler,z.pending_buf,z.pending-E,E)),z.gzindex===z.gzhead.extra.length&&(z.gzindex=0,z.status=73)}else z.status=73;if(z.status===73)if(z.gzhead.name){E=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>E&&(h.adler=d(h.adler,z.pending_buf,z.pending-E,E)),k(h),E=z.pending,z.pending===z.pending_buf_size)){O=1;break}O=z.gzindex<z.gzhead.name.length?255&z.gzhead.name.charCodeAt(z.gzindex++):0,Z(z,O)}while(O!==0);z.gzhead.hcrc&&z.pending>E&&(h.adler=d(h.adler,z.pending_buf,z.pending-E,E)),O===0&&(z.gzindex=0,z.status=91)}else z.status=91;if(z.status===91)if(z.gzhead.comment){E=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>E&&(h.adler=d(h.adler,z.pending_buf,z.pending-E,E)),k(h),E=z.pending,z.pending===z.pending_buf_size)){O=1;break}O=z.gzindex<z.gzhead.comment.length?255&z.gzhead.comment.charCodeAt(z.gzindex++):0,Z(z,O)}while(O!==0);z.gzhead.hcrc&&z.pending>E&&(h.adler=d(h.adler,z.pending_buf,z.pending-E,E)),O===0&&(z.status=103)}else z.status=103;if(z.status===103&&(z.gzhead.hcrc?(z.pending+2>z.pending_buf_size&&k(h),z.pending+2<=z.pending_buf_size&&(Z(z,255&h.adler),Z(z,h.adler>>8&255),h.adler=0,z.status=U)):z.status=U),z.pending!==0){if(k(h),h.avail_out===0)return z.last_flush=-1,f}else if(h.avail_in===0&&P(G)<=P(D)&&G!==b)return I(h,-5);if(z.status===666&&h.avail_in!==0)return I(h,-5);if(h.avail_in!==0||z.lookahead!==0||G!==_&&z.status!==666){var J=z.strategy===2?(function(V,Y){for(var rt;;){if(V.lookahead===0&&(ot(V),V.lookahead===0)){if(Y===_)return u;break}if(V.match_length=0,rt=o._tr_tally(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++,rt&&(M(V,!1),V.strm.avail_out===0))return u}return V.insert=0,Y===b?(M(V,!0),V.strm.avail_out===0?C:S):V.last_lit&&(M(V,!1),V.strm.avail_out===0)?u:W})(z,G):z.strategy===3?(function(V,Y){for(var rt,tt,st,bt,ft=V.window;;){if(V.lookahead<=Q){if(ot(V),V.lookahead<=Q&&Y===_)return u;if(V.lookahead===0)break}if(V.match_length=0,V.lookahead>=B&&0<V.strstart&&(tt=ft[st=V.strstart-1])===ft[++st]&&tt===ft[++st]&&tt===ft[++st]){bt=V.strstart+Q;do;while(tt===ft[++st]&&tt===ft[++st]&&tt===ft[++st]&&tt===ft[++st]&&tt===ft[++st]&&tt===ft[++st]&&tt===ft[++st]&&tt===ft[++st]&&st<bt);V.match_length=Q-(bt-st),V.match_length>V.lookahead&&(V.match_length=V.lookahead)}if(V.match_length>=B?(rt=o._tr_tally(V,1,V.match_length-B),V.lookahead-=V.match_length,V.strstart+=V.match_length,V.match_length=0):(rt=o._tr_tally(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++),rt&&(M(V,!1),V.strm.avail_out===0))return u}return V.insert=0,Y===b?(M(V,!0),V.strm.avail_out===0?C:S):V.last_lit&&(M(V,!1),V.strm.avail_out===0)?u:W})(z,G):s[z.level].func(z,G);if(J!==C&&J!==S||(z.status=666),J===u||J===C)return h.avail_out===0&&(z.last_flush=-1),f;if(J===W&&(G===1?o._tr_align(z):G!==5&&(o._tr_stored_block(z,0,0,!1),G===3&&(N(z.head),z.lookahead===0&&(z.strstart=0,z.block_start=0,z.insert=0))),k(h),h.avail_out===0))return z.last_flush=-1,f}return G!==b?f:z.wrap<=0?1:(z.wrap===2?(Z(z,255&h.adler),Z(z,h.adler>>8&255),Z(z,h.adler>>16&255),Z(z,h.adler>>24&255),Z(z,255&h.total_in),Z(z,h.total_in>>8&255),Z(z,h.total_in>>16&255),Z(z,h.total_in>>24&255)):($(z,h.adler>>>16),$(z,65535&h.adler)),k(h),0<z.wrap&&(z.wrap=-z.wrap),z.pending!==0?f:1)},n.deflateEnd=function(h){var G;return h&&h.state?(G=h.state.status)!==T&&G!==69&&G!==73&&G!==91&&G!==103&&G!==U&&G!==666?I(h,m):(h.state=null,G===U?I(h,-3):f):m},n.deflateSetDictionary=function(h,G){var D,z,E,O,q,J,V,Y,rt=G.length;if(!h||!h.state||(O=(D=h.state).wrap)===2||O===1&&D.status!==T||D.lookahead)return m;for(O===1&&(h.adler=c(h.adler,G,rt,0)),D.wrap=0,rt>=D.w_size&&(O===0&&(N(D.head),D.strstart=0,D.block_start=0,D.insert=0),Y=new a.Buf8(D.w_size),a.arraySet(Y,G,rt-D.w_size,D.w_size,0),G=Y,rt=D.w_size),q=h.avail_in,J=h.next_in,V=h.input,h.avail_in=rt,h.next_in=0,h.input=G,ot(D);D.lookahead>=B;){for(z=D.strstart,E=D.lookahead-(B-1);D.ins_h=(D.ins_h<<D.hash_shift^D.window[z+B-1])&D.hash_mask,D.prev[z&D.w_mask]=D.head[D.ins_h],D.head[D.ins_h]=z,z++,--E;);D.strstart=z,D.lookahead=B-1,ot(D)}return D.strstart+=D.lookahead,D.block_start=D.strstart,D.insert=D.lookahead,D.lookahead=0,D.match_length=D.prev_length=B-1,D.match_available=0,h.next_in=J,h.input=V,h.avail_in=q,D.wrap=O,f},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,r,n){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,r,n){r.exports=function(s,a){var o,c,d,v,_,b,f,m,l,p,g,x,w,A,R,F,L,j,B,Q,X,T,U,u,W;o=s.state,c=s.next_in,u=s.input,d=c+(s.avail_in-5),v=s.next_out,W=s.output,_=v-(a-s.avail_out),b=v+(s.avail_out-257),f=o.dmax,m=o.wsize,l=o.whave,p=o.wnext,g=o.window,x=o.hold,w=o.bits,A=o.lencode,R=o.distcode,F=(1<<o.lenbits)-1,L=(1<<o.distbits)-1;t:do{w<15&&(x+=u[c++]<<w,w+=8,x+=u[c++]<<w,w+=8),j=A[x&F];e:for(;;){if(x>>>=B=j>>>24,w-=B,(B=j>>>16&255)===0)W[v++]=65535&j;else{if(!(16&B)){if((64&B)==0){j=A[(65535&j)+(x&(1<<B)-1)];continue e}if(32&B){o.mode=12;break t}s.msg="invalid literal/length code",o.mode=30;break t}Q=65535&j,(B&=15)&&(w<B&&(x+=u[c++]<<w,w+=8),Q+=x&(1<<B)-1,x>>>=B,w-=B),w<15&&(x+=u[c++]<<w,w+=8,x+=u[c++]<<w,w+=8),j=R[x&L];r:for(;;){if(x>>>=B=j>>>24,w-=B,!(16&(B=j>>>16&255))){if((64&B)==0){j=R[(65535&j)+(x&(1<<B)-1)];continue r}s.msg="invalid distance code",o.mode=30;break t}if(X=65535&j,w<(B&=15)&&(x+=u[c++]<<w,(w+=8)<B&&(x+=u[c++]<<w,w+=8)),f<(X+=x&(1<<B)-1)){s.msg="invalid distance too far back",o.mode=30;break t}if(x>>>=B,w-=B,(B=v-_)<X){if(l<(B=X-B)&&o.sane){s.msg="invalid distance too far back",o.mode=30;break t}if(U=g,(T=0)===p){if(T+=m-B,B<Q){for(Q-=B;W[v++]=g[T++],--B;);T=v-X,U=W}}else if(p<B){if(T+=m+p-B,(B-=p)<Q){for(Q-=B;W[v++]=g[T++],--B;);if(T=0,p<Q){for(Q-=B=p;W[v++]=g[T++],--B;);T=v-X,U=W}}}else if(T+=p-B,B<Q){for(Q-=B;W[v++]=g[T++],--B;);T=v-X,U=W}for(;2<Q;)W[v++]=U[T++],W[v++]=U[T++],W[v++]=U[T++],Q-=3;Q&&(W[v++]=U[T++],1<Q&&(W[v++]=U[T++]))}else{for(T=v-X;W[v++]=W[T++],W[v++]=W[T++],W[v++]=W[T++],2<(Q-=3););Q&&(W[v++]=W[T++],1<Q&&(W[v++]=W[T++]))}break}}break}}while(c<d&&v<b);c-=Q=w>>3,x&=(1<<(w-=Q<<3))-1,s.next_in=c,s.next_out=v,s.avail_in=c<d?d-c+5:5-(c-d),s.avail_out=v<b?b-v+257:257-(v-b),o.hold=x,o.bits=w}},{}],49:[function(e,r,n){var s=e("../utils/common"),a=e("./adler32"),o=e("./crc32"),c=e("./inffast"),d=e("./inftrees"),v=1,_=2,b=0,f=-2,m=1,l=852,p=592;function g(T){return(T>>>24&255)+(T>>>8&65280)+((65280&T)<<8)+((255&T)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(T){var U;return T&&T.state?(U=T.state,T.total_in=T.total_out=U.total=0,T.msg="",U.wrap&&(T.adler=1&U.wrap),U.mode=m,U.last=0,U.havedict=0,U.dmax=32768,U.head=null,U.hold=0,U.bits=0,U.lencode=U.lendyn=new s.Buf32(l),U.distcode=U.distdyn=new s.Buf32(p),U.sane=1,U.back=-1,b):f}function A(T){var U;return T&&T.state?((U=T.state).wsize=0,U.whave=0,U.wnext=0,w(T)):f}function R(T,U){var u,W;return T&&T.state?(W=T.state,U<0?(u=0,U=-U):(u=1+(U>>4),U<48&&(U&=15)),U&&(U<8||15<U)?f:(W.window!==null&&W.wbits!==U&&(W.window=null),W.wrap=u,W.wbits=U,A(T))):f}function F(T,U){var u,W;return T?(W=new x,(T.state=W).window=null,(u=R(T,U))!==b&&(T.state=null),u):f}var L,j,B=!0;function Q(T){if(B){var U;for(L=new s.Buf32(512),j=new s.Buf32(32),U=0;U<144;)T.lens[U++]=8;for(;U<256;)T.lens[U++]=9;for(;U<280;)T.lens[U++]=7;for(;U<288;)T.lens[U++]=8;for(d(v,T.lens,0,288,L,0,T.work,{bits:9}),U=0;U<32;)T.lens[U++]=5;d(_,T.lens,0,32,j,0,T.work,{bits:5}),B=!1}T.lencode=L,T.lenbits=9,T.distcode=j,T.distbits=5}function X(T,U,u,W){var C,S=T.state;return S.window===null&&(S.wsize=1<<S.wbits,S.wnext=0,S.whave=0,S.window=new s.Buf8(S.wsize)),W>=S.wsize?(s.arraySet(S.window,U,u-S.wsize,S.wsize,0),S.wnext=0,S.whave=S.wsize):(W<(C=S.wsize-S.wnext)&&(C=W),s.arraySet(S.window,U,u-W,C,S.wnext),(W-=C)?(s.arraySet(S.window,U,u-W,W,0),S.wnext=W,S.whave=S.wsize):(S.wnext+=C,S.wnext===S.wsize&&(S.wnext=0),S.whave<S.wsize&&(S.whave+=C))),0}n.inflateReset=A,n.inflateReset2=R,n.inflateResetKeep=w,n.inflateInit=function(T){return F(T,15)},n.inflateInit2=F,n.inflate=function(T,U){var u,W,C,S,I,P,N,k,M,Z,$,H,ot,lt,nt,at,ct,gt,Ft,Dt,h,G,D,z,E=0,O=new s.Buf8(4),q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!T||!T.state||!T.output||!T.input&&T.avail_in!==0)return f;(u=T.state).mode===12&&(u.mode=13),I=T.next_out,C=T.output,N=T.avail_out,S=T.next_in,W=T.input,P=T.avail_in,k=u.hold,M=u.bits,Z=P,$=N,G=b;t:for(;;)switch(u.mode){case m:if(u.wrap===0){u.mode=13;break}for(;M<16;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}if(2&u.wrap&&k===35615){O[u.check=0]=255&k,O[1]=k>>>8&255,u.check=o(u.check,O,2,0),M=k=0,u.mode=2;break}if(u.flags=0,u.head&&(u.head.done=!1),!(1&u.wrap)||(((255&k)<<8)+(k>>8))%31){T.msg="incorrect header check",u.mode=30;break}if((15&k)!=8){T.msg="unknown compression method",u.mode=30;break}if(M-=4,h=8+(15&(k>>>=4)),u.wbits===0)u.wbits=h;else if(h>u.wbits){T.msg="invalid window size",u.mode=30;break}u.dmax=1<<h,T.adler=u.check=1,u.mode=512&k?10:12,M=k=0;break;case 2:for(;M<16;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}if(u.flags=k,(255&u.flags)!=8){T.msg="unknown compression method",u.mode=30;break}if(57344&u.flags){T.msg="unknown header flags set",u.mode=30;break}u.head&&(u.head.text=k>>8&1),512&u.flags&&(O[0]=255&k,O[1]=k>>>8&255,u.check=o(u.check,O,2,0)),M=k=0,u.mode=3;case 3:for(;M<32;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}u.head&&(u.head.time=k),512&u.flags&&(O[0]=255&k,O[1]=k>>>8&255,O[2]=k>>>16&255,O[3]=k>>>24&255,u.check=o(u.check,O,4,0)),M=k=0,u.mode=4;case 4:for(;M<16;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}u.head&&(u.head.xflags=255&k,u.head.os=k>>8),512&u.flags&&(O[0]=255&k,O[1]=k>>>8&255,u.check=o(u.check,O,2,0)),M=k=0,u.mode=5;case 5:if(1024&u.flags){for(;M<16;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}u.length=k,u.head&&(u.head.extra_len=k),512&u.flags&&(O[0]=255&k,O[1]=k>>>8&255,u.check=o(u.check,O,2,0)),M=k=0}else u.head&&(u.head.extra=null);u.mode=6;case 6:if(1024&u.flags&&(P<(H=u.length)&&(H=P),H&&(u.head&&(h=u.head.extra_len-u.length,u.head.extra||(u.head.extra=new Array(u.head.extra_len)),s.arraySet(u.head.extra,W,S,H,h)),512&u.flags&&(u.check=o(u.check,W,H,S)),P-=H,S+=H,u.length-=H),u.length))break t;u.length=0,u.mode=7;case 7:if(2048&u.flags){if(P===0)break t;for(H=0;h=W[S+H++],u.head&&h&&u.length<65536&&(u.head.name+=String.fromCharCode(h)),h&&H<P;);if(512&u.flags&&(u.check=o(u.check,W,H,S)),P-=H,S+=H,h)break t}else u.head&&(u.head.name=null);u.length=0,u.mode=8;case 8:if(4096&u.flags){if(P===0)break t;for(H=0;h=W[S+H++],u.head&&h&&u.length<65536&&(u.head.comment+=String.fromCharCode(h)),h&&H<P;);if(512&u.flags&&(u.check=o(u.check,W,H,S)),P-=H,S+=H,h)break t}else u.head&&(u.head.comment=null);u.mode=9;case 9:if(512&u.flags){for(;M<16;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}if(k!==(65535&u.check)){T.msg="header crc mismatch",u.mode=30;break}M=k=0}u.head&&(u.head.hcrc=u.flags>>9&1,u.head.done=!0),T.adler=u.check=0,u.mode=12;break;case 10:for(;M<32;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}T.adler=u.check=g(k),M=k=0,u.mode=11;case 11:if(u.havedict===0)return T.next_out=I,T.avail_out=N,T.next_in=S,T.avail_in=P,u.hold=k,u.bits=M,2;T.adler=u.check=1,u.mode=12;case 12:if(U===5||U===6)break t;case 13:if(u.last){k>>>=7&M,M-=7&M,u.mode=27;break}for(;M<3;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}switch(u.last=1&k,M-=1,3&(k>>>=1)){case 0:u.mode=14;break;case 1:if(Q(u),u.mode=20,U!==6)break;k>>>=2,M-=2;break t;case 2:u.mode=17;break;case 3:T.msg="invalid block type",u.mode=30}k>>>=2,M-=2;break;case 14:for(k>>>=7&M,M-=7&M;M<32;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}if((65535&k)!=(k>>>16^65535)){T.msg="invalid stored block lengths",u.mode=30;break}if(u.length=65535&k,M=k=0,u.mode=15,U===6)break t;case 15:u.mode=16;case 16:if(H=u.length){if(P<H&&(H=P),N<H&&(H=N),H===0)break t;s.arraySet(C,W,S,H,I),P-=H,S+=H,N-=H,I+=H,u.length-=H;break}u.mode=12;break;case 17:for(;M<14;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}if(u.nlen=257+(31&k),k>>>=5,M-=5,u.ndist=1+(31&k),k>>>=5,M-=5,u.ncode=4+(15&k),k>>>=4,M-=4,286<u.nlen||30<u.ndist){T.msg="too many length or distance symbols",u.mode=30;break}u.have=0,u.mode=18;case 18:for(;u.have<u.ncode;){for(;M<3;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}u.lens[q[u.have++]]=7&k,k>>>=3,M-=3}for(;u.have<19;)u.lens[q[u.have++]]=0;if(u.lencode=u.lendyn,u.lenbits=7,D={bits:u.lenbits},G=d(0,u.lens,0,19,u.lencode,0,u.work,D),u.lenbits=D.bits,G){T.msg="invalid code lengths set",u.mode=30;break}u.have=0,u.mode=19;case 19:for(;u.have<u.nlen+u.ndist;){for(;at=(E=u.lencode[k&(1<<u.lenbits)-1])>>>16&255,ct=65535&E,!((nt=E>>>24)<=M);){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}if(ct<16)k>>>=nt,M-=nt,u.lens[u.have++]=ct;else{if(ct===16){for(z=nt+2;M<z;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}if(k>>>=nt,M-=nt,u.have===0){T.msg="invalid bit length repeat",u.mode=30;break}h=u.lens[u.have-1],H=3+(3&k),k>>>=2,M-=2}else if(ct===17){for(z=nt+3;M<z;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}M-=nt,h=0,H=3+(7&(k>>>=nt)),k>>>=3,M-=3}else{for(z=nt+7;M<z;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}M-=nt,h=0,H=11+(127&(k>>>=nt)),k>>>=7,M-=7}if(u.have+H>u.nlen+u.ndist){T.msg="invalid bit length repeat",u.mode=30;break}for(;H--;)u.lens[u.have++]=h}}if(u.mode===30)break;if(u.lens[256]===0){T.msg="invalid code -- missing end-of-block",u.mode=30;break}if(u.lenbits=9,D={bits:u.lenbits},G=d(v,u.lens,0,u.nlen,u.lencode,0,u.work,D),u.lenbits=D.bits,G){T.msg="invalid literal/lengths set",u.mode=30;break}if(u.distbits=6,u.distcode=u.distdyn,D={bits:u.distbits},G=d(_,u.lens,u.nlen,u.ndist,u.distcode,0,u.work,D),u.distbits=D.bits,G){T.msg="invalid distances set",u.mode=30;break}if(u.mode=20,U===6)break t;case 20:u.mode=21;case 21:if(6<=P&&258<=N){T.next_out=I,T.avail_out=N,T.next_in=S,T.avail_in=P,u.hold=k,u.bits=M,c(T,$),I=T.next_out,C=T.output,N=T.avail_out,S=T.next_in,W=T.input,P=T.avail_in,k=u.hold,M=u.bits,u.mode===12&&(u.back=-1);break}for(u.back=0;at=(E=u.lencode[k&(1<<u.lenbits)-1])>>>16&255,ct=65535&E,!((nt=E>>>24)<=M);){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}if(at&&(240&at)==0){for(gt=nt,Ft=at,Dt=ct;at=(E=u.lencode[Dt+((k&(1<<gt+Ft)-1)>>gt)])>>>16&255,ct=65535&E,!(gt+(nt=E>>>24)<=M);){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}k>>>=gt,M-=gt,u.back+=gt}if(k>>>=nt,M-=nt,u.back+=nt,u.length=ct,at===0){u.mode=26;break}if(32&at){u.back=-1,u.mode=12;break}if(64&at){T.msg="invalid literal/length code",u.mode=30;break}u.extra=15&at,u.mode=22;case 22:if(u.extra){for(z=u.extra;M<z;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}u.length+=k&(1<<u.extra)-1,k>>>=u.extra,M-=u.extra,u.back+=u.extra}u.was=u.length,u.mode=23;case 23:for(;at=(E=u.distcode[k&(1<<u.distbits)-1])>>>16&255,ct=65535&E,!((nt=E>>>24)<=M);){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}if((240&at)==0){for(gt=nt,Ft=at,Dt=ct;at=(E=u.distcode[Dt+((k&(1<<gt+Ft)-1)>>gt)])>>>16&255,ct=65535&E,!(gt+(nt=E>>>24)<=M);){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}k>>>=gt,M-=gt,u.back+=gt}if(k>>>=nt,M-=nt,u.back+=nt,64&at){T.msg="invalid distance code",u.mode=30;break}u.offset=ct,u.extra=15&at,u.mode=24;case 24:if(u.extra){for(z=u.extra;M<z;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}u.offset+=k&(1<<u.extra)-1,k>>>=u.extra,M-=u.extra,u.back+=u.extra}if(u.offset>u.dmax){T.msg="invalid distance too far back",u.mode=30;break}u.mode=25;case 25:if(N===0)break t;if(H=$-N,u.offset>H){if((H=u.offset-H)>u.whave&&u.sane){T.msg="invalid distance too far back",u.mode=30;break}ot=H>u.wnext?(H-=u.wnext,u.wsize-H):u.wnext-H,H>u.length&&(H=u.length),lt=u.window}else lt=C,ot=I-u.offset,H=u.length;for(N<H&&(H=N),N-=H,u.length-=H;C[I++]=lt[ot++],--H;);u.length===0&&(u.mode=21);break;case 26:if(N===0)break t;C[I++]=u.length,N--,u.mode=21;break;case 27:if(u.wrap){for(;M<32;){if(P===0)break t;P--,k|=W[S++]<<M,M+=8}if($-=N,T.total_out+=$,u.total+=$,$&&(T.adler=u.check=u.flags?o(u.check,C,$,I-$):a(u.check,C,$,I-$)),$=N,(u.flags?k:g(k))!==u.check){T.msg="incorrect data check",u.mode=30;break}M=k=0}u.mode=28;case 28:if(u.wrap&&u.flags){for(;M<32;){if(P===0)break t;P--,k+=W[S++]<<M,M+=8}if(k!==(4294967295&u.total)){T.msg="incorrect length check",u.mode=30;break}M=k=0}u.mode=29;case 29:G=1;break t;case 30:G=-3;break t;case 31:return-4;case 32:default:return f}return T.next_out=I,T.avail_out=N,T.next_in=S,T.avail_in=P,u.hold=k,u.bits=M,(u.wsize||$!==T.avail_out&&u.mode<30&&(u.mode<27||U!==4))&&X(T,T.output,T.next_out,$-T.avail_out)?(u.mode=31,-4):(Z-=T.avail_in,$-=T.avail_out,T.total_in+=Z,T.total_out+=$,u.total+=$,u.wrap&&$&&(T.adler=u.check=u.flags?o(u.check,C,$,T.next_out-$):a(u.check,C,$,T.next_out-$)),T.data_type=u.bits+(u.last?64:0)+(u.mode===12?128:0)+(u.mode===20||u.mode===15?256:0),(Z==0&&$===0||U===4)&&G===b&&(G=-5),G)},n.inflateEnd=function(T){if(!T||!T.state)return f;var U=T.state;return U.window&&(U.window=null),T.state=null,b},n.inflateGetHeader=function(T,U){var u;return T&&T.state?(2&(u=T.state).wrap)==0?f:((u.head=U).done=!1,b):f},n.inflateSetDictionary=function(T,U){var u,W=U.length;return T&&T.state?(u=T.state).wrap!==0&&u.mode!==11?f:u.mode===11&&a(1,U,W,0)!==u.check?-3:X(T,U,W,W)?(u.mode=31,-4):(u.havedict=1,b):f},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,r,n){var s=e("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(v,_,b,f,m,l,p,g){var x,w,A,R,F,L,j,B,Q,X=g.bits,T=0,U=0,u=0,W=0,C=0,S=0,I=0,P=0,N=0,k=0,M=null,Z=0,$=new s.Buf16(16),H=new s.Buf16(16),ot=null,lt=0;for(T=0;T<=15;T++)$[T]=0;for(U=0;U<f;U++)$[_[b+U]]++;for(C=X,W=15;1<=W&&$[W]===0;W--);if(W<C&&(C=W),W===0)return m[l++]=20971520,m[l++]=20971520,g.bits=1,0;for(u=1;u<W&&$[u]===0;u++);for(C<u&&(C=u),T=P=1;T<=15;T++)if(P<<=1,(P-=$[T])<0)return-1;if(0<P&&(v===0||W!==1))return-1;for(H[1]=0,T=1;T<15;T++)H[T+1]=H[T]+$[T];for(U=0;U<f;U++)_[b+U]!==0&&(p[H[_[b+U]]++]=U);if(L=v===0?(M=ot=p,19):v===1?(M=a,Z-=257,ot=o,lt-=257,256):(M=c,ot=d,-1),T=u,F=l,I=U=k=0,A=-1,R=(N=1<<(S=C))-1,v===1&&852<N||v===2&&592<N)return 1;for(;;){for(j=T-I,Q=p[U]<L?(B=0,p[U]):p[U]>L?(B=ot[lt+p[U]],M[Z+p[U]]):(B=96,0),x=1<<T-I,u=w=1<<S;m[F+(k>>I)+(w-=x)]=j<<24|B<<16|Q|0,w!==0;);for(x=1<<T-1;k&x;)x>>=1;if(x!==0?(k&=x-1,k+=x):k=0,U++,--$[T]==0){if(T===W)break;T=_[b+p[U]]}if(C<T&&(k&R)!==A){for(I===0&&(I=C),F+=u,P=1<<(S=T-I);S+I<W&&!((P-=$[S+I])<=0);)S++,P<<=1;if(N+=1<<S,v===1&&852<N||v===2&&592<N)return 1;m[A=k&R]=C<<24|S<<16|F-l|0}}return k!==0&&(m[F+k]=T-I<<24|64<<16|0),g.bits=C,0}},{"../utils/common":41}],51:[function(e,r,n){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,r,n){var s=e("../utils/common"),a=0,o=1;function c(E){for(var O=E.length;0<=--O;)E[O]=0}var d=0,v=29,_=256,b=_+1+v,f=30,m=19,l=2*b+1,p=15,g=16,x=7,w=256,A=16,R=17,F=18,L=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],j=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],X=new Array(2*(b+2));c(X);var T=new Array(2*f);c(T);var U=new Array(512);c(U);var u=new Array(256);c(u);var W=new Array(v);c(W);var C,S,I,P=new Array(f);function N(E,O,q,J,V){this.static_tree=E,this.extra_bits=O,this.extra_base=q,this.elems=J,this.max_length=V,this.has_stree=E&&E.length}function k(E,O){this.dyn_tree=E,this.max_code=0,this.stat_desc=O}function M(E){return E<256?U[E]:U[256+(E>>>7)]}function Z(E,O){E.pending_buf[E.pending++]=255&O,E.pending_buf[E.pending++]=O>>>8&255}function $(E,O,q){E.bi_valid>g-q?(E.bi_buf|=O<<E.bi_valid&65535,Z(E,E.bi_buf),E.bi_buf=O>>g-E.bi_valid,E.bi_valid+=q-g):(E.bi_buf|=O<<E.bi_valid&65535,E.bi_valid+=q)}function H(E,O,q){$(E,q[2*O],q[2*O+1])}function ot(E,O){for(var q=0;q|=1&E,E>>>=1,q<<=1,0<--O;);return q>>>1}function lt(E,O,q){var J,V,Y=new Array(p+1),rt=0;for(J=1;J<=p;J++)Y[J]=rt=rt+q[J-1]<<1;for(V=0;V<=O;V++){var tt=E[2*V+1];tt!==0&&(E[2*V]=ot(Y[tt]++,tt))}}function nt(E){var O;for(O=0;O<b;O++)E.dyn_ltree[2*O]=0;for(O=0;O<f;O++)E.dyn_dtree[2*O]=0;for(O=0;O<m;O++)E.bl_tree[2*O]=0;E.dyn_ltree[2*w]=1,E.opt_len=E.static_len=0,E.last_lit=E.matches=0}function at(E){8<E.bi_valid?Z(E,E.bi_buf):0<E.bi_valid&&(E.pending_buf[E.pending++]=E.bi_buf),E.bi_buf=0,E.bi_valid=0}function ct(E,O,q,J){var V=2*O,Y=2*q;return E[V]<E[Y]||E[V]===E[Y]&&J[O]<=J[q]}function gt(E,O,q){for(var J=E.heap[q],V=q<<1;V<=E.heap_len&&(V<E.heap_len&&ct(O,E.heap[V+1],E.heap[V],E.depth)&&V++,!ct(O,J,E.heap[V],E.depth));)E.heap[q]=E.heap[V],q=V,V<<=1;E.heap[q]=J}function Ft(E,O,q){var J,V,Y,rt,tt=0;if(E.last_lit!==0)for(;J=E.pending_buf[E.d_buf+2*tt]<<8|E.pending_buf[E.d_buf+2*tt+1],V=E.pending_buf[E.l_buf+tt],tt++,J===0?H(E,V,O):(H(E,(Y=u[V])+_+1,O),(rt=L[Y])!==0&&$(E,V-=W[Y],rt),H(E,Y=M(--J),q),(rt=j[Y])!==0&&$(E,J-=P[Y],rt)),tt<E.last_lit;);H(E,w,O)}function Dt(E,O){var q,J,V,Y=O.dyn_tree,rt=O.stat_desc.static_tree,tt=O.stat_desc.has_stree,st=O.stat_desc.elems,bt=-1;for(E.heap_len=0,E.heap_max=l,q=0;q<st;q++)Y[2*q]!==0?(E.heap[++E.heap_len]=bt=q,E.depth[q]=0):Y[2*q+1]=0;for(;E.heap_len<2;)Y[2*(V=E.heap[++E.heap_len]=bt<2?++bt:0)]=1,E.depth[V]=0,E.opt_len--,tt&&(E.static_len-=rt[2*V+1]);for(O.max_code=bt,q=E.heap_len>>1;1<=q;q--)gt(E,Y,q);for(V=st;q=E.heap[1],E.heap[1]=E.heap[E.heap_len--],gt(E,Y,1),J=E.heap[1],E.heap[--E.heap_max]=q,E.heap[--E.heap_max]=J,Y[2*V]=Y[2*q]+Y[2*J],E.depth[V]=(E.depth[q]>=E.depth[J]?E.depth[q]:E.depth[J])+1,Y[2*q+1]=Y[2*J+1]=V,E.heap[1]=V++,gt(E,Y,1),2<=E.heap_len;);E.heap[--E.heap_max]=E.heap[1],(function(ft,Qt){var ye,qt,Ce,Et,Re,Ye,ne=Qt.dyn_tree,_r=Qt.max_code,Yr=Qt.stat_desc.static_tree,Kr=Qt.stat_desc.has_stree,tn=Qt.stat_desc.extra_bits,gr=Qt.stat_desc.extra_base,Ee=Qt.stat_desc.max_length,Pe=0;for(Et=0;Et<=p;Et++)ft.bl_count[Et]=0;for(ne[2*ft.heap[ft.heap_max]+1]=0,ye=ft.heap_max+1;ye<l;ye++)Ee<(Et=ne[2*ne[2*(qt=ft.heap[ye])+1]+1]+1)&&(Et=Ee,Pe++),ne[2*qt+1]=Et,_r<qt||(ft.bl_count[Et]++,Re=0,gr<=qt&&(Re=tn[qt-gr]),Ye=ne[2*qt],ft.opt_len+=Ye*(Et+Re),Kr&&(ft.static_len+=Ye*(Yr[2*qt+1]+Re)));if(Pe!==0){do{for(Et=Ee-1;ft.bl_count[Et]===0;)Et--;ft.bl_count[Et]--,ft.bl_count[Et+1]+=2,ft.bl_count[Ee]--,Pe-=2}while(0<Pe);for(Et=Ee;Et!==0;Et--)for(qt=ft.bl_count[Et];qt!==0;)_r<(Ce=ft.heap[--ye])||(ne[2*Ce+1]!==Et&&(ft.opt_len+=(Et-ne[2*Ce+1])*ne[2*Ce],ne[2*Ce+1]=Et),qt--)}})(E,O),lt(Y,bt,E.bl_count)}function h(E,O,q){var J,V,Y=-1,rt=O[1],tt=0,st=7,bt=4;for(rt===0&&(st=138,bt=3),O[2*(q+1)+1]=65535,J=0;J<=q;J++)V=rt,rt=O[2*(J+1)+1],++tt<st&&V===rt||(tt<bt?E.bl_tree[2*V]+=tt:V!==0?(V!==Y&&E.bl_tree[2*V]++,E.bl_tree[2*A]++):tt<=10?E.bl_tree[2*R]++:E.bl_tree[2*F]++,Y=V,bt=(tt=0)===rt?(st=138,3):V===rt?(st=6,3):(st=7,4))}function G(E,O,q){var J,V,Y=-1,rt=O[1],tt=0,st=7,bt=4;for(rt===0&&(st=138,bt=3),J=0;J<=q;J++)if(V=rt,rt=O[2*(J+1)+1],!(++tt<st&&V===rt)){if(tt<bt)for(;H(E,V,E.bl_tree),--tt!=0;);else V!==0?(V!==Y&&(H(E,V,E.bl_tree),tt--),H(E,A,E.bl_tree),$(E,tt-3,2)):tt<=10?(H(E,R,E.bl_tree),$(E,tt-3,3)):(H(E,F,E.bl_tree),$(E,tt-11,7));Y=V,bt=(tt=0)===rt?(st=138,3):V===rt?(st=6,3):(st=7,4)}}c(P);var D=!1;function z(E,O,q,J){$(E,(d<<1)+(J?1:0),3),(function(V,Y,rt,tt){at(V),Z(V,rt),Z(V,~rt),s.arraySet(V.pending_buf,V.window,Y,rt,V.pending),V.pending+=rt})(E,O,q)}n._tr_init=function(E){D||((function(){var O,q,J,V,Y,rt=new Array(p+1);for(V=J=0;V<v-1;V++)for(W[V]=J,O=0;O<1<<L[V];O++)u[J++]=V;for(u[J-1]=V,V=Y=0;V<16;V++)for(P[V]=Y,O=0;O<1<<j[V];O++)U[Y++]=V;for(Y>>=7;V<f;V++)for(P[V]=Y<<7,O=0;O<1<<j[V]-7;O++)U[256+Y++]=V;for(q=0;q<=p;q++)rt[q]=0;for(O=0;O<=143;)X[2*O+1]=8,O++,rt[8]++;for(;O<=255;)X[2*O+1]=9,O++,rt[9]++;for(;O<=279;)X[2*O+1]=7,O++,rt[7]++;for(;O<=287;)X[2*O+1]=8,O++,rt[8]++;for(lt(X,b+1,rt),O=0;O<f;O++)T[2*O+1]=5,T[2*O]=ot(O,5);C=new N(X,L,_+1,b,p),S=new N(T,j,0,f,p),I=new N(new Array(0),B,0,m,x)})(),D=!0),E.l_desc=new k(E.dyn_ltree,C),E.d_desc=new k(E.dyn_dtree,S),E.bl_desc=new k(E.bl_tree,I),E.bi_buf=0,E.bi_valid=0,nt(E)},n._tr_stored_block=z,n._tr_flush_block=function(E,O,q,J){var V,Y,rt=0;0<E.level?(E.strm.data_type===2&&(E.strm.data_type=(function(tt){var st,bt=4093624447;for(st=0;st<=31;st++,bt>>>=1)if(1&bt&&tt.dyn_ltree[2*st]!==0)return a;if(tt.dyn_ltree[18]!==0||tt.dyn_ltree[20]!==0||tt.dyn_ltree[26]!==0)return o;for(st=32;st<_;st++)if(tt.dyn_ltree[2*st]!==0)return o;return a})(E)),Dt(E,E.l_desc),Dt(E,E.d_desc),rt=(function(tt){var st;for(h(tt,tt.dyn_ltree,tt.l_desc.max_code),h(tt,tt.dyn_dtree,tt.d_desc.max_code),Dt(tt,tt.bl_desc),st=m-1;3<=st&&tt.bl_tree[2*Q[st]+1]===0;st--);return tt.opt_len+=3*(st+1)+5+5+4,st})(E),V=E.opt_len+3+7>>>3,(Y=E.static_len+3+7>>>3)<=V&&(V=Y)):V=Y=q+5,q+4<=V&&O!==-1?z(E,O,q,J):E.strategy===4||Y===V?($(E,2+(J?1:0),3),Ft(E,X,T)):($(E,4+(J?1:0),3),(function(tt,st,bt,ft){var Qt;for($(tt,st-257,5),$(tt,bt-1,5),$(tt,ft-4,4),Qt=0;Qt<ft;Qt++)$(tt,tt.bl_tree[2*Q[Qt]+1],3);G(tt,tt.dyn_ltree,st-1),G(tt,tt.dyn_dtree,bt-1)})(E,E.l_desc.max_code+1,E.d_desc.max_code+1,rt+1),Ft(E,E.dyn_ltree,E.dyn_dtree)),nt(E),J&&at(E)},n._tr_tally=function(E,O,q){return E.pending_buf[E.d_buf+2*E.last_lit]=O>>>8&255,E.pending_buf[E.d_buf+2*E.last_lit+1]=255&O,E.pending_buf[E.l_buf+E.last_lit]=255&q,E.last_lit++,O===0?E.dyn_ltree[2*q]++:(E.matches++,O--,E.dyn_ltree[2*(u[q]+_+1)]++,E.dyn_dtree[2*M(O)]++),E.last_lit===E.lit_bufsize-1},n._tr_align=function(E){$(E,2,3),H(E,w,X),(function(O){O.bi_valid===16?(Z(O,O.bi_buf),O.bi_buf=0,O.bi_valid=0):8<=O.bi_valid&&(O.pending_buf[O.pending++]=255&O.bi_buf,O.bi_buf>>=8,O.bi_valid-=8)})(E)}},{"../utils/common":41}],53:[function(e,r,n){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,r,n){(function(s){(function(a,o){if(!a.setImmediate){var c,d,v,_,b=1,f={},m=!1,l=a.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(a);p=p&&p.setTimeout?p:a,c={}.toString.call(a.process)==="[object process]"?function(A){process.nextTick(function(){x(A)})}:(function(){if(a.postMessage&&!a.importScripts){var A=!0,R=a.onmessage;return a.onmessage=function(){A=!1},a.postMessage("","*"),a.onmessage=R,A}})()?(_="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",w,!1):a.attachEvent("onmessage",w),function(A){a.postMessage(_+A,"*")}):a.MessageChannel?((v=new MessageChannel).port1.onmessage=function(A){x(A.data)},function(A){v.port2.postMessage(A)}):l&&"onreadystatechange"in l.createElement("script")?(d=l.documentElement,function(A){var R=l.createElement("script");R.onreadystatechange=function(){x(A),R.onreadystatechange=null,d.removeChild(R),R=null},d.appendChild(R)}):function(A){setTimeout(x,0,A)},p.setImmediate=function(A){typeof A!="function"&&(A=new Function(""+A));for(var R=new Array(arguments.length-1),F=0;F<R.length;F++)R[F]=arguments[F+1];var L={callback:A,args:R};return f[b]=L,c(b),b++},p.clearImmediate=g}function g(A){delete f[A]}function x(A){if(m)setTimeout(x,0,A);else{var R=f[A];if(R){m=!0;try{(function(F){var L=F.callback,j=F.args;switch(j.length){case 0:L();break;case 1:L(j[0]);break;case 2:L(j[0],j[1]);break;case 3:L(j[0],j[1],j[2]);break;default:L.apply(o,j)}})(R)}finally{g(A),m=!1}}}}function w(A){A.source===a&&typeof A.data=="string"&&A.data.indexOf(_)===0&&x(+A.data.slice(_.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof Fe<"u"?Fe:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(tr)),tr.exports}vn();var De={exports:{}};var bn=De.exports,yr;function xn(){return yr||(yr=1,(function(i,t){(function(e,r){i.exports=r()})(bn,function(){var e={};e.version="0.2.0";var r=e.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};e.configure=function(m){var l,p;for(l in m)p=m[l],p!==void 0&&m.hasOwnProperty(l)&&(r[l]=p);return this},e.status=null,e.set=function(m){var l=e.isStarted();m=n(m,r.minimum,1),e.status=m===1?null:m;var p=e.render(!l),g=p.querySelector(r.barSelector),x=r.speed,w=r.easing;return p.offsetWidth,o(function(A){r.positionUsing===""&&(r.positionUsing=e.getPositioningCSS()),c(g,a(m,x,w)),m===1?(c(p,{transition:"none",opacity:1}),p.offsetWidth,setTimeout(function(){c(p,{transition:"all "+x+"ms linear",opacity:0}),setTimeout(function(){e.remove(),A()},x)},x)):setTimeout(A,x)}),this},e.isStarted=function(){return typeof e.status=="number"},e.start=function(){e.status||e.set(0);var m=function(){setTimeout(function(){e.status&&(e.trickle(),m())},r.trickleSpeed)};return r.trickle&&m(),this},e.done=function(m){return!m&&!e.status?this:e.inc(.3+.5*Math.random()).set(1)},e.inc=function(m){var l=e.status;return l?(typeof m!="number"&&(m=(1-l)*n(Math.random()*l,.1,.95)),l=n(l+m,0,.994),e.set(l)):e.start()},e.trickle=function(){return e.inc(Math.random()*r.trickleRate)},(function(){var m=0,l=0;e.promise=function(p){return!p||p.state()==="resolved"?this:(l===0&&e.start(),m++,l++,p.always(function(){l--,l===0?(m=0,e.done()):e.set((m-l)/m)}),this)}})(),e.render=function(m){if(e.isRendered())return document.getElementById("nprogress");v(document.documentElement,"nprogress-busy");var l=document.createElement("div");l.id="nprogress",l.innerHTML=r.template;var p=l.querySelector(r.barSelector),g=m?"-100":s(e.status||0),x=document.querySelector(r.parent),w;return c(p,{transition:"all 0 linear",transform:"translate3d("+g+"%,0,0)"}),r.showSpinner||(w=l.querySelector(r.spinnerSelector),w&&f(w)),x!=document.body&&v(x,"nprogress-custom-parent"),x.appendChild(l),l},e.remove=function(){_(document.documentElement,"nprogress-busy"),_(document.querySelector(r.parent),"nprogress-custom-parent");var m=document.getElementById("nprogress");m&&f(m)},e.isRendered=function(){return!!document.getElementById("nprogress")},e.getPositioningCSS=function(){var m=document.body.style,l="WebkitTransform"in m?"Webkit":"MozTransform"in m?"Moz":"msTransform"in m?"ms":"OTransform"in m?"O":"";return l+"Perspective"in m?"translate3d":l+"Transform"in m?"translate":"margin"};function n(m,l,p){return m<l?l:m>p?p:m}function s(m){return(-1+m)*100}function a(m,l,p){var g;return r.positionUsing==="translate3d"?g={transform:"translate3d("+s(m)+"%,0,0)"}:r.positionUsing==="translate"?g={transform:"translate("+s(m)+"%,0)"}:g={"margin-left":s(m)+"%"},g.transition="all "+l+"ms "+p,g}var o=(function(){var m=[];function l(){var p=m.shift();p&&p(l)}return function(p){m.push(p),m.length==1&&l()}})(),c=(function(){var m=["Webkit","O","Moz","ms"],l={};function p(A){return A.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(R,F){return F.toUpperCase()})}function g(A){var R=document.body.style;if(A in R)return A;for(var F=m.length,L=A.charAt(0).toUpperCase()+A.slice(1),j;F--;)if(j=m[F]+L,j in R)return j;return A}function x(A){return A=p(A),l[A]||(l[A]=g(A))}function w(A,R,F){R=x(R),A.style[R]=F}return function(A,R){var F=arguments,L,j;if(F.length==2)for(L in R)j=R[L],j!==void 0&&R.hasOwnProperty(L)&&w(A,L,j);else w(A,F[1],F[2])}})();function d(m,l){var p=typeof m=="string"?m:b(m);return p.indexOf(" "+l+" ")>=0}function v(m,l){var p=b(m),g=p+l;d(p,l)||(m.className=g.substring(1))}function _(m,l){var p=b(m),g;d(m,l)&&(g=p.replace(" "+l+" "," "),m.className=g.substring(1,g.length-1))}function b(m){return(" "+(m.className||"")+" ").replace(/\s+/gi," ")}function f(m){m&&m.parentNode&&m.parentNode.removeChild(m)}return e})})(De)),De.exports}xn();var Oe={exports:{}},Cr;function wn(){if(Cr)return Oe.exports;Cr=1,Oe.exports=i,Oe.exports.default=i;function i(C,S,I){I=I||2;var P=S&&S.length,N=P?S[0]*I:C.length,k=t(C,0,N,I,!0),M=[];if(!k||k.next===k.prev)return M;var Z,$,H,ot,lt,nt,at;if(P&&(k=c(C,S,k,I)),C.length>80*I){Z=H=C[0],$=ot=C[1];for(var ct=I;ct<N;ct+=I)lt=C[ct],nt=C[ct+1],lt<Z&&(Z=lt),nt<$&&($=nt),lt>H&&(H=lt),nt>ot&&(ot=nt);at=Math.max(H-Z,ot-$),at=at!==0?32767/at:0}return r(k,M,I,Z,$,at,0),M}function t(C,S,I,P,N){var k,M;if(N===W(C,S,I,P)>0)for(k=S;k<I;k+=P)M=T(k,C[k],C[k+1],M);else for(k=I-P;k>=S;k-=P)M=T(k,C[k],C[k+1],M);return M&&A(M,M.next)&&(U(M),M=M.next),M}function e(C,S){if(!C)return C;S||(S=C);var I=C,P;do if(P=!1,!I.steiner&&(A(I,I.next)||w(I.prev,I,I.next)===0)){if(U(I),I=S=I.prev,I===I.next)break;P=!0}else I=I.next;while(P||I!==S);return S}function r(C,S,I,P,N,k,M){if(C){!M&&k&&f(C,P,N,k);for(var Z=C,$,H;C.prev!==C.next;){if($=C.prev,H=C.next,k?s(C,P,N,k):n(C)){S.push($.i/I|0),S.push(C.i/I|0),S.push(H.i/I|0),U(C),C=H.next,Z=H.next;continue}if(C=H,C===Z){M?M===1?(C=a(e(C),S,I),r(C,S,I,P,N,k,2)):M===2&&o(C,S,I,P,N,k):r(e(C),S,I,P,N,k,1);break}}}}function n(C){var S=C.prev,I=C,P=C.next;if(w(S,I,P)>=0)return!1;for(var N=S.x,k=I.x,M=P.x,Z=S.y,$=I.y,H=P.y,ot=N<k?N<M?N:M:k<M?k:M,lt=Z<$?Z<H?Z:H:$<H?$:H,nt=N>k?N>M?N:M:k>M?k:M,at=Z>$?Z>H?Z:H:$>H?$:H,ct=P.next;ct!==S;){if(ct.x>=ot&&ct.x<=nt&&ct.y>=lt&&ct.y<=at&&g(N,Z,k,$,M,H,ct.x,ct.y)&&w(ct.prev,ct,ct.next)>=0)return!1;ct=ct.next}return!0}function s(C,S,I,P){var N=C.prev,k=C,M=C.next;if(w(N,k,M)>=0)return!1;for(var Z=N.x,$=k.x,H=M.x,ot=N.y,lt=k.y,nt=M.y,at=Z<$?Z<H?Z:H:$<H?$:H,ct=ot<lt?ot<nt?ot:nt:lt<nt?lt:nt,gt=Z>$?Z>H?Z:H:$>H?$:H,Ft=ot>lt?ot>nt?ot:nt:lt>nt?lt:nt,Dt=l(at,ct,S,I,P),h=l(gt,Ft,S,I,P),G=C.prevZ,D=C.nextZ;G&&G.z>=Dt&&D&&D.z<=h;){if(G.x>=at&&G.x<=gt&&G.y>=ct&&G.y<=Ft&&G!==N&&G!==M&&g(Z,ot,$,lt,H,nt,G.x,G.y)&&w(G.prev,G,G.next)>=0||(G=G.prevZ,D.x>=at&&D.x<=gt&&D.y>=ct&&D.y<=Ft&&D!==N&&D!==M&&g(Z,ot,$,lt,H,nt,D.x,D.y)&&w(D.prev,D,D.next)>=0))return!1;D=D.nextZ}for(;G&&G.z>=Dt;){if(G.x>=at&&G.x<=gt&&G.y>=ct&&G.y<=Ft&&G!==N&&G!==M&&g(Z,ot,$,lt,H,nt,G.x,G.y)&&w(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;D&&D.z<=h;){if(D.x>=at&&D.x<=gt&&D.y>=ct&&D.y<=Ft&&D!==N&&D!==M&&g(Z,ot,$,lt,H,nt,D.x,D.y)&&w(D.prev,D,D.next)>=0)return!1;D=D.nextZ}return!0}function a(C,S,I){var P=C;do{var N=P.prev,k=P.next.next;!A(N,k)&&R(N,P,P.next,k)&&B(N,k)&&B(k,N)&&(S.push(N.i/I|0),S.push(P.i/I|0),S.push(k.i/I|0),U(P),U(P.next),P=C=k),P=P.next}while(P!==C);return e(P)}function o(C,S,I,P,N,k){var M=C;do{for(var Z=M.next.next;Z!==M.prev;){if(M.i!==Z.i&&x(M,Z)){var $=X(M,Z);M=e(M,M.next),$=e($,$.next),r(M,S,I,P,N,k,0),r($,S,I,P,N,k,0);return}Z=Z.next}M=M.next}while(M!==C)}function c(C,S,I,P){var N=[],k,M,Z,$,H;for(k=0,M=S.length;k<M;k++)Z=S[k]*P,$=k<M-1?S[k+1]*P:C.length,H=t(C,Z,$,P,!1),H===H.next&&(H.steiner=!0),N.push(p(H));for(N.sort(d),k=0;k<N.length;k++)I=v(N[k],I);return I}function d(C,S){return C.x-S.x}function v(C,S){var I=_(C,S);if(!I)return S;var P=X(I,C);return e(P,P.next),e(I,I.next)}function _(C,S){var I=S,P=C.x,N=C.y,k=-1/0,M;do{if(N<=I.y&&N>=I.next.y&&I.next.y!==I.y){var Z=I.x+(N-I.y)*(I.next.x-I.x)/(I.next.y-I.y);if(Z<=P&&Z>k&&(k=Z,M=I.x<I.next.x?I:I.next,Z===P))return M}I=I.next}while(I!==S);if(!M)return null;var $=M,H=M.x,ot=M.y,lt=1/0,nt;I=M;do P>=I.x&&I.x>=H&&P!==I.x&&g(N<ot?P:k,N,H,ot,N<ot?k:P,N,I.x,I.y)&&(nt=Math.abs(N-I.y)/(P-I.x),B(I,C)&&(nt<lt||nt===lt&&(I.x>M.x||I.x===M.x&&b(M,I)))&&(M=I,lt=nt)),I=I.next;while(I!==$);return M}function b(C,S){return w(C.prev,C,S.prev)<0&&w(S.next,C,C.next)<0}function f(C,S,I,P){var N=C;do N.z===0&&(N.z=l(N.x,N.y,S,I,P)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==C);N.prevZ.nextZ=null,N.prevZ=null,m(N)}function m(C){var S,I,P,N,k,M,Z,$,H=1;do{for(I=C,C=null,k=null,M=0;I;){for(M++,P=I,Z=0,S=0;S<H&&(Z++,P=P.nextZ,!!P);S++);for($=H;Z>0||$>0&&P;)Z!==0&&($===0||!P||I.z<=P.z)?(N=I,I=I.nextZ,Z--):(N=P,P=P.nextZ,$--),k?k.nextZ=N:C=N,N.prevZ=k,k=N;I=P}k.nextZ=null,H*=2}while(M>1);return C}function l(C,S,I,P,N){return C=(C-I)*N|0,S=(S-P)*N|0,C=(C|C<<8)&16711935,C=(C|C<<4)&252645135,C=(C|C<<2)&858993459,C=(C|C<<1)&1431655765,S=(S|S<<8)&16711935,S=(S|S<<4)&252645135,S=(S|S<<2)&858993459,S=(S|S<<1)&1431655765,C|S<<1}function p(C){var S=C,I=C;do(S.x<I.x||S.x===I.x&&S.y<I.y)&&(I=S),S=S.next;while(S!==C);return I}function g(C,S,I,P,N,k,M,Z){return(N-M)*(S-Z)>=(C-M)*(k-Z)&&(C-M)*(P-Z)>=(I-M)*(S-Z)&&(I-M)*(k-Z)>=(N-M)*(P-Z)}function x(C,S){return C.next.i!==S.i&&C.prev.i!==S.i&&!j(C,S)&&(B(C,S)&&B(S,C)&&Q(C,S)&&(w(C.prev,C,S.prev)||w(C,S.prev,S))||A(C,S)&&w(C.prev,C,C.next)>0&&w(S.prev,S,S.next)>0)}function w(C,S,I){return(S.y-C.y)*(I.x-S.x)-(S.x-C.x)*(I.y-S.y)}function A(C,S){return C.x===S.x&&C.y===S.y}function R(C,S,I,P){var N=L(w(C,S,I)),k=L(w(C,S,P)),M=L(w(I,P,C)),Z=L(w(I,P,S));return!!(N!==k&&M!==Z||N===0&&F(C,I,S)||k===0&&F(C,P,S)||M===0&&F(I,C,P)||Z===0&&F(I,S,P))}function F(C,S,I){return S.x<=Math.max(C.x,I.x)&&S.x>=Math.min(C.x,I.x)&&S.y<=Math.max(C.y,I.y)&&S.y>=Math.min(C.y,I.y)}function L(C){return C>0?1:C<0?-1:0}function j(C,S){var I=C;do{if(I.i!==C.i&&I.next.i!==C.i&&I.i!==S.i&&I.next.i!==S.i&&R(I,I.next,C,S))return!0;I=I.next}while(I!==C);return!1}function B(C,S){return w(C.prev,C,C.next)<0?w(C,S,C.next)>=0&&w(C,C.prev,S)>=0:w(C,S,C.prev)<0||w(C,C.next,S)<0}function Q(C,S){var I=C,P=!1,N=(C.x+S.x)/2,k=(C.y+S.y)/2;do I.y>k!=I.next.y>k&&I.next.y!==I.y&&N<(I.next.x-I.x)*(k-I.y)/(I.next.y-I.y)+I.x&&(P=!P),I=I.next;while(I!==C);return P}function X(C,S){var I=new u(C.i,C.x,C.y),P=new u(S.i,S.x,S.y),N=C.next,k=S.prev;return C.next=S,S.prev=C,I.next=N,N.prev=I,P.next=I,I.prev=P,k.next=P,P.prev=k,P}function T(C,S,I,P){var N=new u(C,S,I);return P?(N.next=P.next,N.prev=P,P.next.prev=N,P.next=N):(N.prev=N,N.next=N),N}function U(C){C.next.prev=C.prev,C.prev.next=C.next,C.prevZ&&(C.prevZ.nextZ=C.nextZ),C.nextZ&&(C.nextZ.prevZ=C.prevZ)}function u(C,S,I){this.i=C,this.x=S,this.y=I,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}i.deviation=function(C,S,I,P){var N=S&&S.length,k=N?S[0]*I:C.length,M=Math.abs(W(C,0,k,I));if(N)for(var Z=0,$=S.length;Z<$;Z++){var H=S[Z]*I,ot=Z<$-1?S[Z+1]*I:C.length;M-=Math.abs(W(C,H,ot,I))}var lt=0;for(Z=0;Z<P.length;Z+=3){var nt=P[Z]*I,at=P[Z+1]*I,ct=P[Z+2]*I;lt+=Math.abs((C[nt]-C[ct])*(C[at+1]-C[nt+1])-(C[nt]-C[at])*(C[ct+1]-C[nt+1]))}return M===0&&lt===0?0:Math.abs((lt-M)/M)};function W(C,S,I,P){for(var N=0,k=S,M=I-P;k<I;k+=P)N+=(C[M]-C[k])*(C[k+1]+C[M+1]),M=k;return N}return i.flatten=function(C){for(var S=C[0][0].length,I={vertices:[],holes:[],dimensions:S},P=0,N=0;N<C.length;N++){for(var k=0;k<C[N].length;k++)for(var M=0;M<S;M++)I.vertices.push(C[N][k][M]);N>0&&(P+=C[N-1].length,I.holes.push(P))}return I},Oe.exports}wn();console.log("\x1B[1m\x1B[34m=======================\x1B[0m");console.log("\x1B[33m piqiu3d Version:\x1B[0m \x1B[32m 3.4.3 \x1B[0m");console.log("\x1B[1m\x1B[34m=======================\x1B[0m");class Xt{constructor(t=0,e=0,r=0,n=1){this.isColor=!0,this.m_r=t,this.m_g=e,this.m_b=r,this.m_a=n}get r(){return this.m_r}set r(t){this.m_r=t}get g(){return this.m_g}set g(t){this.m_g=t}get b(){return this.m_b}set b(t){this.m_b=t}get a(){return this.m_a}set a(t){this.m_a=t}copy(t){this.m_r=t.m_r,this.m_g=t.m_g,this.m_b=t.m_b,this.m_a=t.m_a}clone(){return new Xt(this.m_r,this.m_g,this.m_b,this.m_a)}toRgbArray(){return new Float32Array([this.m_r,this.m_g,this.m_b])}toRgbaArray(){return new Float32Array([this.m_r,this.m_g,this.m_b,this.m_a])}cmp(t){return!(this.m_r!==t.m_r||this.m_g!==t.m_g||this.m_b!==t.m_b||this.m_a!==t.m_a)}}et();et();Ue();class sr{constructor(t=et(),e=K(0,0,-1)){this.lineThreshold=1,this.pointThreshold=5,this.origin=t,this.direction=e}set(t,e){return le(this.origin,t),le(this.direction,e),this}copy(t){return le(this.origin,t.origin),le(this.direction,t.direction),this}at(t,e){return le(e,this.direction),Ae(e,e,t),dt(e,e,this.origin)}setFromCamera(t,e){const r=e.builtInUniforms;r.update();const n=t[0]/e.viewportSize[0]*2-1,s=-t[1]/e.viewportSize[1]*2+1,a=[n,s,-1],o=[n,s,1];let c=ht();me(c,Lt(ht(),r.projectionMatrix,r.viewMatrix)),Jt(this.origin,a,c);const d=Jt(et(),o,c);return wt(this.direction,Tt(et(),d,this.origin)),this}clone(){return new sr().copy(this)}intersectTriangle(t,e,r,n=!0,s=et()){let a=Tt(et(),e,t),o=Tt(et(),r,t);const c=Rt(et(),a,o);let d=_t(this.direction,c),v;if(d>0){if(n)return null;v=1}else if(d<0)v=-1,d=-d;else return null;const _=Tt(et(),this.origin,t);o=Rt(et(),_,o);const b=v*_t(this.direction,o);if(b<0)return null;a=Rt(et(),a,_);const f=v*_t(this.direction,a);if(f<0||b+f>d)return null;const m=-v*_t(_,c);if(m<0)return null;const l=_t(this.direction,o)/_t(this.direction,c),p=_t(this.direction,a)/_t(this.direction,c);return{point:this.at(m/d,s),baryCoords:K(1-l-p,l,p),distance:m/d}}intersectLine(){}applyMatrix4(t){return this.origin=jt(this.origin,t),this.direction=ai(this.direction,t),this}}class ar extends sr{constructor(t=et(),e=K(0,0,-1)){super(t,e),this.v3=et()}clone(){return new ar().copy(this)}distanceToPlane(t){const e=_t(t.normal,this.direction);return e===0&&t.distanceToPoint(this.origin)===0?0:-(_t(this.origin,t.normal)+t.constant)/e}intersectPlane(t,e){const r=this.distanceToPlane(t);return r===null?null:this.at(r,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||_t(t.normal,this.direction)*e<0}intersectBox(t,e){let r,n,s,a,o,c;const d=1/this.direction[0],v=1/this.direction[1],_=1/this.direction[2],b=this.origin;return d>=0?(r=(t.min[0]-b[0])*d,n=(t.max[0]-b[0])*d):(r=(t.max[0]-b[0])*d,n=(t.min[0]-b[0])*d),v>=0?(s=(t.min[1]-b[1])*v,a=(t.max[1]-b[1])*v):(s=(t.max[1]-b[1])*v,a=(t.min[1]-b[1])*v),r>a||s>n||((s>r||isNaN(r))&&(r=s),(a<n||isNaN(n))&&(n=a),_>=0?(o=(t.min[2]-b[2])*_,c=(t.max[2]-b[2])*_):(o=(t.max[2]-b[2])*_,c=(t.min[2]-b[2])*_),r>c||o>n)||((o>r||r!==r)&&(r=o),(c<n||n!==n)&&(n=c),n<0)?null:this.at(r>=0?r:n,e)}intersectsBox(t){return this.intersectBox(t,this.v3)!==null}}let y;class Or{constructor(t,e=[]){this.m_extensions=new Map,this.m_context=t,this.isWebGL2=typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext,[...["OES_element_index_uint","OES_vertex_array_object","WEBGL_depth_texture"],...e].forEach(n=>{const s=t.getExtension(n);s&&this.m_extensions.set(n,s)})}get gl(){return this.m_context}hasExtension(t){return this.m_extensions.has(t)}getExtension(t){var e;return(e=this.m_extensions.get(t))!==null&&e!==void 0?e:null}isCurrent(){return y===this.m_context}makeCurrent(){this.isCurrent()||(y=this.m_context)}static current(){return y}loseContext(){const t=this.m_context.getExtension("WEBGL_lose_context");t&&t.loseContext()}}class he{constructor(){}bind(){}unbind(){}copy(t){}clone(){const t=new this.constructor;return t.copy(this),t}toJson(){return{}}}class ze extends Set{constructor(){super()}push(t){super.add(t)}}class Pt{constructor(){}static toGLTexture(t){if(t==="nx")return y.TEXTURE_CUBE_MAP_NEGATIVE_X;if(t==="px")return y.TEXTURE_CUBE_MAP_POSITIVE_X;if(t==="ny")return y.TEXTURE_CUBE_MAP_NEGATIVE_Y;if(t==="py")return y.TEXTURE_CUBE_MAP_POSITIVE_Y;if(t==="nz")return y.TEXTURE_CUBE_MAP_NEGATIVE_Z;if(t==="pz")return y.TEXTURE_CUBE_MAP_POSITIVE_Z}static toGLType(t){if(t==="byte")return y.BYTE;if(t==="unsigned_byte")return y.UNSIGNED_BYTE;if(t==="short")return y.SHORT;if(t==="unsigned_short_4_4_4_4")return y.UNSIGNED_SHORT_4_4_4_4;if(t==="unsigned_short_5_5_5_1")return y.UNSIGNED_SHORT_5_5_5_1;if(t==="unsigned_short_5_6_5")return y.UNSIGNED_SHORT_5_6_5;if(t==="unsigned_short")return y.UNSIGNED_SHORT;if(t==="int")return y.INT;if(t==="unsigned_int")return y.UNSIGNED_INT;if(t==="float")return y.FLOAT}static toGLPrimitive(t){if(t==="triangles")return y.TRIANGLES;if(t==="triangle_fan")return y.TRIANGLE_FAN;if(t==="triangle_strip")return y.TRIANGLE_STRIP;if(t==="lines")return y.LINES;if(t==="line_loop")return y.LINE_LOOP;if(t==="line_strip")return y.LINE_STRIP;if(t==="points")return y.POINTS}static toGLWrapMode(t){if(t==="repeat")return y.REPEAT;if(t==="clamp_to_edge")return y.CLAMP_TO_EDGE;if(t==="mirrored_repeat")return y.MIRRORED_REPEAT}static toGLFilter(t){if(t==="nearest")return y.NEAREST;if(t==="linear")return y.LINEAR;if(t==="nearest_mipmap_nearest")return y.NEAREST_MIPMAP_NEAREST;if(t==="linear_mipmap_nearest")return y.LINEAR_MIPMAP_NEAREST;if(t==="nearest_mipmap_linear")return y.NEAREST_MIPMAP_LINEAR;if(t==="linear_mipmap_linear")return y.LINEAR_MIPMAP_LINEAR}static toGLFace(t){if(t==="back")return y.BACK;if(t==="front")return y.FRONT;if(t==="front_and_back")return y.FRONT_AND_BACK}static toGLFrontMode(t){if(t==="ccw")return y.CCW;if(t==="cw")return y.CW}static toGLFormat(t){if(t==="depth_component16")return y.DEPTH_COMPONENT16;if(t==="depth_component")return y.DEPTH_COMPONENT;if(t==="rgba4")return y.RGBA4;if(t==="rgb565")return y.RGB565;if(t==="rgb5_a1")return y.RGB5_A1;if(t==="alpha")return y.ALPHA;if(t==="luminance")return y.LUMINANCE;if(t==="luminance_alpha")return y.LUMINANCE_ALPHA;if(t==="rgb")return y.RGB;if(t==="rgba")return y.RGBA}static toGLFunction(t){if(t==="never")return y.NEVER;if(t==="less")return y.LESS;if(t==="lequal")return y.LEQUAL;if(t==="equal")return y.EQUAL;if(t==="notequal")return y.NOTEQUAL;if(t==="gequal")return y.GEQUAL;if(t==="greater")return y.GREATER;if(t==="always")return y.ALWAYS;if(t==="zero")return y.ZERO;if(t==="one")return y.ONE;if(t==="src_color")return y.SRC_COLOR;if(t==="one_minus_src_color")return y.ONE_MINUS_SRC_COLOR;if(t==="dst_color")return y.DST_COLOR;if(t==="one_minus_dst_color")return y.ONE_MINUS_DST_COLOR;if(t==="src_alpha")return y.SRC_ALPHA;if(t==="one_minus_src_alpha")return y.ONE_MINUS_SRC_ALPHA;if(t==="dst_alpha")return y.DST_ALPHA;if(t==="one_minus_dst_alpha")return y.ONE_MINUS_DST_ALPHA;if(t==="constant_color")return y.CONSTANT_COLOR;if(t==="one_minus_constant_color")return y.ONE_MINUS_CONSTANT_COLOR;if(t==="constant_alpha")return y.CONSTANT_ALPHA;if(t==="one_minus_constant_alpha")return y.ONE_MINUS_CONSTANT_ALPHA;if(t==="src_alpha_saturate")return y.SRC_ALPHA_SATURATE}static toGLOperation(t){if(t==="keep")return y.KEEP;if(t==="zero")return y.ZERO;if(t==="replace")return y.REPLACE;if(t==="incr")return y.INCR;if(t==="decr")return y.DECR;if(t==="invert")return y.INVERT;if(t==="incr_wrap")return y.INCR_WRAP;if(t==="decr_wrap")return y.DECR_WRAP}static toGLEquation(t){if(t==="func_add")return y.FUNC_ADD;if(t==="func_subtract")return y.FUNC_SUBTRACT;if(t==="func_reverse_subtract")return y.FUNC_REVERSE_SUBTRACT}}class He extends he{constructor(){super(),this.name="Drawer"}bind(){this.draw()}get mode(){}get count(){}}class Ie extends He{constructor(t,e,r,n){super(),this.name="ElementDrawer",this.m_spec={mode:t,count:e,type:r,offset:n}}toJson(){return this.m_spec}get mode(){return this.m_spec.mode}get count(){return this.m_spec.count}get type(){return this.m_spec.type}get offset(){return this.m_spec.offset}set(t,e,r,n){this.m_spec.mode=t,this.m_spec.count=e,this.m_spec.type=r,this.m_spec.offset=n}draw(){const t=Pt.toGLPrimitive,e=Pt.toGLType,r=this.m_spec;y.drawElements(t(r.mode),r.count,e(r.type),r.offset)}}class pe extends He{constructor(t,e,r){super(),this.name="ArrayDrawer",this.m_spec={mode:t,first:e,count:r}}toJson(){return this.m_spec}get mode(){return this.m_spec.mode}get first(){return this.m_spec.first}get count(){return this.m_spec.count}set count(t){this.m_spec.count=t}set(t,e,r){this.m_spec.mode=t,this.m_spec.count=r,this.m_spec.first=e}draw(){const t=Pt.toGLPrimitive,e=this.m_spec;y.drawArrays(t(e.mode),e.first,e.count)}}class ke extends ze{constructor(){super()}clone(){const t=new ke;return this.forEach(e=>t.add(e)),t}}var xt;(function(i){i[i.Unknown=0]="Unknown",i[i.Created=1]="Created",i[i.Allocated=2]="Allocated",i[i.Buffered=3]="Buffered"})(xt||(xt={}));class oe extends he{constructor(){super(),this.m_state=xt.Created}get resourceId(){return this.m_bufferId}set data(t){this.m_data=t}get data(){return this.m_data}static get clean(){return this.s_clean}static set clean(t){this.s_clean=t}alloc(){this.m_bufferId=this.doAlloc(),this.m_state=xt.Allocated}free(){this.m_bufferId!==void 0&&(this.doFree(this.m_bufferId),this.m_bufferId=void 0,this.m_state=xt.Created)}load(){this.m_state<xt.Allocated&&this.alloc(),this.doLoad(this.m_bufferId),this.m_state=xt.Buffered,oe.s_clean&&(this.m_data=void 0)}bind(){this.m_state<xt.Buffered&&this.load(),this.doBind(this.m_bufferId)}unbind(){this.doUnbind()}doAlloc(){}doFree(t){}doLoad(t){}doBind(t){}doUnbind(){}}oe.s_clean=!1;class Br extends oe{constructor(){super()}toJson(){return this.m_spec}doAlloc(){return y.createTexture()}doFree(t){y.deleteTexture(t)}}class or extends Br{constructor(t,e,r){super(),this.m_spec={format:t,type:e},this.m_data=r}clone(){return new or(this.m_spec.format,this.m_spec.type,this.m_data)}set(t,e,r){this.m_spec={format:t,type:e},this.m_data=r,this.m_state>=xt.Buffered&&(this.m_state=xt.Allocated)}doLoad(t){y.bindTexture(y.TEXTURE_2D,t);const e=Pt.toGLFormat,r=Pt.toGLType,n=this.m_spec;this.m_data instanceof Image||this.m_data instanceof HTMLImageElement?y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,!0):y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,!1),y.texImage2D(y.TEXTURE_2D,0,e(n.format),e(n.format),r(n.type),this.m_data)}doBind(t){y.bindTexture(y.TEXTURE_2D,t)}doUnbind(){y.bindTexture(y.TEXTURE_2D,null)}}class cr extends Br{constructor(t,e,r=100,n=100){super(),this.m_spec={format:t,type:e,width:r,height:n},this.set(t,e,r,n)}clone(){return new cr(this.m_spec.format,this.m_spec.type,this.m_spec.width,this.m_spec.height)}set(t,e,r,n){this.m_spec={format:t,type:e,width:r,height:n},this.m_state>=xt.Buffered&&(this.m_state=xt.Allocated)}get size(){return[this.m_spec.width,this.m_spec.height]}set size(t){this.m_spec.width=t[0],this.m_spec.height=t[1],this.m_state>=xt.Buffered&&(this.m_state=xt.Allocated)}doLoad(t){y.bindTexture(y.TEXTURE_2D,t),y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,!0);const e=Pt.toGLFormat,r=Pt.toGLType,n=this.m_spec,s=e(n.format),a=r(n.type);y.texImage2D(y.TEXTURE_2D,0,s,n.width,n.height,0,s,a,null)}doBind(t){y.bindTexture(y.TEXTURE_2D,t)}doUnbind(){y.bindTexture(y.TEXTURE_2D,null)}}class lr extends oe{constructor(t,e=100,r=100){super(),this.m_spec={format:t,width:e,height:r}}toJson(){return this.m_spec}clone(){return new lr(this.m_spec.format,this.m_spec.width,this.m_spec.height)}set(t,e,r){this.m_spec={format:t,width:e,height:r},this.m_state>=xt.Buffered&&(this.m_state=xt.Allocated)}get size(){return[this.m_spec.width,this.m_spec.height]}set size(t){this.m_spec.width=t[0],this.m_spec.height=t[1],this.m_state>=xt.Buffered&&(this.m_state=xt.Allocated)}doAlloc(){return y.createRenderbuffer()}doFree(t){y.deleteRenderbuffer(t)}doLoad(t){y.bindRenderbuffer(y.RENDERBUFFER,t);const e=Pt.toGLFormat;y.renderbufferStorage(y.RENDERBUFFER,e(this.m_spec.format),this.m_spec.width,this.m_spec.height)}doBind(t){y.bindRenderbuffer(y.RENDERBUFFER,t)}doUnbind(){y.bindRenderbuffer(y.RENDERBUFFER,null)}}class $e extends oe{constructor(t){super(),this.m_buffers={},this.m_spec=t;for(const e in t)switch(e){case"color":{const r=t.color,n=r.hasOwnProperty("width")?r.width:void 0,s=r.hasOwnProperty("height")?r.height:void 0;this.m_buffers.color=new cr(r.format,r.type,n,s)}break;case"depth":{const r=t[e],n=r.hasOwnProperty("width")?r.width:void 0,s=r.hasOwnProperty("height")?r.height:void 0;this.m_buffers[e]=new lr(r.format,n,s)}break}}toJson(){return this.m_spec}clone(){return new $e({color:this.m_spec.color?{format:this.m_spec.color.format,type:this.m_spec.color.type,width:this.m_spec.color.width,height:this.m_spec.color.height}:void 0,depth:this.m_spec.depth?{format:this.m_spec.depth.format,width:this.m_spec.depth.width,height:this.m_spec.depth.height}:void 0})}get buffers(){return this.m_buffers}set size(t){for(const e in this.m_buffers)this.m_buffers[e].size=t;this.m_state>=xt.Buffered&&(this.m_state=xt.Allocated)}doAlloc(){return y.createFramebuffer()}doFree(t){y.deleteFramebuffer(t)}doLoad(t){y.bindFramebuffer(y.FRAMEBUFFER,t),this.bindBuffers(),this.attachBuffers(),this.unbindBuffers(),y.bindFramebuffer(y.FRAMEBUFFER,null)}doBind(t){y.bindFramebuffer(y.FRAMEBUFFER,t)}doUnbind(){y.bindFramebuffer(y.FRAMEBUFFER,null)}bindBuffers(){for(const t in this.m_buffers)this.m_buffers[t].bind()}unbindBuffers(){for(const t in this.m_buffers)this.m_buffers[t].unbind()}attachBuffers(){for(const t in this.m_buffers){const e=this.m_buffers[t];switch(t){case"color":y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,e.resourceId,0);break;case"depth":y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.RENDERBUFFER,e.resourceId);break}}}readPixels(t,e,r,n,s,a,o,c){this.bind();const d=Pt.toGLFormat,v=Pt.toGLType;y.readPixels(t,e,r,n,d(s),v(a),o),this.unbind()}read(t){const r=this.m_buffers.color.size;if(r[0]<1||r[1]<1)return;const s=((o,c)=>{let d;if(window.navigator.userAgent.indexOf("android")>-1){const b=document.createElement("canvas");b.width=o,b.height=c,d=b.getContext("2d").getImageData(0,0,b.width,b.height)}else d=new ImageData(o,c);return d})(r[0],r[1]),a=new Uint8Array(s.data.length);return this.readPixels(0,0,r[0],r[1],"rgba","unsigned_byte",a,t),s.data.set(a),s}}class ue extends oe{constructor(t){super(),this.name="IBO",this.set(t)}toJson(){return{type:this.m_data instanceof Uint16Array?"Uint16Array":"Uint32Array"}}clone(){return this.m_data instanceof Uint16Array?new ue(new Uint16Array(this.m_data)):new ue(new Uint32Array(this.m_data))}set(t){this.m_data=t,this.m_state>=xt.Buffered&&(this.m_state=xt.Allocated)}doAlloc(){return y.createBuffer()}doFree(t){y.deleteBuffer(t)}doLoad(t){y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,t),y.bufferData(y.ELEMENT_ARRAY_BUFFER,this.m_data,y.STATIC_DRAW)}doBind(t){y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,t)}doUnbind(){y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,null)}}class ur extends he{constructor(t){super(),this.m_list=t}}class yn{constructor(){this.m_precision="mediump"}get precision(){return this.m_precision}set precision(t){this.m_precision=t}get source(){let t="";switch(this.m_precision){case"highp":t=`precision highp float;
`;break;case"lowp":t=`precision lowp float;
`;break;default:t=`precision mediump float;
`;break}return t}}class Cn extends Set{constructor(){super()}get source(){let t="";return this.forEach(e=>{t+="#extension "+e+` : enable
`}),t}}class hr extends Map{constructor(t){super(),this.m_name=t}get source(){let t="";return this.forEach((e,r)=>{t+=this.m_name+" "+e+" "+r+`;
`}),t}}class En extends hr{constructor(){super("attribute")}}class Sn extends hr{constructor(){super("varying")}}class An extends hr{constructor(){super("uniform")}}class Tn extends Map{constructor(){super(),this.m_name="const"}get source(){let t="";return this.forEach((e,r)=>{t+=this.m_name+" "+e.type+" "+r+" = "+e.value+`;
`}),t}}class kn extends Array{constructor(){super()}get source(){let t="";return this.forEach(e=>{t+=e+`
`}),t}}class Dr{constructor(){this.m_extensionDeclarer=new Cn,this.m_uniformQualifier=new An,this.m_varyingQualifier=new Sn,this.m_constQualifier=new Tn,this.m_functions=new kn,this.m_modified=""}attach(t){this.m_modified+=t}get source(){return""}get extensionDeclarer(){return this.m_extensionDeclarer}get uniformQualifier(){return this.m_uniformQualifier}get varyingQualifier(){return this.m_varyingQualifier}get constQualifier(){return this.m_constQualifier}get functions(){return this.m_functions}}class Mn extends Dr{constructor(){super(),this.m_attributeQualifier=new En,this.attributeQualifier.set("aVertex","vec3")}get attributeQualifier(){return this.m_attributeQualifier}get source(){let t="";return t+=this.m_extensionDeclarer.source,t+=this.m_attributeQualifier.source,t+=this.m_varyingQualifier.source,t+=this.m_uniformQualifier.source,t+=this.m_constQualifier.source,t+=this.m_functions.source,t+=`
`,t+=`void main(void) {
`,t+=`    vec4 position = vec4(aVertex, 1.0);
`,t+=this.m_modified,t+=`    gl_Position = position;
`,t+=`}
`,t}assemblePosition(){this.m_uniformQualifier.set("uModelViewProjectionMatrix","mat4"),this.m_varyingQualifier.set("vReflectDirection","vec3"),this.attach(`
                position = uModelViewProjectionMatrix * position;
            `)}assemblePositionOffset(t){this.attach(`
                position = vec4(
                position.x - float(${t[0]}),
                position.y - float(${t[1]}),
                position.z- float(${t[2]}) - 0.001,
                position.w
                );
            `)}assembleCubeTexturePosition(){this.m_uniformQualifier.set("uModelViewProjectionMatrix","mat4"),this.m_varyingQualifier.set("vReflectDirection","vec3"),this.attach(`
                vReflectDirection = normalize(position.xyz);
                position = uModelViewProjectionMatrix * position;
            `)}assembleInstancedPosition(){this.attributeQualifier.set("aModelMatrix","mat4"),this.m_uniformQualifier.set("uProjectionMatrix","mat4"),this.m_uniformQualifier.set("uViewMatrix","mat4"),this.attach(`
                position = uProjectionMatrix * uViewMatrix * aModelMatrix * position;
            `)}assembleInstancedPosition2Camera(){this.attributeQualifier.set("aModelMatrix","mat4"),this.m_uniformQualifier.set("uProjectionMatrix","mat4"),this.m_uniformQualifier.set("uViewMatrix","mat4"),this.attributeQualifier.set("aEye","vec3"),this.attributeQualifier.set("aTarget","vec3"),this.m_functions.push(`
    mat4 targetTo(vec3 eye, vec3 target, vec3 up) {
      mat4 t = mat4(1.0);
      float eyex = eye[0];
      float eyey = eye[1];
      float eyez = eye[2];
      float upx = up[0];
      float upy = up[1];
      float upz = up[2];
      float z0 = eyex - target[0];
      float z1 = eyey - target[1];
      float z2 = eyez - target[2];
      float len = z0 * z0 + z1 * z1 + z2 * z2;
      if (len > 0.0) {
        len = 1.0 / sqrt(len);
        z0 *= len;
        z1 *= len;
        z2 *= len;
      }
      float x0 = upy * z2 - upz * z1;
      float x1 = upz * z0 - upx * z2;
      float x2 = upx * z1 - upy * z0;
      len = x0 * x0 + x1 * x1 + x2 * x2;
      if (len > 0.0) {
        len = 1.0 / sqrt(len);
        x0 *= len;
        x1 *= len;
        x2 *= len;
      }
      t[0][0] = x0;
      t[0][1] = x1;
      t[0][2] = x2;
      t[0][3] = 0.0;
      t[1][0] = z1 * x2 - z2 * x1;
      t[1][1] = z2 * x0 - z0 * x2;
      t[1][2] = z0 * x1 - z1 * x0;
      t[1][3] = 0.0;
      t[2][0] = z0;
      t[2][1] = z1;
      t[2][2] = z2;
      t[2][3] = 0.0;
      t[3][0] = eyex;
      t[3][1] = eyey;
      t[3][2] = eyez;
      t[3][3] = 1.0;
      return t;
    }
    `),this.m_uniformQualifier.set("uUp","vec3"),this.attach(`
                mat4 mMat = targetTo(aEye, aTarget, uUp);
                mat4 mTransform = mMat * aModelMatrix;
                position = uProjectionMatrix * uViewMatrix * mTransform * position;
            `)}assembleInstancedPositionColor(){this.attributeQualifier.set("aModelMatrix","mat4"),this.attributeQualifier.set("aColor","vec4"),this.m_uniformQualifier.set("uProjectionMatrix","mat4"),this.m_uniformQualifier.set("uViewMatrix","mat4"),this.m_varyingQualifier.set("vColor","vec4"),this.attach(`
                position = uProjectionMatrix * uViewMatrix * aModelMatrix * position;
                vColor = aColor;
            `)}assembleFaceColor(){this.attributeQualifier.set("aColor","vec4"),this.m_uniformQualifier.set("uModelViewProjectionMatrix","mat4"),this.m_varyingQualifier.set("vColor","vec4"),this.attach(`
                position = uModelViewProjectionMatrix * position;
                vColor = aColor;
            `)}assembleDiscreteFaceColor(){this.attributeQualifier.set("aScalar","float"),this.m_uniformQualifier.set("uModelViewProjectionMatrix","mat4"),this.m_varyingQualifier.set("vScalar","float"),this.attach(`
                position = uModelViewProjectionMatrix * position;
                vScalar = aScalar;
            `)}assembleVertexColor(){this.attributeQualifier.set("aColor","vec4"),this.m_varyingQualifier.set("vColor","vec4"),this.attach(`
                vColor = aColor;
            `)}assembleViewAligned(){this.attach(`
                position = vec4(2.0 * position.x - 1.0,
                                2.0 * position.y - 1.0,
                                0.0,
                                1.0);
            `)}assemblePointSize(){this.m_uniformQualifier.set("uPointSize","float"),this.attach(`
                gl_PointSize = uPointSize;
            `)}assembleTextureCoord(){this.m_attributeQualifier.set("aTexCoord","vec2"),this.m_varyingQualifier.set("vTexCoord","vec2"),this.attach(`
                vTexCoord = aTexCoord;
            `)}assembleHeadLight(t=.3,e=.7,r=.4,n=200){this.m_uniformQualifier.set("uNormalMatrix","mat3"),this.m_attributeQualifier.set("aNormal","vec3"),this.m_varyingQualifier.set("vLightIntensity","float"),this.attach(`
                float nDotV = abs((uNormalMatrix * aNormal).z);
                vLightIntensity = float(${t}) +
                                  nDotV * float(${e}) +
                                  float(${r}) * pow(nDotV, float(${n}));
            `)}assembleNormal(){this.m_uniformQualifier.set("uNormalMatrix","mat3"),this.m_attributeQualifier.set("aNormal","vec3"),this.m_varyingQualifier.set("vNormal","vec3"),this.m_varyingQualifier.set("vOriginNormal","vec3"),this.attach(`
                vNormal = vec3(uNormalMatrix * aNormal);
                vOriginNormal = aNormal;
            `)}assembleStableNormal(){this.m_uniformQualifier.set("uNormalMatrix","mat3"),this.m_attributeQualifier.set("aNormal","vec3"),this.m_varyingQualifier.set("vNormalVS","vec3"),this.attach(`
      vNormalVS = normalize(uNormalMatrix * aNormal);
  `)}assembleInstancedNormal(){this.m_attributeQualifier.set("aNormal","vec3"),this.m_varyingQualifier.set("vNormal","vec3"),this.m_varyingQualifier.set("vOriginNormal","vec3"),this.attach(`
                vNormal = mat3(uViewMatrix * aModelMatrix) * aNormal;
                vOriginNormal = aNormal;
            `)}assembleInstancedPosition2CameraNormal(){this.m_attributeQualifier.set("aNormal","vec3"),this.m_varyingQualifier.set("vNormal","vec3"),this.m_varyingQualifier.set("vOriginNormal","vec3"),this.attach(`
                vNormal = mat3(uViewMatrix * mTransform) * aNormal;
                vOriginNormal = aNormal;
            `)}assembleDisplpacement(){this.m_uniformQualifier.set("uFactor","float"),this.m_attributeQualifier.set("aDisplacementX","float"),this.m_attributeQualifier.set("aDisplacementY","float"),this.m_attributeQualifier.set("aDisplacementZ","float"),this.attach(`
                vec3 offset = vec3(aDisplacementX, aDisplacementY, aDisplacementZ) * uFactor;
                position += vec4(offset, 0.0);
            `)}assemblePixelSize(t=100){this.m_uniformQualifier.set("uModelViewProjectionMatrix","mat4"),this.m_uniformQualifier.set("uProjectionMatrix","mat4"),this.m_uniformQualifier.set("uViewportSize","ivec2"),this.attach(`
                float factor = 2.0 * float(${t}) / float(uViewportSize.x) / uProjectionMatrix[0][0];
                mat4 scaleMatrix = mat4(mat3(factor));

                position = uModelViewProjectionMatrix * scaleMatrix * position;
            `)}CompileresultMapping(){this.m_uniformQualifier.set("uScalarRange","vec2"),this.m_attributeQualifier.set("aScalar","float"),this.m_varyingQualifier.set("vTexCoord","vec2"),this.attach(`
                float fRange = uScalarRange[1] - uScalarRange[0];
                float fTexCoord = (aScalar - uScalarRange[0]) / fRange;
                fTexCoord = clamp(fTexCoord, 0.0 , 1.0);
                vTexCoord = vec2(fTexCoord, 0.5);
            `)}CompileresultMappingByRange(){this.m_uniformQualifier.set("uScalarRange","vec2"),this.m_attributeQualifier.set("aScalar","float"),this.m_varyingQualifier.set("vTexCoord","vec2"),this.m_varyingQualifier.set("vScalar","float"),this.attach(`
                float fRange = uScalarRange[1] - uScalarRange[0];
                float fTexCoord = (aScalar - uScalarRange[0]) / fRange;
                fTexCoord = clamp(fTexCoord, 0.0 , 1.0);
                vTexCoord = vec2(fTexCoord, 0.5);
                vScalar = aScalar;
            `)}assembleInstancedResultMappingV(){this.m_uniformQualifier.set("uScalarRange","vec2"),this.m_attributeQualifier.set("aTexCoord","vec2"),this.m_attributeQualifier.set("aScalar","vec2"),this.m_varyingQualifier.set("vTexCoord","vec2"),this.attach(`
                float fRange = uScalarRange[1] - uScalarRange[0];
                float scalar = aTexCoord[1] * (aScalar[0] - aScalar[1]) + aScalar[1];
                float fTexCoord = (scalar - uScalarRange[0]) / fRange;
                fTexCoord = clamp(fTexCoord, 0.0 , 1.0);
                vTexCoord = vec2(fTexCoord, 0.5);
            `)}assembleColorByHeight(){this.m_uniformQualifier.set("uModelMatrix","mat4"),this.m_uniformQualifier.set("uModelViewProjectionMatrix","mat4"),this.m_varyingQualifier.set("height","float"),this.attach(`
                height = (uModelMatrix * position).z;
                position = uModelViewProjectionMatrix * position;
    `)}}class zn extends Dr{constructor(t=!1){super(),this.mrt=!1,this.m_precisionQualifier=new yn,this.mrt=t}get precisionQualifier(){return this.m_precisionQualifier}get source(){let t="";return t+=this.m_extensionDeclarer.source,t+=this.m_precisionQualifier.source,t+=this.m_varyingQualifier.source,t+=this.m_uniformQualifier.source,t+=this.m_constQualifier.source,t+=this.m_functions.source,t+=`
`,this.mrt?(t+=`#extension GL_EXT_draw_buffers : require
`,t+=`void main(void) {
`,t+=`    vec4 color0 = vec4(1.0);
`,t+=`    vec4 color1 = vec4(1.0);
`,t+=`    vec4 color2 = vec4(1.0);
`,t+=`    vec4 color3 = vec4(1.0);
`,t+=this.m_modified,t+=`    gl_FragData[0] = color0;
`,t+=`    gl_FragData[1] = color1;
`,t+=`    gl_FragData[2] = color2;
`,t+=`    gl_FragData[3] = color3;
`,t+=`}
`):(t+=`void main(void) {
`,t+=`    vec4 color = vec4(1.0);
`,t+=this.m_modified,t+=`    gl_FragColor = color;
`,t+=`}
`),t}assembleColor(){this.m_uniformQualifier.set("uColor","vec4"),this.attach(`
                color = uColor;
            `)}assembleFaceColor(){this.m_varyingQualifier.set("vColor","vec4"),this.attach(`
                color = vColor;
            `)}assembleDiscreteFaceColor(t,e,r){this.m_uniformQualifier.set(`discrete[${e}]`,"float"),this.m_uniformQualifier.set(`colors[${t}]`,"float"),this.m_varyingQualifier.set("vScalar","float"),this.m_functions.push(`
    vec4 getColorForValue(float scalar) {
        vec4 tempColor = vec4(0.0, 0.0, 0.0, 0.0);
        float scalarRatio = scalar/float(${r});
        if (scalarRatio < discrete[0]) {
            tempColor = vec4(colors[0], colors[1], colors[2], 1);
            return tempColor;
        }
        
        if (scalarRatio >= discrete[${e-1}]) {
            tempColor = vec4(colors[${e-1} * 3],
            colors[${e-1} * 3 + 1],
            colors[${e-1} * 3 + 2], 1);
            return tempColor;
        }
        
        for (int i = 0; i < ${e}; i++) {
            if (scalarRatio >= discrete[i] && scalarRatio < discrete[i+1]) {
                tempColor = vec4(colors[i * 3], colors[i * 3 + 1], colors[i * 3 + 2], 1);
                return tempColor;
            }
        }
        return vec4(1.0, 1.0, 1.0, 1.0);
    }`),this.attach(`
            color = getColorForValue(vScalar);
        `)}assembleDiscreteColorByRange(t,e){this.m_uniformQualifier.set(`discrete[${e}]`,"float"),this.m_uniformQualifier.set(`colors[${t}]`,"float"),this.m_varyingQualifier.set("vScalar","float"),this.m_functions.push(`
    vec4 getColorForValue(float scalar) {
        vec4 tempColor = vec4(0.0, 0.0, 0.0, 0.0);
        if (scalar < discrete[0]) {
            tempColor = vec4(colors[0], colors[1], colors[2], 1);
            return tempColor;
        }
        
        if (scalar > discrete[${e-1}]) {
            tempColor = vec4(colors[${e-1} * 3],
            colors[${e-1} * 3 + 1],
            colors[${e-1} * 3 + 2], 1);
            return tempColor;
        }
        
        for (int i = 0; i < ${e}; i++) {
            if (scalar > discrete[i] && scalar < discrete[i+1]) {
                tempColor = vec4(colors[(i + 1) * 3], colors[(i + 1) * 3 + 1], colors[(i + 1) * 3 + 2], 1);
                return tempColor;
            }
        }
        return vec4(1.0, 1.0, 1.0, 1.0);
    }`),this.attach(`
            color = getColorForValue(vScalar);
        `)}assembleTransparentDiscreteColorByRange(t,e){this.m_uniformQualifier.set(`discrete[${e}]`,"float"),this.m_uniformQualifier.set(`colors[${t}]`,"float"),this.m_varyingQualifier.set("vScalar","float"),this.m_functions.push(`
    vec4 getColorForValue(float scalar) {
        vec4 tempColor = vec4(0.0, 0.0, 0.0, 0.0);
        if (scalar <= discrete[0]) {
            discard;
        }
        
        if (scalar > discrete[${e-1}]) {
            tempColor = vec4(colors[${e-1} * 3],
            colors[${e-1} * 3 + 1],
            colors[${e-1} * 3 + 2], 1.0);
            return tempColor;
        }
        
        for (int i = 0; i < ${e-1}; i++) {
            if (scalar > discrete[i] && scalar <= discrete[i+1]) {
                tempColor = vec4(colors[i * 3], colors[i * 3 + 1], colors[i * 3 + 2], 1.0);
                return tempColor;
            }
        }
        return vec4(1.0, 1.0, 1.0, 1.0);
    }`),this.attach(`
            color = getColorForValue(vScalar);
        `)}assembleTransparentColorbyRange(t){this.m_uniformQualifier.set("uColor","vec4"),this.m_varyingQualifier.set("vScalar","float"),this.attach(`
    if (vScalar < ${t}) {
        discard;
    }
    else{
        color = uColor;
    }
    `)}assembleInstancedColor(){this.m_varyingQualifier.set("vColor","vec4"),this.attach(`
                color = vColor;
            `)}assembleDilation(){this.m_uniformQualifier.set("uId0","int"),this.m_uniformQualifier.set("uId","int"),this.m_uniformQualifier.set("uResolution","vec2"),this.m_uniformQualifier.set("uSampler","sampler2D"),this.m_functions.push(`
    int color2Id(int r, int g, int b, int a) {
      return r + g * 256 + b * 256 * 256 + a * 256 * 256 * 256;
    }
    int v4Color2Id(vec4 color) {
      vec4 tmpColor = color * 256.0;
      int id = color2Id(int(tmpColor.r), int(tmpColor.g), int(tmpColor.b), int(tmpColor.a));
      return id;
    }`),this.attach(`
      color = texture2D(uSampler, gl_FragCoord.xy / uResolution.xy);
      int id0 = int(color.a * 256.0);
      if (dot(vec4(1.0, 1.0, 1.0, 1.0), color) == 0.0 || (id0 >= uId0 && id0 < uId)) {
        for (int i = -2; i <= 2; i++) {
          for (int j = -2; j <= 2; j++) {
            if (i != 0 || j != 0) {
              vec4 colorTmp = texture2D(uSampler, (gl_FragCoord.xy + vec2(i, j)) / uResolution);
              int id = int(colorTmp.a * 256.0);
              if (id >= uId) {
                color = colorTmp;
              }
            }
          }
        }
      }
    `)}assembleTexture(){this.m_uniformQualifier.set("uSampler","sampler2D"),this.m_varyingQualifier.set("vTexCoord","vec2"),this.attach(`
                color = texture2D(uSampler, vTexCoord);
            `)}assembleTextureByLowValue(t){this.m_uniformQualifier.set("uSampler","sampler2D"),this.m_varyingQualifier.set("vTexCoord","vec2"),this.m_varyingQualifier.set("vScalar","float"),this.attach(`
                if(vScalar < ${t}){
                  discard;
                }
                else{
                  color = texture2D(uSampler, vTexCoord);
                }

            `)}assembleDiscreteTexture(){this.m_uniformQualifier.set("uSampler","sampler2D"),this.m_uniformQualifier.set("uScalarRange","vec2"),this.m_varyingQualifier.set("vScalar","float"),this.attach(`
                float fRange = uScalarRange[1] - uScalarRange[0];
                float fTexCoord = (vScalar - uScalarRange[0]) / fRange;
                fTexCoord = clamp(fTexCoord, 0.0 , 1.0);
                vec2 vTexCoord = vec2(fTexCoord, 0.5);
                color = texture2D(uSampler, vTexCoord);
            `)}assembleLightIntensity(){this.m_varyingQualifier.set("vLightIntensity","float"),this.attach(`
                color = vec4(color.xyz * vLightIntensity, 1.0);
            `)}assembleHeadLight(t=.3,e=.7,r=.4,n=200){this.m_varyingQualifier.set("vNormal","vec3"),this.attach(`
                vec3 normal = normalize(vNormal);
                float nDotV = abs(normal.z);
                float lightIntensity = float(${t}) + nDotV * float(${e}) +
                float(${r}) * pow(nDotV, float(${n}));
                color = vec4(color.xyz * lightIntensity, 1.0);
            `)}assembleTransparent(t=.5,e=.3){this.attach(`
                color = vec4(color.rgb * float(${t}), float(${e}));
            `)}assembleTransparentWithoutLight(){this.m_uniformQualifier.set("transparency","float"),this.attach(`
                color = vec4(color.rgb, float(transparency));
            `)}assembleStableLight(t=.3,e=.7,r=.4,n=200){this.m_uniformQualifier.set("uLightDir","vec3"),this.m_varyingQualifier.set("vNormalVS","vec3"),this.attach(`
    vec3 N = normalize(vNormalVS);
    vec3 L = normalize(uLightDir);

    float NdotL = max(dot(N, L), 0.0);

    // Blinn-Phong (view dir = (0,0,1) in view space)
    vec3 V = vec3(0.0, 0.0, 1.0);
    vec3 H = normalize(L + V);
    float NdotH = max(dot(N, H), 0.0);

    float diffuse = float(${e}) * NdotL;
    float specular = float(${r}) * pow(NdotH, float(${n}));
    float ambient = float(${t});

    float intensity = ambient + diffuse + specular;

    color = vec4(color.rgb * intensity, color.a);
  `)}assembleCubeTexture(){this.m_uniformQualifier.set("uSampler","samplerCube"),this.m_varyingQualifier.set("vReflectDirection","vec3"),this.attach(`
                color = textureCube(uSampler, vReflectDirection);
            `)}assembleTransparentClip(t=.1){this.attach(`
                if (color.a < float(${t}))
                    discard;
            `)}assembleZBuffer(){this.attach(`
                float v = gl_FragCoord.z;

                vec4 res =  vec4(0.0);
                float comp;

                comp = floor(min(v * 256.0, 255.0));
                res.x = comp / 255.0;
                v -= comp / 256.0;
                v *= 256.0;

                comp = floor(min(v * 256.0, 255.0));
                res.y = comp / 255.0;
                v -= comp / 256.0;
                v *= 256.0;

                comp = floor(min(v * 256.0, 255.0));
                res.z = comp / 255.0;
                v -= comp / 256.0;
                v *= 256.0;

                res.w = v;

                color = res;
            `)}assembleDiscClip(){this.attach(`
                vec2 coord = gl_PointCoord * 2.0 - vec2(1.0);
                if (dot(coord, coord) > 1.0)
                    discard;
            `)}assembleSphere(){this.assembleDiscClip(),this.attach(`
                float dist = distance(gl_PointCoord, vec2(0.5));
                float fNDotV = sqrt(1.0 - dist * dist / 0.25);
                color = vec4(color.xyz * fNDotV, 1.0);
            `)}assembleNormal(){this.m_varyingQualifier.set("vNormal","vec3"),this.m_varyingQualifier.set("vOriginNormal","vec3"),this.m_functions.push(`
    vec4 float2color(float v) {
      vec4 res =  vec4(0.0);
      float comp;

      comp = floor(min(v * 256.0, 255.0));
      res.x = comp / 255.0;
      v -= comp / 256.0;
      v *= 256.0;

      comp = floor(min(v * 256.0, 255.0));
      res.y = comp / 255.0;
      v -= comp / 256.0;
      v *= 256.0;

      comp = floor(min(v * 256.0, 255.0));
      res.z = comp / 255.0;
      v -= comp / 256.0;
      v *= 256.0;

      res.w = v;
      return res;
    }`),this.attach(`
        vec3 normal = normalize(vOriginNormal);
        normal = normal * 0.5 + 0.5;
        color0 = vec4(normal, 1.0);
        color1 = float2color(normal.x);
        color2 = float2color(normal.y);
        color3 = float2color(normal.z);
    `)}assembleColorByHeight(t,e){this.m_varyingQualifier.set("height","float"),this.m_uniformQualifier.set(`heights[${t}]`,"float"),this.m_uniformQualifier.set(`colors[${e}]`,"float"),this.attach(`
        // vec3 tempColors[3];
        color = vec4(1.,1.,1.,1.);
        for (int i = 0; i < ${t} / 2; i++) {
          if (height > heights[i * 2] && height < heights[i * 2 + 1]) {
            vec3 tempColor = vec3(colors[i * 3], colors[i * 3 + 1], colors[i * 3 + 2]);
            color = vec4(tempColor, 1.0);
            break;
          }
        }

        // tempColors[${t}] = vec3(colors[${e} - 3], colors[${e} - 2], colors[${e} - 1]);
        // if (height >= heights[${t-1}]) {
        //   color = vec4(tempColors[${t}], 1.0);
        // }
    `)}}class it extends he{constructor(t,e){super(),this.set(t,e)}toJson(){let t;typeof this.m_value=="number"&&(t=this.m_value),(this.m_value instanceof Int32Array||this.m_value instanceof Float32Array)&&(t=Array.prototype.slice.call(this.m_value));let e="number";return t instanceof Int32Array&&(e="Int32Array"),t instanceof Float32Array&&(e="Float32Array"),{name:this.m_name,type:e,value:t}}set(t,e){this.m_name=t,typeof e=="number"?this.m_value=e:(e instanceof Int32Array||e instanceof Float32Array)&&(this.m_value=e)}get name(){return this.m_name}get value(){return this.m_value}bind(){const t=this.findUniformInfo();t&&it.setValue(t.type,t.location,this.m_value)}findUniformInfo(){return re.current().uniformLocations[this.m_name]}static setValue(t,e,r){switch(t){case y.BOOL:case y.INT:case y.SAMPLER_2D:case y.SAMPLER_CUBE:typeof r=="number"?y.uniform1i(e,r):y.uniform1iv(e,r);break;case y.BOOL_VEC2:case y.INT_VEC2:y.uniform2iv(e,r);break;case y.BOOL_VEC3:case y.INT_VEC3:y.uniform3iv(e,r);break;case y.BOOL_VEC4:case y.INT_VEC4:y.uniform4iv(e,r);break;case y.FLOAT:typeof r=="number"?y.uniform1f(e,r):y.uniform1fv(e,r);break;case y.FLOAT_VEC2:y.uniform2fv(e,r);break;case y.FLOAT_VEC3:y.uniform3fv(e,r);break;case y.FLOAT_VEC4:y.uniform4fv(e,r);break;case y.FLOAT_MAT2:y.uniformMatrix2fv(e,!1,r);break;case y.FLOAT_MAT3:y.uniformMatrix3fv(e,!1,r);break;case y.FLOAT_MAT4:y.uniformMatrix4fv(e,!1,r)}}clone(){return this.m_value instanceof Int32Array?new it(this.m_name,new Int32Array(this.m_value)):this.m_value instanceof Float32Array?new it(this.m_name,new Float32Array(this.m_value)):new it(this.m_name,this.m_value)}}class ee extends ze{constructor(){super()}clone(){const t=new ee;return this.forEach(e=>{t.push(e.clone())}),t}}class We extends ee{constructor(){super(),this.m_dirty=!0,this.m_modelMatrix=ht(),this.m_viewMatrix=ht(),this.m_projectionMatrix=ht(),this.m_viewportSize=new Int32Array([100,100]),this.m_modelViewMatrix=ht(),this.m_modelViewProjectionMatrix=ht(),this.m_normalMatrix=Ue(),this.m_orbitPoint=et(),this.add(new it("uModelMatrix",this.m_modelMatrix)),this.add(new it("uViewMatrix",this.m_viewMatrix)),this.add(new it("uModelViewMatrix",this.m_modelViewMatrix)),this.add(new it("uProjectionMatrix",this.m_projectionMatrix)),this.add(new it("uModelViewProjectionMatrix",this.m_modelViewProjectionMatrix)),this.add(new it("uNormalMatrix",this.m_normalMatrix)),this.add(new it("uViewportSize",this.m_viewportSize))}toString(){return"viewportSize="+this.viewportSize+", orbitPoint="+this.m_orbitPoint+", modelMatrix="+this.modelMatrix+", viewMatrix="+this.viewMatrix+", projectionMatrix="+this.projectionMatrix}get modelMatrix(){return $t(this.m_modelMatrix)}set modelMatrix(t){ce(this.m_modelMatrix,t),this.m_dirty=!0}get viewMatrix(){return $t(this.m_viewMatrix)}set viewMatrix(t){ce(this.m_viewMatrix,t),this.m_dirty=!0}get projectionMatrix(){return $t(this.m_projectionMatrix)}set projectionMatrix(t){ce(this.m_projectionMatrix,t),this.m_dirty=!0}get modelViewProjectionMatrix(){return $t(this.m_modelViewProjectionMatrix)}get viewportSize(){return[this.m_viewportSize[0],this.m_viewportSize[1]]}set viewportSize(t){this.m_viewportSize[0]=t[0],this.m_viewportSize[1]=t[1],At.setAspect(this.m_projectionMatrix,t[0]/t[1]),this.m_dirty=!0}get orbitPoint(){return St(this.m_orbitPoint)}set orbitPoint(t){le(this.m_orbitPoint,t)}update(){if(!this.m_dirty)return;this.m_dirty=!1,br(this.m_modelViewMatrix,this.m_viewMatrix,this.m_modelMatrix),br(this.m_modelViewProjectionMatrix,this.m_projectionMatrix,this.m_modelViewMatrix);const t=Ue();en(t,this.m_modelViewMatrix),nn(t,t),rn(t,t),vr(this.m_normalMatrix,t)}clone(){const t=new We;return t.modelMatrix=this.modelMatrix,t.viewMatrix=this.viewMatrix,t.projectionMatrix=this.projectionMatrix,t.viewportSize=this.viewportSize,ce(t.m_modelViewMatrix,this.m_modelViewMatrix),ce(t.m_modelViewProjectionMatrix,this.modelViewProjectionMatrix),vr(t.m_normalMatrix,this.m_normalMatrix),t.orbitPoint=this.orbitPoint,t}}class fr{constructor(){this.viewport=new kr,this.builtInUniforms=new We,this.range=new Ct,this.viewportSize=[100,100]}copy(t){this.viewport=t.viewport,this.builtInUniforms=t.builtInUniforms,this.range.copy(t.range)}clone(){const t=new fr;return t.copy(this),t}forEach(t){t(this.viewport),this.builtInUniforms.forEach(e=>{t(e)})}push(t){if(t instanceof kr){this.viewport=t;return}if(t instanceof We){this.builtInUniforms=t;return}}get viewportSize(){return this.viewport.size}set viewportSize(t){this.viewport.size=t,this.builtInUniforms.viewportSize=t}}class se{constructor(t="Effect"){this.shaders=new Qe,this.uniforms=new ee,this.states=new Ot,this.type="Effect",this.name="Effect",this.name=t,this.shaders.name=t}forEach(t){this.states.forEach(e=>{t(e)}),this.uniforms.forEach(e=>{t(e)}),this.shaders.forEach(e=>{t(e)})}clone(){const t=new se;return t.shaders=this.shaders,t.uniforms=this.uniforms.clone(),t.states=this.states,t}cloneUniform(t){const e=new se;return e.shaders=this.shaders,e.uniforms=new ee,this.uniforms.forEach(r=>{const n=r.clone();e.uniforms.push(n),t.set(r.name,n)}),e.states=this.states,e}updateUniform(t,e){for(let r of this.uniforms)r.name==t&&r.set(t,e)}push(t){if(t instanceof mr){this.shaders.push(t);return}if(t instanceof Qe){this.shaders=t;return}if(t instanceof it){this.uniforms.push(t);return}if(t instanceof ee){this.uniforms=t;return}if(t instanceof we){this.states.push(t);return}if(t instanceof Ot){this.states=t;return}}}se.type="Effect";class Gt{get vbos(){return this.g_vbos}set vbos(t){this.g_vbos=t}constructor(){this.g_vbos=new Me,this.drawers=new ke,this.type="Geometry"}forEach(t){this.vbos.forEach(e=>{t(e)}),this.drawers.forEach(e=>{t(e)})}push(t){if(t instanceof It){this.vbos.push(t);return}if(t instanceof ue){this.vbos.push(t);return}if(t instanceof Me){this.vbos=t;return}if(t instanceof He){this.drawers.push(t);return}if(t instanceof ke){this.drawers=t;return}}clone(){const t=new Gt;return t.vbos=this.vbos.clone(),t.drawers=this.drawers.clone(),t}}Gt.type="Geometry";class Ur extends Gt{constructor(t,e=1,r=!1,n=[0,0,1]){super(),this.type="RodGeometry",this.m_vbos=new Me;const s=[];if(r){for(let a=0;a<e;a++){const o=-t*.5+a*t/e,c=-t*.5+(a+1)*t/e;s.push([o*n[0],o*n[1],o*n[2]],[c*n[0],c*n[1],c*n[2]])}this.setPoints(s);return}for(let a=0;a<=e;a++){const o=-t*.5+a*t/e;s.push([o*n[0],o*n[1],o*n[2]])}this.setPoints(s)}setPoints(t){const e=[];t.forEach(n=>{e.push(...n)});const r=new Float32Array(e);return this.vboVertex&&this.vbos.delete(this.vboVertex),this.vboVertex=new It("aVertex",3,r),this.vbos.push(this.vboVertex),this}getPoints(){const t=this.vboVertex.data,e=[],r=t.length/3-1;return e.push([t[0],t[1],t[2]],[t[r*3],t[r*3+1],t[r*3+2]]),e}get length(){const t=this.getPoints();return Te(t[0],t[1])}get center(){const t=this.getPoints(),e=et();return dt(e,t[0],t[1]),Ae(e,e,.5),e}push(t){if(t instanceof It){this.vbos.push(t);return}if(t instanceof He){this.drawers.push(t);return}}}class Vt{constructor(t=null){this.type="Drawable",this.name="drawable",this.visible=!0,this.geometry=new Gt,this.effect=new se,this.priority=0,this.m_tbo=void 0,t||(t=new yt),this.m_tbo||(this.m_tbo=new ni(t,this)),this.m_tbo.transform=t,this.m_tbo.transformWorld=t}get tbo(){return this.m_tbo}get transform(){return this.m_tbo.transform}get parent(){return this.m_parent}set parent(t){this.m_parent=t}forEach(t){this.geometry.forEach(t),this.effect.forEach(t)}push(t){if(t){if(t instanceof se)return this.effect=t,!0;if(t instanceof Gt)return this.geometry=t,!0;this.effect.push(t),this.geometry.push(t)}}clone(){const t=new Vt(this.tbo.transform.clone());return t.push(this.effect.clone()),t.push(this.geometry.clone()),t}get boundingBox(){return this.m_boundingBox||this.computeBoundingBox(),this.m_boundingBox}computeBoundingBox(t="aVertex"){this.m_boundingBox||(this.m_boundingBox=new Ut);let e=Ar(this,t);return e&&(this.m_boundingBox.expandByVBO(e),this.m_boundingBox.transform(this.transform.matrix)),this.m_boundingBox}dispose(){const t=this.parent.drawables.indexOf(this);t!==-1&&(this.parent.drawables.splice(t,1),this.parent=null),te(this)}raycast({ray:t,backfaceCulling:e=!0,updateWorld:r=!0,intersectionTolerance:n}){const s=Ar(this);if(!s)return;r&&this.tbo.updateMatrixWorld();const a=this.tbo.transformWorld.matrix,o=me(ht(),a),c=t.clone().applyMatrix4(o),d=this.geometry.vbos.ibo,v=[];return d?this.geometry.drawers.forEach(_=>{_ instanceof Ie?this.rayCastIbo(_,c,s,d,a,e,n,v):this.rayCastVbo(_,c,s,a,e,n,v)}):this.geometry.drawers.forEach(_=>{_ instanceof pe&&this.rayCastVbo(_,c,s,a,e,n,v)}),v}rayCastIbo(t,e,r,n,s,a,o,c){const d=n.data,v=r.data,_=t.offset,b=t.count;if(t.mode.includes("triangle"))for(let f=_,m=b;f<m;f+=3){const l=d[f],p=d[f+1],g=d[f+2],x=[v[l*3],v[l*3+1],v[l*3+2]],w=[v[p*3],v[p*3+1],v[p*3+2]],A=[v[g*3],v[g*3+1],v[g*3+2]];let R=e.intersectTriangle(x,w,A,a);if(!R)continue;const F={point:jt(R.point,s),part:this.parent,drawable:this,distance:R.distance,mode:"triangle",va:x,vb:w,vc:A,index:[l,p,g],baryCoords:R.baryCoords,attributes:{}};this.geometry.vbos.forEach(L=>{if(L.name==="aVertex")return;const j=L.data,B=L.size;if(j.length<Math.max(l,p,g)*B)return;const Q=L.name;let X,T=[],U=[];for(let u=0;u<B;u++)U[u]=K(j[l*B+u],j[p*B+u],j[g*B+u]),T[u]=_t(R.baryCoords,U[u]);switch(B){case 1:X=T[0];break;case 2:X=Wt(T[0],T[1]);break;case 3:X=K(T[0],T[1],T[2]);break;case 4:X=fe(T[0],T[1],T[2],T[3]);break}F.attributes[Q]=X}),c.push(F)}if(t.mode.includes("line"))for(let f=_;f<b;f+=2){const m=d[f],l=d[f+1],p=[v[m*3],v[m*3+1],v[m*3+2]],g=[v[l*3],v[l*3+1],v[l*3+2]],x=et();Tt(x,g,p);const w=Rt(et(),e.direction,x);wt(w,w);const A=Tt(et(),e.origin,p);if(Math.abs(_t(A,w))>o)continue;const F=Tt(et(),g,p),L=e.direction,j=_t(F,L),B=_t(F,F),Q=_t(L,L),X=Tt(et(),p,e.origin),T=_t(X,L),U=_t(X,F);let u=j*T-U*Q,W=T*B-j*U;if(u<0||W<0||(u=u/(B*Q-j*j),W=W/(B*Q-j*j),u>1))continue;const C=e.at(W,et()),S={point:jt(C,s),part:this.parent,drawable:this,distance:W,mode:"line",va:p,vb:g,index:[m,l],baryCoords:Wt(1-u,u),attributes:{}};this.geometry.vbos.forEach(I=>{if(I.name==="aVertex")return;const P=I.data,N=I.size;if(P.length<Math.max(m,l)*N)return;const k=I.name;let M,Z=[],$=[];for(let H=0;H<N;H++)$[H]=Wt(P[m*N+H],P[l*N+H]),Z[H]=xr(Wt(1-u,u),$[H]);switch(N){case 1:M=Z[0];break;case 2:M=Wt(Z[0],Z[1]);break;case 3:M=K(Z[0],Z[1],Z[2]);break;case 4:M=fe(Z[0],Z[1],Z[2],Z[3]);break}S.attributes[k]=M}),c.push(S)}if(t.mode.includes("point"))for(let f=_;f<b;f++){const m=d[f],l=[v[m*3],v[m*3+1],v[m*3+2]],p=Tt(et(),l,e.origin),g=Rt(et(),e.direction,p);if(zt(g)>o)continue;const w=_t(p,e.direction),A={point:jt(l,s),part:this.parent,drawable:this,distance:w,mode:"point",va:l,index:[m],attributes:{}};this.geometry.vbos.forEach(R=>{if(R.name==="aVertex")return;const F=R.data,L=R.size;if(F.length<(m+1)*L)return;const j=R.name;let B,Q=[];for(let X=0;X<L;X++)Q[X]=F[m*L+X];switch(L){case 1:B=Q[0];break;case 2:B=Wt(Q[0],Q[1]);break;case 3:B=K(Q[0],Q[1],Q[2]);break;case 4:B=fe(Q[0],Q[1],Q[2],Q[3]);break}A.attributes[j]=B}),c.push(A)}}rayCastVbo(t,e,r,n,s,a,o){const c=r.data;if(t.mode.includes("triangle")){const d=t.first,v=t.count/3;for(let _=d,b=v;_<b;_++){const f=[c[_*9],c[_*9+1],c[_*9+2]],m=[c[_*9+3],c[_*9+4],c[_*9+5]],l=[c[_*9+6],c[_*9+7],c[_*9+8]],p=e.intersectTriangle(f,m,l,s);if(!p)continue;const g={point:jt(p.point,n),part:this.parent,drawable:this,distance:p.distance,mode:"triangle",va:f,vb:m,vc:l,index:[_*3,_*3+1,_*3+2],baryCoords:p.baryCoords,attributes:{}};this.geometry.vbos.forEach(x=>{if(x.name==="aVertex")return;const w=x.data,A=x.size;if(w.length<(_*3+3)*A)return;const R=x.name;let F,L=[],j=[];for(let B=0;B<A;B++)j[B]=K(w[_*3*A+B],w[(_*3+1)*A+B],w[(_*3+2)*A+B]),L[B]=_t(p.baryCoords,j[B]);switch(A){case 1:F=L[0];break;case 2:F=Wt(L[0],L[1]);break;case 3:F=K(L[0],L[1],L[2]);break;case 4:F=fe(L[0],L[1],L[2],L[3]);break}g.attributes[R]=F}),o.push(g)}}if(t.mode.includes("line")){const d=t.first,v=t.count/2;for(let _=d;_<v;_++){const b=[c[_*6],c[_*6+1],c[_*6+2]],f=[c[_*6+3],c[_*6+4],c[_*6+5]],m=et();Tt(m,f,b);const l=Rt(et(),e.direction,m);wt(l,l);const p=Tt(et(),e.origin,b);if(Math.abs(_t(p,l))>a)continue;const x=Tt(et(),f,b),w=e.direction,A=_t(x,w),R=_t(x,x),F=_t(w,w),L=Tt(et(),b,e.origin),j=_t(L,w),B=_t(L,x);let Q=A*j-B*F,X=j*R-A*B;if(Q<0||X<0||(Q=Q/(R*F-A*A),X=X/(R*F-A*A),Q>1))continue;const T=e.at(X,et()),U={point:jt(T,n),part:this.parent,drawable:this,distance:X,mode:"line",va:b,vb:f,index:[_*2,_*2+1],baryCoords:Wt(1-Q,Q),attributes:{}};this.geometry.vbos.forEach(u=>{if(u.name==="aVertex")return;const W=u.data,C=u.size;if(W.length<(_*2+2)*C)return;const S=u.name;let I,P=[],N=[];for(let k=0;k<C;k++)N[k]=Wt(W[_*2*C+k],W[(_*2+1)*C+k]),P[k]=xr(Wt(1-Q,Q),N[k]);switch(C){case 1:I=P[0];break;case 2:I=Wt(P[0],P[1]);break;case 3:I=K(P[0],P[1],P[2]);break;case 4:I=fe(P[0],P[1],P[2],P[3]);break}U.attributes[S]=I}),o.push(U)}}if(t.mode.includes("point")){const d=t.first,v=t.count;for(let _=d;_<v;_++){const b=[c[_*3],c[_*3+1],c[_*3+2]],f=Tt(et(),b,e.origin),m=Rt(et(),e.direction,f);if(zt(m)>a)continue;const p=_t(f,e.direction),g={point:jt(b,n),part:this.parent,drawable:this,distance:p,mode:"point",va:b,index:[_],attributes:{}};this.geometry.vbos.forEach(x=>{if(x.name==="aVertex")return;const w=x.data,A=x.size;if(w.length<(_+1)*A)return;const R=x.name;let F,L=[];for(let j=0;j<A;j++)L[j]=w[_*A+j];switch(A){case 1:F=L[0];break;case 2:F=Wt(L[0],L[1]);break;case 3:F=K(L[0],L[1],L[2]);break;case 4:F=fe(L[0],L[1],L[2],L[3]);break}g.attributes[R]=F}),o.push(g)}}}}Vt.type="Drawable";class pt{constructor(t=!1){this.m_uniforms=new ee,this.m_states=new Ot,this.isTransparent=!1,this.m_vertexCompiler=new Mn,this.m_fragmentCompiler=new zn(t)}get vertexCompiler(){return this.m_vertexCompiler}get fragmentCompiler(){return this.m_fragmentCompiler}get uniforms(){return this.m_uniforms}get states(){return this.m_states}generate(t=!1){const e=new Xe(this.m_vertexCompiler.source),r=new qe(this.m_fragmentCompiler.source);t&&(console.log(e.source),console.log(r.source));const n=new se;return n.push(e),n.push(r),n.push(this.m_uniforms),n.push(this.m_states),n.shaders.isTransparent=this.isTransparent,n}}const Zt=new Xt(.5,.7,.9,1);var je;(function(i){i[i.Fast=0]="Fast",i[i.Stable=1]="Stable"})(je||(je={}));class vt{constructor(){}static createColor(t=Zt,e=!0){const r=new pt;return r.vertexCompiler.assemblePosition(),r.fragmentCompiler.assembleColor(),r.uniforms.add(new it("uColor",t.toRgbaArray())),e===!0&&r.states.add(new ut(!0)),r}static createDilationColor(t,e,r,n,s){const a=new pt;return a.vertexCompiler.assemblePosition(),a.fragmentCompiler.assembleDilation(),a.uniforms.add(new it("uId0",e)),a.uniforms.add(new it("uId",r)),a.uniforms.add(new it("uResolution",n)),a.uniforms.add(new it("uSampler",s)),a.states.add(new Nt(t,mt.Default)),a.states.add(new ut(!0)),a}static createFaceColor(){const t=new pt;return t.vertexCompiler.assembleFaceColor(),t.fragmentCompiler.assembleFaceColor(),t.states.add(new ut(!0)),t}static createDiscreteFaceColor(t,e,r){const n=new pt;n.vertexCompiler.assembleDiscreteFaceColor(),n.fragmentCompiler.assembleDiscreteFaceColor(t.length*3,e.length,Number(r[1])-Number(r[0]));const s=[];return t.forEach(a=>{s.push(...a.toRgbArray())}),n.uniforms.add(new it("colors",new Float32Array(s))),n.uniforms.add(new it("discrete",new Float32Array(e))),n.states.add(new ut(!0)),n}static createDiscreteColorByRange(t,e){const r=new pt;r.vertexCompiler.assembleDiscreteFaceColor(),r.fragmentCompiler.assembleDiscreteColorByRange(t.length*3,e.length);const n=[];return t.forEach(s=>{n.push(...s.toRgbArray())}),r.uniforms.add(new it("colors",new Float32Array(n))),r.uniforms.add(new it("discrete",new Float32Array(e))),r.states.add(new ut(!0)),r}static createTransparentDiscreteColorByRange(t,e){const r=new pt;r.vertexCompiler.assembleDiscreteFaceColor(),r.fragmentCompiler.assembleTransparentDiscreteColorByRange(t.length*3,e.length);const n=[];return t.forEach(s=>{n.push(...s.toRgbArray())}),r.uniforms.add(new it("colors",new Float32Array(n))),r.uniforms.add(new it("discrete",new Float32Array(e))),r}static createInstancedColor(){const t=new pt;return t.vertexCompiler.assembleInstancedPositionColor(),t.fragmentCompiler.assembleInstancedColor(),t.states.add(new ut(!0)),t}static createInstancedLightColor(t=Zt,e=!0,r=.3,n=.7,s=.4,a=200){const o=vt.createInstancedColor();return e?(o.vertexCompiler.assembleNormal(),o.fragmentCompiler.assembleHeadLight(r,n,s,a)):(o.vertexCompiler.assembleHeadLight(r,n,s,a),o.fragmentCompiler.assembleLightIntensity()),o}static createInstancedLightColor2Camera(t=Zt,e=!0,r=.3,n=.7,s=.4,a=200,o){const c=new pt;return c.vertexCompiler.assembleInstancedPosition2Camera(),c.fragmentCompiler.assembleColor(),c.uniforms.add(new it("uColor",t.toRgbaArray())),c.uniforms.push(o),c.states.add(new ut(!0)),e?(c.vertexCompiler.assembleNormal(),c.fragmentCompiler.assembleHeadLight(r,n,s,a)):(c.vertexCompiler.assembleHeadLight(r,n,s,a),c.fragmentCompiler.assembleLightIntensity()),c}static createVertexLightColor(t=Zt,e=.3,r=.7,n=.4,s=200){const a=vt.createColor(t);return a.vertexCompiler.assembleHeadLight(e,r,n,s),a.fragmentCompiler.assembleLightIntensity(),a}static createFragmentLightColor(t=Zt,e=.3,r=.7,n=.4,s=200,a=!0){const o=vt.createColor(t,a);return o.vertexCompiler.assembleNormal(),o.fragmentCompiler.assembleHeadLight(e,r,n,s),o}static createLightColor(t=Zt,e=!0,r=.3,n=.7,s=.4,a=200,o=!0){const c=vt.createColor(t,o);return e?(c.vertexCompiler.assembleNormal(),c.fragmentCompiler.assembleHeadLight(r,n,s,a)):(c.vertexCompiler.assembleHeadLight(r,n,s,a),c.fragmentCompiler.assembleLightIntensity()),c}static createTransparentColor(t=Zt,e=.3,r=.7,n=.4,s=200,a=.5,o=.5){const c=vt.createFragmentLightColor(t,e,r,n,s);return c.fragmentCompiler.assembleTransparent(a,o),c.states.add(new Bt(!0)),c.states.add(new ut(!0,"less",!1)),c.isTransparent=!0,c}static createTexture(t){const e=new pt;return e.vertexCompiler.assemblePosition(),e.vertexCompiler.assembleTextureCoord(),e.fragmentCompiler.assembleTexture(),e.states.add(new ut(!0)),e.states.add(new Nt(t,mt.Default,0)),e.uniforms.push(new it("uSampler",0)),e}static createCubeTexture(t,e=.6,r=.7){const n=new pt;return n.vertexCompiler.assembleCubeTexturePosition(),n.vertexCompiler.assembleTextureCoord(),n.fragmentCompiler.assembleCubeTexture(),n.states.add(new Nt(t,mt.Default)),n.uniforms.push(new it("uSampler",0)),n.fragmentCompiler.assembleTransparent(e,r),n}static createCoordTexture(t,e=.7){const r=new pt;return r.vertexCompiler.assembleCubeTexturePosition(),r.vertexCompiler.assembleTextureCoord(),r.fragmentCompiler.assembleCubeTexture(),r.states.add(new Nt(t,mt.Default)),r.uniforms.push(new it("uSampler",0)),r.fragmentCompiler.attach(`
      color = vec4(color.rgb, float(${e}));
      `),r}static createLightTexture(t,e=je.Fast,r=.3,n=.7,s=.4,a=200){return e===je.Fast?this.createFastLightTexture(t,r,n,s,a):this.createStableLightTexture(t,r,n,s,a)}static createFastLightTexture(t,e=.3,r=.7,n=.4,s=200){const a=vt.createTexture(t);return a.vertexCompiler.assembleNormal(),a.fragmentCompiler.assembleHeadLight(e,r,n,s),a}static createStableLightTexture(t,e=.3,r=.7,n=.4,s=200){const a=vt.createTexture(t);return a.vertexCompiler.assembleStableNormal(),a.fragmentCompiler.assembleStableLight(e,r,n,s),a}static createTransparentTexture(t,e=.3,r=.7,n=.4,s=200,a=.5,o=.5){const c=vt.createLightTexture(t,e,r,n,s);c.fragmentCompiler.assembleTransparent(a,o);const d=new ut(!0,"less",!1);return c.states.add(new Bt(!0)),c.states.add(d),c.isTransparent=!0,c}static createResultMapping(t,e=new Ct(0,1)){const r=new pt;return r.vertexCompiler.assemblePosition(),r.vertexCompiler.CompileresultMapping(),r.fragmentCompiler.assembleTexture(),r.states.add(new ut(!0)),r.states.add(new Nt(t,mt.Default)),r.uniforms.push(new it("uSampler",0)),r.uniforms.push(new it("uScalarRange",e.toArray())),r}static createResultMappingAligned(t,e=new Ct(0,1)){const r=new pt;return r.vertexCompiler.assemblePosition(),r.vertexCompiler.CompileresultMapping(),r.fragmentCompiler.assembleTexture(),r.states.add(new ut(!0)),r.states.add(new Nt(t,mt.Aligned)),r.uniforms.push(new it("uSampler",0)),r.uniforms.push(new it("uScalarRange",e.toArray())),r}static createResultMappingByLowValue(t,e=new Ct(0,1),r){const n=new pt;return n.vertexCompiler.assemblePosition(),n.vertexCompiler.CompileresultMappingByRange(),n.fragmentCompiler.assembleTextureByLowValue(r),n.states.add(new ut(!0)),n.states.add(new Nt(t,mt.Default)),n.uniforms.push(new it("uSampler",0)),n.uniforms.push(new it("uScalarRange",e.toArray())),n}static createLightResultMapping(t,e=new Ct(0,1),r=.3,n=.7,s=.4,a=200){const o=vt.createResultMapping(t,e);return o.vertexCompiler.assembleNormal(),o.fragmentCompiler.assembleHeadLight(r,n,s,a),o}static createTransparentResultMapping(t,e=new Ct(0,1),r=.3,n=.7,s=.4,a=200,o=.5,c=.5){const d=vt.createLightResultMapping(t,e,r,n,s,a);d.fragmentCompiler.assembleTransparent(o,c);const v=new ut(!0,"less",!1);return d.states.add(new Bt(!0)),d.states.add(v),d.isTransparent=!0,d}static createTransparentResultMappingWithoutLight(t,e=new Ct(0,1),r=1){const n=vt.createResultMapping(t,e);n.fragmentCompiler.assembleTransparentWithoutLight();const s=new ut(!0,"less",!1);return n.states.add(new Bt(!0)),n.states.add(s),n.uniforms.push(new it("transparency",r)),n.isTransparent=!0,n}static createDisplacementLightResultMapping(t,e=new Ct(0,1),r){const n=new pt;return n.vertexCompiler.assembleDisplpacement(),n.vertexCompiler.assemblePosition(),n.vertexCompiler.CompileresultMapping(),n.fragmentCompiler.assembleTexture(),n.vertexCompiler.assembleNormal(),n.fragmentCompiler.assembleHeadLight(),n.states.add(new ut(!0)),n.states.add(new Nt(t,mt.Default)),n.uniforms.push(new it("uSampler",0)),n.uniforms.push(new it("uScalarRange",e.toArray())),n.uniforms.push(r),n}static createSphereColor(t=Zt,e=12){const r=vt.createColor(t);return r.vertexCompiler.assemblePointSize(),r.fragmentCompiler.assembleSphere(),r.uniforms.add(new it("uPointSize",e)),r}static createCircularColor(t=12){const e=new pt;return e.vertexCompiler.assemblePosition(),e.vertexCompiler.assembleVertexColor(),e.vertexCompiler.assemblePointSize(),e.fragmentCompiler.assembleInstancedColor(),e.uniforms.add(new it("uPointSize",t)),e}static createSphereResultMapping(t,e=new Ct(0,1),r=12){const n=vt.createResultMapping(t);return n.vertexCompiler.assemblePointSize(),n.fragmentCompiler.assembleSphere(),n.uniforms.add(new it("uPointSize",r)),n.uniforms.push(new it("uSampler",0)),n.uniforms.push(new it("uScalarRange",e.toArray())),n}static createInstancedResultMapping(t,e=new Ct(0,1)){const r=new pt;return r.vertexCompiler.assembleInstancedPosition(),r.vertexCompiler.CompileresultMapping(),r.fragmentCompiler.assembleTexture(),r.vertexCompiler.assembleInstancedNormal(),r.fragmentCompiler.assembleHeadLight(.3,.7,.4,200),r.states.add(new ut(!0)),r.states.add(new Nt(t,mt.Default)),r.uniforms.push(new it("uSampler",0)),r.uniforms.push(new it("uScalarRange",e.toArray())),r}static createInstancedResultMappingV(t,e=new Ct(0,1)){const r=new pt;return r.vertexCompiler.assembleInstancedPosition(),r.vertexCompiler.assembleInstancedResultMappingV(),r.fragmentCompiler.assembleTexture(),r.vertexCompiler.assembleInstancedNormal(),r.fragmentCompiler.assembleHeadLight(.3,.7,.4,200),r.states.add(new ut(!0)),r.states.add(new Nt(t,mt.Default)),r.uniforms.push(new it("uSampler",0)),r.uniforms.push(new it("uScalarRange",e.toArray())),r}static createInstancedResultMappingV2Camera(t,e=new Ct(0,1),r){const n=new pt;return n.vertexCompiler.assembleInstancedPosition2Camera(),n.vertexCompiler.assembleInstancedResultMappingV(),n.fragmentCompiler.assembleTexture(),n.vertexCompiler.assembleInstancedPosition2CameraNormal(),n.fragmentCompiler.assembleHeadLight(.3,.7,.4,200),n.states.add(new ut(!0)),n.states.add(new Nt(t,mt.Default)),n.uniforms.push(r),n.uniforms.push(new it("uSampler",0)),n.uniforms.push(new it("uScalarRange",e.toArray())),n}static createZBuffer(){const t=new pt;return t.vertexCompiler.assemblePosition(),t.fragmentCompiler.assembleZBuffer(),t.states.add(new ut(!0)),t}static createNormal(){const t=new pt(!0);return t.vertexCompiler.assemblePosition(),t.vertexCompiler.assembleNormal(),t.fragmentCompiler.assembleNormal(),t.states.add(new ut(!0)),t}static createColorByHeight(t,e){const r=new pt;r.vertexCompiler.assembleColorByHeight(),r.fragmentCompiler.assembleColorByHeight(t.length,e.length*3),r.uniforms.add(new it("heights",new Float32Array(t)));const n=[];return e.forEach(s=>{n.push(...s.toRgbArray())}),r.uniforms.add(new it("colors",new Float32Array(n))),r.states.add(new ut(!0)),r}static createLightColorByHeight(t,e,r=.3,n=.7,s=.4,a=200){const o=vt.createColorByHeight(t,e);return o.vertexCompiler.assembleNormal(),o.fragmentCompiler.assembleHeadLight(r,n,s,a),o}static createOffsetResultMapping(t,e=new Ct(0,1),r){const n=new pt;return n.vertexCompiler.assemblePositionOffset(r),n.vertexCompiler.assemblePosition(),n.vertexCompiler.CompileresultMapping(),n.fragmentCompiler.assembleTexture(),n.states.add(new ut(!0)),n.states.add(new Nt(t,mt.Default)),n.uniforms.push(new it("uSampler",0)),n.uniforms.push(new it("uScalarRange",e.toArray())),n}static createTransparentOffsetResultMappingWithoutLight(t,e=new Ct(0,1),r=1,n){const s=vt.createOffsetResultMapping(t,e,n);s.fragmentCompiler.assembleTransparentWithoutLight();const a=new ut(!0,"less",!1);return s.states.add(new Bt(!0)),s.states.add(a),s.uniforms.push(new it("transparency",r)),s.isTransparent=!0,s}static createOffsetSphereResultMapping(t,e=new Ct(0,1),r=12,n){const s=vt.createOffsetResultMapping(t,e,n);return s.vertexCompiler.assemblePointSize(),s.fragmentCompiler.assembleSphere(),s.uniforms.add(new it("uPointSize",r)),s.uniforms.push(new it("uSampler",0)),s.uniforms.push(new it("uScalarRange",e.toArray())),s}static createOffsetColor(t=Zt,e=!0,r){const n=new pt;return n.vertexCompiler.assemblePositionOffset(r),n.vertexCompiler.assemblePosition(),n.fragmentCompiler.assembleColor(),n.uniforms.add(new it("uColor",t.toRgbaArray())),e===!0&&n.states.add(new ut(!0)),n}static createOffsetZColor(t=Zt,e=!0,r=.001){const n=new pt;return n.vertexCompiler.assemblePosition(),n.vertexCompiler.assemblePositionOffset([0,0,r]),n.fragmentCompiler.assembleColor(),n.uniforms.add(new it("uColor",t.toRgbaArray())),e===!0&&n.states.add(new ut(!0)),n}static createOffsetZTransparentColor(t=Zt,e=.5,r=.001,n=.3,s=.7,a=.4,o=200,c=.5,d=!0){const v=vt.createOffsetZColor(t,d,r);return v.vertexCompiler.assembleNormal(),v.fragmentCompiler.assembleHeadLight(n,s,a,o),v.fragmentCompiler.assembleTransparent(c,e),v.states.add(new Bt(!0)),v.states.add(new ut(!0,"less",!1)),v.isTransparent=!0,v}static createOffsetLightColor(t=Zt,e=!0,r=.3,n=.7,s=.4,a=200,o=!0,c){const d=vt.createOffsetColor(t,o,c);return e?(d.vertexCompiler.assembleNormal(),d.fragmentCompiler.assembleHeadLight(r,n,s,a)):(d.vertexCompiler.assembleHeadLight(r,n,s,a),d.fragmentCompiler.assembleLightIntensity()),d}}class we extends he{constructor(){super()}bind(){this.doBind()}doBind(){}get name(){return this.m_name}}class Bt extends we{static get Default(){return Bt.s_default||(Bt.s_default=new Bt),Bt.s_default}constructor(t=!1,e="src_alpha",r="one_minus_src_alpha",n="src_alpha",s="one_minus_src_alpha",a="func_add",o="func_add"){super(),this.m_name="BlendState",this.m_spec={enabled:t,ColorFunc:e,dstColorFunc:r,AlphaFunc:n,dstAlphaFunc:s,colorEq:a,alphaEq:o}}clone(){return new Bt(this.m_spec.enabled,this.m_spec.ColorFunc,this.m_spec.dstColorFunc,this.m_spec.AlphaFunc,this.m_spec.dstAlphaFunc,this.m_spec.colorEq,this.m_spec.alphaEq)}toJson(){return this.m_spec}get enabled(){return this.m_spec.enabled}set(t,e,r,n,s,a,o){this.m_spec.enabled=t,this.m_spec.ColorFunc=e,this.m_spec.dstColorFunc=r,this.m_spec.AlphaFunc=n,this.m_spec.dstAlphaFunc=s,this.m_spec.colorEq=a,this.m_spec.alphaEq=o}doBind(){const t=this.m_spec;if(t.enabled){y.enable(y.BLEND);const e=Pt.toGLFunction,r=Pt.toGLEquation;t.ColorFunc===t.AlphaFunc&&t.dstColorFunc===t.dstAlphaFunc?y.blendFunc(e(t.ColorFunc),e(t.dstColorFunc)):y.blendFuncSeparate(e(t.ColorFunc),e(t.dstColorFunc),e(t.AlphaFunc),e(t.dstAlphaFunc)),t.colorEq===t.alphaEq?y.blendEquation(r(t.colorEq)):y.blendEquationSeparate(r(t.colorEq),r(t.alphaEq))}else y.disable(y.BLEND)}}Bt.s_default=void 0;class ie extends we{static get Default(){return ie.s_default||(ie.s_default=new ie),ie.s_default}constructor(t=!1,e="ccw",r="back"){super(),this.m_name="CullingState",this.m_spec={enabled:t,dir:e,mode:r}}clone(){return new ie(this.m_spec.enabled,this.m_spec.dir,this.m_spec.mode)}toJson(){return this.m_spec}set(t,e,r){this.m_spec.enabled=t,this.m_spec.dir=e,this.m_spec.mode=r}doBind(){const t=this.m_spec;if(t.enabled){y.enable(y.CULL_FACE);const e=Pt.toGLFace,r=Pt.toGLFrontMode;y.frontFace(r(t.dir)),y.cullFace(e(t.mode))}else y.disable(y.CULL_FACE)}}ie.s_default=void 0;class ut extends we{static get Default(){return ut.s_default||(ut.s_default=new ut),ut.s_default}constructor(t=!1,e="less",r=!0){super(),this.m_name="DepthState",this.m_spec={enabled:t,depthFunc:e,depthMask:r}}clone(){return new ut(this.m_spec.enabled,this.m_spec.depthFunc,this.m_spec.depthMask)}toJson(){return this.m_spec}set(t,e,r){this.m_spec.enabled=t,this.m_spec.depthFunc=e,this.m_spec.depthMask=r}doBind(){const t=this.m_spec;if(t.enabled){y.enable(y.DEPTH_TEST);const e=Pt.toGLFunction;y.depthFunc(e(t.depthFunc)),y.depthMask(t.depthMask)}else y.disable(y.DEPTH_TEST)}}ut.s_default=void 0;class Ht extends we{static get Default(){return Ht.s_default||(Ht.s_default=new Ht),Ht.s_default}constructor(t=!1,e=0,r=0){super(),this.m_name="PolygonOffsetState",this.m_spec={enabled:t,factor:e,unit:r}}clone(){return new Ht(this.m_spec.enabled,this.m_spec.factor,this.m_spec.unit)}toJson(){return this.m_spec}set(t,e,r){this.m_spec.enabled=t,this.m_spec.factor=e,this.m_spec.unit=r}doBind(){const t=this.m_spec;t.enabled?(y.enable(y.POLYGON_OFFSET_FILL),y.polygonOffset(t.factor,t.unit)):y.disable(y.POLYGON_OFFSET_FILL)}}Ht.s_default=void 0;class Nt extends we{constructor(t,e,r=0){super(),this.set(t,e,r)}toJson(){return this.m_spec}set(t,e,r){this.m_name="TextureState"+r,this.m_texture=t,this.m_sampler=e,this.m_spec={unit:r,texture:t.toJson(),sampler:e.toJson()}}clone(){return new Nt(this.m_texture.clone(),this.m_sampler.clone(),this.m_spec.unit)}get unit(){return this.m_spec.unit}get texture(){return this.m_texture}get sampler(){return this.m_sampler}doBind(){y.activeTexture(y.TEXTURE0+this.m_spec.unit),this.m_texture.bind(),this.m_sampler.bind()}}class Ot extends ze{static get Default(){return Ot.s_default||(Ot.s_default=new Ot,Ot.s_default.add(Bt.Default),Ot.s_default.add(ie.Default),Ot.s_default.add(ut.Default),Ot.s_default.add(Ht.Default)),Ot.s_default}constructor(){super()}toJson(){const t={};return this.forEach(e=>{t[e.name]=e.toJson()}),t}clone(){let t=new Ot;return this.forEach(e=>{t.push(e.clone())}),t}}Ot.s_default=void 0;function Se(i,t,e,r){function n(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function o(v){try{d(r.next(v))}catch(_){a(_)}}function c(v){try{d(r.throw(v))}catch(_){a(_)}}function d(v){v.done?s(v.value):n(v.value).then(o,c)}d((r=r.apply(i,[])).next())})}function In(i){switch(i){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":return 4;case"MAT4":return 16;default:throw new Error(`Unknown type ${i}`)}}function Rn(i){const t=new DataView(i);if(t.getUint32(0,!0)!==1179937895)throw new Error("Not a GLB");const r=t.getUint32(12,!0),n=20,s=new TextDecoder().decode(i.slice(n,n+r)),a=JSON.parse(s),o=n+r+8,c=i.slice(o);return{json:a,bin:c}}function Pn(i){return Se(this,void 0,void 0,function*(){const t=yield fetch(i).then(n=>n.json()),e=i.substring(0,i.lastIndexOf("/")+1),r=yield Promise.all(t.buffers.map(n=>Se(this,void 0,void 0,function*(){return(yield fetch(e+n.uri)).arrayBuffer()})));return{json:t,buffers:r}})}class mi{load(t,e){return Se(this,void 0,void 0,function*(){let r,n;const a=yield(yield fetch(e)).arrayBuffer();if(new TextDecoder().decode(a.slice(0,4))==="glTF"){const c=Rn(a);r=c.json,n=[c.bin]}else{const c=yield Pn(e);r=c.json,n=c.buffers}return t.makeCurrent(),this.buildMeshes(t,r,n)})}modeToString(t){switch(t===void 0?4:t){case 0:return"points";case 1:return"lines";case 2:return"line_loop";case 3:return"line_strip";case 4:return"triangles";case 5:return"triangle_strip";case 6:return"triangle_fan";default:return"triangles"}}componentTypeToGLType(t){switch(t){case 5120:return"byte";case 5121:return"unsigned_byte";case 5122:return"short";case 5123:return"unsigned_short";case 5125:return"unsigned_int";case 5126:return"float";default:return"unsigned_short"}}buildMeshes(t,e,r){var n,s,a,o,c,d,v,_,b,f,m,l;return Se(this,void 0,void 0,function*(){const p=new Map,g=Or.current(),x=[];if(!e.meshes||e.meshes.length===0)return console.error("No meshes found in GLTF data."),[];let w=[],A=[];for(const R of e.meshes)for(const F of R.primitives){const L=new Gt;for(const u in F.attributes){const W=e.accessors[F.attributes[u]],C=e.bufferViews[W.bufferView],S=r[C.buffer],I=((n=C.byteOffset)!==null&&n!==void 0?n:0)+((s=W.byteOffset)!==null&&s!==void 0?s:0),P=In(W.type);u==="POSITION"&&(console.log("POSITION minMax",W),w=(a=W.min)!==null&&a!==void 0?a:[],A=(o=W.max)!==null&&o!==void 0?o:[]);let N="";switch(u){case"POSITION":N="aVertex";break;case"NORMAL":N="aNormal";break;case"TEXCOORD_0":N="aTexCoord";break;case"COLOR_0":N="aColor";break;case"TANGENT":N="aTangent";break;default:N="a"+u}L.push(new It(N,P,S,W.componentType,(c=C.byteStride)!==null&&c!==void 0?c:0,I,(d=W.normalized)!==null&&d!==void 0?d:!1))}if(F.indices!==void 0){const u=e.accessors[F.indices],W=e.bufferViews[u.bufferView],C=r[W.buffer],S=((v=W.byteOffset)!==null&&v!==void 0?v:0)+((_=u.byteOffset)!==null&&_!==void 0?_:0),I=u.count,P=u.componentType===5123?2:4,N=C.slice(S,S+I*P);let k;if(u.componentType===5123)k=new Uint16Array(N);else if(u.componentType===5125){if(!(g instanceof WebGL2RenderingContext)&&!g.getExtension("OES_element_index_uint")){console.warn("Skip primitive: UNSIGNED_INT not supported");continue}k=new Uint32Array(N)}else throw new Error(`Unsupported index componentType: ${u.componentType}`);L.push(new ue(k));const M=this.modeToString(F.mode),Z=this.componentTypeToGLType(u.componentType);L.push(new Ie(M,I,Z,0))}else{const W=e.accessors[F.attributes.POSITION].count,C=this.modeToString(F.mode);L.push(new pe(C,0,W))}const j=new Vt;j.push(L);let B;const Q=F.material,X=Q!==void 0?(b=e.materials)===null||b===void 0?void 0:b[Q]:null,T=(f=X?.pbrMetallicRoughness)===null||f===void 0?void 0:f.baseColorTexture;if(T){const u=T.index;let W=p.get(u);if(!W){const I=e.textures[u].source;W=yield this.createTextureFromImage(e,r,I),p.set(u,W)}let C;(function(S){S[S.Fast=0]="Fast",S[S.Stable=1]="Stable"})(C||(C={})),B=vt.createLightTexture(W,C.Stable).generate()}else{const u=(l=(m=X?.pbrMetallicRoughness)===null||m===void 0?void 0:m.baseColorFactor)!==null&&l!==void 0?l:[.3,.51,1,1];B=vt.createLightColor(new Xt(u[0],u[1],u[2],u[3])).generate()}j.push(B);const U=new kt(j);U.boundingBox.min=K(w[0],w[1],w[2]),U.boundingBox.max=K(A[0],A[1],A[2]),x.push(U)}return x})}createTextureFromImage(t,e,r){var n,s;return Se(this,void 0,void 0,function*(){const a=t.images[r];let o;if(a.bufferView!==void 0){const d=t.bufferViews[a.bufferView],_=e[d.buffer].slice((n=d.byteOffset)!==null&&n!==void 0?n:0,((s=d.byteOffset)!==null&&s!==void 0?s:0)+d.byteLength),b=new Blob([_],{type:a.mimeType});o=yield createImageBitmap(b)}else if(a.uri){const d=yield fetch(a.uri).then(v=>v.blob());o=yield createImageBitmap(d)}else throw new Error("Unsupported image source");return new or("rgba","unsigned_byte",o)})}getAttribLocation(t){switch(t){case"POSITION":return 0;case"NORMAL":return 1;case"TEXCOORD_0":return 2;default:return 3}}}class Fn{constructor(t=1,e=1){this.type="QuadGeo",this.parameters={},this.parameters={width:t,height:e};const r=t/2,n=e/2;let s=[0,1,2,2,3,0],a=[-r,-n,r,-n,r,n,-r,n],o=[0,0,1,0,0,1,0,0,1,0,0,1],c=[0,0,1,0,1,1,0,1];this.indices=new Uint16Array(s),this.vertices=new Float32Array(a),this.normals=new Float32Array(o),this.uvs=new Float32Array(c)}get boundingBox(){if(!this.m_boundingBox){const t=this.parameters.width/2,e=this.parameters.height/2,r=K(-t,-e,0),n=K(t,e,0);this.m_boundingBox=new Ut(r,n)}return this.m_boundingBox}}class Ln{constructor(t=1,e=1,r=1,n=1,s=1,a=1){this.type="CubeGeo",this.parameters={},this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:s,depthSegments:a},n=Math.floor(n),s=Math.floor(s),a=Math.floor(a);let o=[],c=[],d=[],v=[],_=[],b=0;b=this.buildPlane(2,1,0,-1,-1,r,e,t,a,s,0,o,v,c,d,_,b),b=this.buildPlane(2,1,0,1,-1,r,e,-t,a,s,1,o,v,c,d,_,b),b=this.buildPlane(0,2,1,1,1,t,r,e,n,a,2,o,v,c,d,_,b),b=this.buildPlane(0,2,1,1,-1,t,r,-e,n,a,3,o,v,c,d,_,b),b=this.buildPlane(0,1,2,1,-1,t,e,r,n,s,4,o,v,c,d,_,b),b=this.buildPlane(0,1,2,-1,-1,t,e,-r,n,s,5,o,v,c,d,_,b),this.indices=new Uint16Array(o),this.vertices=new Float32Array(c),this.normals=new Float32Array(d),this.line_indices=new Uint16Array(v),this.uvs=new Float32Array(_)}buildPlane(t,e,r,n,s,a,o,c,d,v,_,b,f,m,l,p,g){const x=a/d,w=o/v,A=a/2,R=o/2,F=c/2,L=d+1,j=v+1;let B=0;for(let Q=0;Q<j;Q++){const X=Q*w-R;for(let T=0;T<L;T++){const U=T*x-A;let u=[];u[t]=U*n,u[e]=X*s,u[r]=F,m.push(u[0],u[1],u[2]),u[t]=0,u[e]=0,u[r]=c>0?1:-1,l.push(u[0],u[1],u[2]),p.push(T/d),p.push(1-Q/v),B+=1}}for(let Q=0;Q<v;Q++)for(let X=0;X<d;X++){const T=g+X+L*Q,U=g+X+L*(Q+1),u=g+(X+1)+L*(Q+1),W=g+(X+1)+L*Q;b.push(T,U,W),b.push(U,u,W),f.push(T,U),f.push(U,u),f.push(u,W),f.push(T,W)}return g+=B,g}}class Nn{constructor(t,e=new Xt(1)){this.m_context=t,this.m_background=e}alloc(){this.m_fbo=new $e({color:{format:"rgba",type:"unsigned_byte"},depth:{format:"depth_component16"}});const t=this.m_background;this.m_scene=new Jr(this.m_context),this.m_renderPass=new _e({color:[t.r,t.g,t.b,t.a],depth:1},this.m_fbo),this.m_renderPass.name="snapshot",this.m_scene.push(this.m_renderPass)}free(){this.m_context.makeCurrent(),te(this.m_renderPass),this.m_fbo=void 0,this.m_renderPass=void 0,this.m_scene=void 0}take(t,e){return this.m_renderPass.model=e,this.m_renderPass.camera.builtInUniforms=t,this.m_scene.size=t.viewportSize,this.m_scene.render(),this.m_renderPass.fbo.read()}}class Er{constructor(){this.image2Canvas=(t,e=!1)=>{const r=document.createElement("canvas"),n=r.getContext("2d");return r.width=t.width,r.height=t.height,r.style.width=t.width+"px",r.style.height=t.height+"px",n.putImageData(t,0,0),e&&(n.transform(1,0,0,-1,0,r.height),n.globalCompositeOperation="copy",n.drawImage(n.canvas,0,0),n.globalCompositeOperation="source-over"),r},this.save=(t,e,r=!1)=>{let n;t instanceof ImageData?n=this.image2Canvas(t,r):n=t;const s=n.toDataURL("image/png"),a=document.createElement("a");a.download=e+".png",a.href=s,a.click()}}}class On{static id2Color(t){return[(t>>0&255)/255,(t>>8&255)/255,(t>>16&255)/255,(t>>24&255)/255]}static id2ColorInt(t){return[t>>0&255,t>>8&255,t>>16&255,t>>24&255]}static color2Id(t,e,r,n){return t+(e<<8)+(r<<16)+(n<<24)>>>0}}class Kt{static transformFromRoot(t){let e=ht();for(t.transform&&ce(e,t.transform.matrix);t.parent;)t=t.parent,t.transform&&Lt(e,t.transform.matrix,e);return e}static getParentTransformWorld(t){let e=ht();for(;t.parent;)t=t.parent,t.transform&&Lt(e,t.transform.matrix,e);return e}static transformChildren(t){const e=(r,n)=>{r.type==="PartGroup"?r.forEach(s=>{let a=null;s.transform&&(a=new yt($t(s.transform.matrix))),n&&(a?Lt(a.matrix,n.matrix,a.matrix):a=new yt($t(n.matrix))),e(s,a)}):r.type==="Part"&&r.drawables.forEach(s=>{let a=ht();n&&Lt(a,n.matrix,s.tbo.transform.matrix),s.tbo.transformWorld=new yt(a)})};e(t,t.transformWorld)}}var Ge;(function(i){i[i.geom=256]="geom",i[i.volume=16]="volume",i[i.face=8]="face",i[i.edge=4]="edge",i[i.nodes=2]="nodes",i[i.none=1]="none"})(Ge||(Ge={}));var xe;(function(i){i[i.NONE=0]="NONE",i[i.POINT=1]="POINT",i[i.LINE=2]="LINE",i[i.TRIANGLE=4]="TRIANGLE"})(xe||(xe={}));class kt{constructor(t){this.type="Part",this.visible=!0,this.selectable=!0,this.drawables=[],this.m_transform=new yt,this.m_transformWorld=new yt,this.caeType=-1,t&&(this.drawables.push(t),t.parent=this),this.name="Part"}addDrawable(t){t&&(this.drawables.push(t),t.parent=this)}setEffect(t){this.drawables.forEach(e=>{e.push(t)})}get transform(){return this.m_transform}set transform(t){this.m_transform=t,this.updateTransformWorld(),Kt.transformChildren(this)}get transformWorld(){return this.updateTransformWorld(),this.m_transformWorld}updateTransformWorld(){this.m_transformWorld=new yt(Kt.transformFromRoot(this))}set transformWorld(t){this.m_transformWorld=t;let e=Kt.getParentTransformWorld(this),r=me(ht(),e);Lt(this.m_transform.matrix,r,this.m_transformWorld.matrix),Kt.transformChildren(this)}get parent(){return this.m_parent}set parent(t){this.m_parent=t}getRenderType(){let t=xe.NONE;const n=this.drawables[0].geometry.drawers.values().next().value;return n.mode.startsWith("triangle")?t=xe.TRIANGLE:n.mode.startsWith("line")?t=xe.LINE:n.mode.startsWith("point")&&(t=xe.POINT),t}clone(){const t=new kt;return this.drawables.forEach(e=>{t.addDrawable(e.clone())}),t.transform=new yt($t(this.transform.matrix)),t}get boundingBox(){if(!this.m_boundingBox||this.m_boundingBox.size[0]==20&&this.m_boundingBox.size[1]==20&&this.m_boundingBox.size[2]==20){const t=new Ut;let e=K(-1/0,-1/0,-1/0),r=K(1/0,1/0,1/0);this.drawables.forEach(n=>{Ir(e,n.boundingBox.max,e),zr(r,n.boundingBox.min,r)}),t.max=e,t.min=r,this.m_boundingBox=t}return this.m_boundingBox}}class ae extends Set{constructor(){super(),this.type="PartGroup",this.visible=!0,this.m_transform=new yt,this.m_transformWorld=new yt,this.name="PartGroup"}get name(){return this.m_name}set name(t){this.m_name=t}addPart(t){t&&(this.add(t),t.parent=this)}get transform(){return this.m_transform}set transform(t){this.m_transform=t,this.updateTransformWorld(),Kt.transformChildren(this)}updateTransform(){this.updateTransformWorld(),Kt.transformChildren(this)}get transformWorld(){return this.updateTransformWorld(),this.m_transformWorld}set transformWorld(t){this.m_transformWorld=t;let e=Kt.getParentTransformWorld(this),r=me(ht(),e);Lt(this.m_transform.matrix,r,this.m_transformWorld.matrix),Kt.transformChildren(this)}updateTransformWorld(){this.m_transformWorld=new yt(Kt.transformFromRoot(this))}get parent(){return this.m_parent}set parent(t){this.m_parent=t}dispose(){te(this),this.clear()}getParts(t){const e=[],r=(n,s)=>{n.visible&&n instanceof ae?n.forEach(a=>{r(a,s)}):n.visible&&n instanceof kt&&(s&&s(n)||!s)&&e.push(n)};return r(this,t),e}displayModel(t=""){const e=(r,n)=>{r instanceof ae?(console.log(n+r.name+"[PartGroup]["+r.visible+"]"),r.forEach(s=>{e(s,"  "+n)})):r instanceof kt&&console.log(n+r.name+"[Part]["+r.visible+"]")};console.log(`displayModel begin -------------------------
`+t),e(this,""),console.log("displayModel end   -------------------------")}get boundingBox(){return this.m_boundingBox||this.computeBoundingBox(),this.m_boundingBox}computeBoundingBox(){const t=new Ut;let e=K(-1/0,-1/0,-1/0),r=K(1/0,1/0,1/0);this.forEach(n=>{n.boundingBox&&(Ir(e,n.boundingBox.max,e),zr(r,n.boundingBox.min,r))}),t.max=e,t.min=r,this.m_boundingBox=t}}class Bn extends kt{constructor(){super(...arguments),this.name3d="-3D"}set drawable(t){this.m_drawable=t,this.addDrawable(t)}get drawable(){return this.m_drawable}set drawableThree(t){t&&(this.m_drawableThree=t,t.name=t.name+this.name3d,this.addDrawable(t))}get drawableThree(){return this.m_drawableThree}addThreeDrawable(t){t.name=t.name+this.name3d,this.addDrawable(t)}clearThreeDrawable(){this.drawables.forEach(t=>{t.name!==this.drawable.name&&te(t)}),this.m_drawableThree=null,this.drawables.length=0,this.addDrawable(this.drawable)}changeDrawable(t=!0,e=!1){this.drawable.visible=t,this.drawableThree&&(this.drawableThree.visible=e),this.drawables.forEach(r=>{r.name.includes(this.name3d)&&(r.visible=e)})}dispose(t){var e;te(this),(e=this.parent)===null||e===void 0||e.delete(this)}}K(0,-1,0);const dr=vt.createLightColor(new Xt(.706,.51,.675));dr.vertexCompiler.uniformQualifier.set("uNormal","vec3");dr.vertexCompiler.attach("vNormal = vec3(uNormalMatrix * uNormal);");dr.states.push(new Ht(!0,-.5,-.5));class Dn extends Bn{get pointA(){const t=this.geometry.getPoints();return jt(t[0],this.m_transform.matrix)}get pointB(){const t=this.geometry.getPoints();return jt(t[1],this.m_transform.matrix)}constructor(t,e,r=1,n="CadLine"){super(),this.parameters={},this.segment=1,this.scaleM4=ht(),this.rotateM4=ht(),this.positionM4=ht(),n&&(this.name=n),this.segment=r,this.resetGeometry(t,e)}get geometry(){return this.m_geometry}resetGeometry(t,e,r=this.segment){this.drawables.length&&(this.drawables.length=0,delete this.m_drawable,delete this.m_drawableThree),this.segment=r,this.m_geometry=new Ur(Te(t,e),this.segment);const n=new pe("line_strip",0,this.m_geometry.vboVertex.data.length/3);this.m_geometry.push(n);const s=new Xr().init();s.push(new Ht(!0,-1,-1)),this.drawable=new Vt,this.drawable.push(this.m_geometry),this.drawable.push(s)}get center(){const t=this.transform.matrix;return[t[12],t[13],t[14]]}setPosition(t){const e=ce(ht(),this.transform.matrix);this.positionM4[12]=t[0],this.positionM4[13]=t[1],this.positionM4[14]=t[2],e[12]=t[0],e[13]=t[1],e[14]=t[2],this.transform=new yt(e)}get points(){const t=this.geometry.getPoints(),e=t[0],r=t[1],n=jt(e,this.transform.matrix),s=jt(r,this.transform.matrix);return[n,s]}get length(){const t=this.points;return Te(t[0],t[1])}dispose(t=!0){var e;this.drawables.forEach(r=>{r.geometry.vbos.forEach(n=>{n.free()}),r.geometry.vbos.ibo&&r.geometry.vbos.ibo.free(),r.effect.shaders.forEach(n=>{n.free()})}),(e=this.parent)===null||e===void 0||e.delete(this)}}function ve(i){return i?[i.x,i.y,i.z]:[0,0,0]}const be=[0,0,1];class Un extends Dn{constructor(){super(...arguments),this.distanceA=0,this.distanceB=0,this.distanceLength=0}resetGeometry(t,e,r=this.segment){this.drawables.length&&(this.drawables.length=0,delete this.m_drawable,delete this.m_drawableThree),this.segment=r,this.m_geometry=new Ur(Te(t,e),this.segment,!0,[1,0,0]);const n=new pe("lines",0,this.segment*2);this.m_geometry.push(n);const s=new ti().init();s.push(new Ht(!0,-1,-1)),this.drawable=new Vt,this.drawable.push(this.m_geometry),this.drawable.push(s)}update(t){const e=ve(t.point1),r=ve(t.point2),n=ve(t.world1),s=ve(t.world2),a=ve(t.relative1),o=ve(t.relative2);let c=dt(et(),e,n),d=dt(et(),r,s),v=Tt(et(),d,c),_=Rt(et(),be,v),b=Rt(et(),v,_);Le(v,be)<.01&&(_=[1,0,0],b=[0,1,0]),Le(v,be)>Math.PI-.01&&(_=[0,-1,0],b=[-1,0,0]);let f=Tr(v,_,b);const m=jt(a,f),l=jt(o,f);c=dt(et(),c,m),d=dt(et(),d,l),v=Tt(et(),d,c),_=Rt(et(),be,v),b=Rt(et(),v,_),Le(v,be)<.01&&(_=[1,0,0],b=[0,1,0]),Le(v,be)>Math.PI-.01&&(_=[0,-1,0],b=[-1,0,0]),f=Tr(v,_,b);const p=-(t.radis*Math.PI)/180;p&&(f=Lt(ht(),f,cn(ht(),p))),ce(this.rotateM4,f),this.distanceLength=Te(c,d);const g=this.distanceLength/this.geometry.length;on(this.scaleM4,[g,1,1]);const x=ht();Lt(x,this.rotateM4,this.scaleM4),this.transform=new yt(x),this.setPosition(K((c[0]+d[0])*.5,(c[1]+d[1])*.5,(c[2]+d[2])*.5))}}class pi extends kt{constructor(t=1,e=1,r=1,n=1,s=1,a=1,o=[.7,.7,.7,1],c="cube-part"){super(),c&&(this.name=c);let d=new Ln(t,e,r,n,s,a);const v=new It("aVertex",3,d.vertices),_=new It("aNormal",3,d.normals),b=new ue(d.indices),f=new Ie("triangles",d.indices.length,"unsigned_short",0),m=new Gt;m.push(v),m.push(_),m.push(b),m.push(f),this.m_geometry=m;let l;o[3]<1?l=vt.createTransparentColor(new Xt(o[0],o[1],o[2]),.3,.7,.4,200,.5,o[3]).generate():l=vt.createLightColor(new Xt(o[0],o[1],o[2])).generate();const p=new Vt;p.push(m),p.push(l),p.push(new ut(!0)),this.addDrawable(p)}get geometry(){return this.m_geometry}}const Vr=i=>{i.shaders.forEach(t=>{t.free()}),i.states.forEach(t=>{t instanceof Nt&&t.texture.free()})},Wr=i=>{i.vbos&&(i.vbos.ibo&&(i.vbos.ibo.unbind(),i.vbos.ibo.free()),i.vbos.forEach(t=>{t.unbind(),t.free()}),delete i.g_vbos,delete i.drawers)},jr=i=>{Vr(i.effect),Wr(i.geometry)},Gr=i=>{i.drawables.forEach(t=>{jr(t)})},Qr=i=>{i.forEach(t=>{t instanceof kt?Gr(t):t instanceof ae&&Qr(t)})},Zr=i=>{const t=i.fbo;t&&(t.unbind(),t.buffers.color.free(),t.buffers.depth.free(),t.free())},Vn=i=>{i.forEach(t=>{Zr(t)})},te=i=>{if(i instanceof Ze)return Vn(i);if(i instanceof _e)return Zr(i);if(i instanceof ae)return Qr(i);if(i instanceof kt)return Gr(i);if(i instanceof Vt)return jr(i);if(i instanceof Gt)return Wr(i);if(i instanceof se)return Vr(i);console.warn('not free obj, type must be "Effect | Geometry | Drawable | Part | PartGroup | RenderPass | IPart"')};class Sr{constructor(t){this.set(t)}at(t){if(t<=this.m_colors[0].position)return this.m_colors[0].color;if(t>=this.m_colors[this.m_colors.length-1].position)return this.m_colors[this.m_colors.length-1].color;for(let e=0;e<this.m_colors.length-1;e++){const r=this.m_colors[e],n=this.m_colors[e+1];if(t>=r.position&&t<n.position){const s=(t-r.position)/(n.position-r.position),a=r.color,o=n.color,c=a[0]+s*(o[0]-a[0]),d=a[1]+s*(o[1]-a[1]),v=a[2]+s*(o[2]-a[2]);return[c,d,v]}}}set(t){if(this.m_colors=[],Array.isArray(t)){const e=1/(t.length-1);let r=0;t.forEach(n=>{this.m_colors.push({position:r,color:n}),r+=e})}else for(const e in t){const r=parseFloat(e);isNaN(r)||this.m_colors.push({position:r,color:t[e]}),this.m_colors.sort((n,s)=>n.position-s.position)}}setDiscrete(t){this.m_colors=[];const e=t[t.length-1].position,r=t[0].position;for(let n=0;n<t.length;n++){let s=(t[n].position-r)/(e-r);this.m_colors.push({position:s,color:t[n].color})}}}Sr.Rainbow=new Sr([[0,0,1],[0,.75,1],[0,1,1],[0,1,0],[1,1,0],[1,.75,0],[1,0,0]]);class Hr{static lineNumber(t){return t.split(`
`).map((e,r)=>`${r+1} ${e}`).join(`
`)}}ht();function Ar(i,t="aVertex"){let e;if(i.type&&i.type.includes("Geometry")?e=i.vbos:i.type&&i.type.includes("Drawable")&&(e=i.geometry.vbos),e){for(let r of e)if(r.name===t)return r}console.error(`${t}VBO`)}function Tr(i,t,e){const r=wt(et(),i),n=wt(et(),t),s=wt(et(),e);return sn(r[0],r[1],r[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1)}var Wn=`
void main() {

	vec4 position = vec4(aVertex, 1.0);

	gl_Position = position;

}

`,jn=`
void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}
`,Gn=`
attribute vec3 aVertex;

attribute mat4 aModelMatrix;

attribute vec4 aColor;

attribute vec3 aNormal;

varying vec4 vColor;

varying vec3 vNormal;

uniform mat4 uModelViewProjectionMatrix;

uniform mat4 uModelMatrix;

uniform mat4 uViewMatrix;

uniform mat4 uProjectionMatrix;

`,Qn=`
precision mediump float;

varying vec4 vColor;

varying vec3 vNormal;

`,Zn=`
vNormal = vec3(uNormalMatrix * aNormal);
vOriginNormal = aNormal;
`,Hn=`
float fRange = uScalarRange[1] - uScalarRange[0];
float fTexCoord = (aScalar - uScalarRange[0]) / fRange;
fTexCoord = clamp(fTexCoord, 0.0 , 1.0);
vTexCoord = vec2(fTexCoord, 0.5);
`,$n=`
vec3 offset = vec3(aDisplacementX, aDisplacementY, aDisplacementZ) * uFactor;
position += vec4(offset, 0.0);
`,Xn=`
vec2 coord = gl_PointCoord * 2.0 - vec2(1.0);

if (dot(coord, coord) > 1.0)

    discard;

`,qn=`
float dist = distance(gl_PointCoord, vec2(0.5));
float fNDotV = sqrt(1.0 - dist * dist / 0.25);
color = vec4(color.xyz * fNDotV, 1.0);
`;const Jn={default_vertex:Wn,default_fragment:jn,predefine_vertex:Gn,predefine_fragment:Qn,assemblenormal_vertex:Zn,compileresultmapping_vertex:Hn,assembledisplacement_vertex:$n,assembledisclip_fragment:Xn,assemblesphere_fragment:qn};class $r{constructor(t=!1){this.uniforms=new ee,this.states=new Ot,this.isTransparent=!1,this.m_vertexModified="",this.m_fragmentmodified="",this.name="Material"}attachToVertex(t){this.m_vertexModified+=t}attachToFragment(t){this.m_fragmentmodified+=t}resolveIncludes(t){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;return t.replace(e,this.includeReplacer.bind(this))}includeReplacer(t,e){const r=Jn[e];if(r===void 0)throw new Error(`Can not resolve #include <${e}>`);return this.resolveIncludes(r)}unrollLoops(t){const e=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;return t.replace(e,this.loopReplacer)}loopReplacer(t,e,r,n){let s="";for(let a=parseInt(e);a<parseInt(r);a++)s+=n.replace(/\[\s*i\s*\]/g,`[${a}]`).replace(/UNROLLED_LOOP_INDEX/g,a.toString());return s}init(t=!1){this.vertexSource=this.resolveIncludes(this.vertexSource),this.fragmentSource=this.resolveIncludes(this.fragmentSource),this.vertexSource=this.unrollLoops(this.vertexSource),this.fragmentSource=this.unrollLoops(this.fragmentSource);const e=new Xe(this.vertexSource),r=new qe(this.fragmentSource);t&&(console.log(e.source),console.log(r.source));const n=new se(this.name);return n.push(e),n.push(r),n.push(this.uniforms),n.push(this.states),n.shaders.isTransparent=this.isTransparent,n}}const Yn=new Xt(.5,.7,.9,1);class Xr extends $r{constructor(t=Yn,e=!0){super(),this.isTransparent=!1,this.name="ColorMaterial",this.vertexSource=`            
    #include <predefine_vertex>
    varying vec3 vReflectDirection;

    void main(void) {
        vec4 position = vec4(aVertex, 1.0);
        position = uModelViewProjectionMatrix * position;`+this.m_vertexModified+`
        gl_Position = position;
    }`,this.fragmentSource=`
    #include <predefine_fragment>
    uniform vec4 uColor;
  
    void main(void) {
        vec4 color = vec4(1.0);
        color = uColor;`+this.m_fragmentmodified+`
        gl_FragColor = color;
    }`,this.uniforms.add(new it("uColor",t.toRgbaArray())),e===!0&&this.states.add(new ut(!0))}}const Kn=new Xt(.5,.7,.9,1);class ti extends $r{constructor(t=Kn,e=!0,r=.3,n=.7,s=.4,a=200,o=!0){super(),this.isTransparent=!1,e?(this.vertexSource=`            
        #include <predefine_vertex>
        varying vec3 vReflectDirection;
        varying vec3 vOriginNormal;
        uniform mat3 uNormalMatrix;
    
        void main(void) {
            vec4 position = vec4(aVertex, 1.0);
            position = uModelViewProjectionMatrix * position;
            #include <assemblenormal_vertex>`+this.m_vertexModified+`
            gl_Position = position;
        }`,this.fragmentSource=`
        #include <predefine_fragment>
        uniform vec4 uColor;
      
        void main(void) {
            vec4 color = vec4(1.0);
            color = uColor;
            vec3 normal = normalize(vNormal);
            float nDotV = abs(normal.z);
            float lightIntensity = float(${r}) + nDotV * float(${n}) +
            float(${s}) * pow(nDotV, float(${a}));
            color = vec4(color.xyz * lightIntensity, 1.0);`+this.m_fragmentmodified+`gl_FragColor = color;
        }`):(this.vertexSource=`            
        #include <predefine_vertex>
        varying vec3 vReflectDirection;
        uniform mat3 uNormalMatrix;
        varying float vLightIntensity;
    
        void main(void) {
            vec4 position = vec4(aVertex, 1.0);
            position = uModelViewProjectionMatrix * position;
            float nDotV = abs((uNormalMatrix * aNormal).z);
            vLightIntensity = float(${r}) +
                              nDotV * float(${n}) +
                              float(${s}) * pow(nDotV, float(${a}));`+this.m_vertexModified+`
            gl_Position = position;
        }`,this.fragmentSource=`
        #include <predefine_fragment>
        uniform vec4 uColor;
        varying float vLightIntensity;
      
        void main(void) {
            vec4 color = vec4(1.0);
            color = uColor;
            color = vec4(color.xyz * vLightIntensity, 1.0);`+this.m_fragmentmodified+`
            gl_FragColor = color;
        }`),this.uniforms.add(new it("uColor",t.toRgbaArray())),o===!0&&this.states.add(new ut(!0))}}class re extends ur{constructor(t){super(t),this.m_attributeLocations={},this.m_uniformLocations={},this.name="Program",this.load(),this.findAttributeInfo(this.m_id),this.findUniformInfo(this.m_id)}bind(){y.useProgram(this.m_id),re.m_program=this}unbind(){y.useProgram(null),re.m_program=void 0}alloc(){this.m_id=y.createProgram()}free(){this.m_id&&(y.deleteProgram(this.m_id),this.m_id=void 0)}load(){this.alloc(),this.m_list.forEach(e=>{e.bind(),y.attachShader(this.m_id,e.resourceId)}),y.linkProgram(this.m_id);let t=y.getProgramParameter(this.m_id,y.LINK_STATUS);if(!t){console.error("[Program]","compile:",t);let e=y.getProgramInfoLog(this.m_id);console.error(`ProgramInfoLog:
`+e),this.m_list.forEach(r=>{console.warn("["+r.type+`]
`+Hr.lineNumber(r.source))})}}static current(){return re.m_program}get attributeLocations(){return this.m_attributeLocations}get uniformLocations(){return this.m_uniformLocations}findAttributeInfo(t){const e=y.getProgramParameter(t,y.ACTIVE_ATTRIBUTES);for(let r=0;r<e;r++){const s=y.getActiveAttrib(t,r).name,a=y.getAttribLocation(t,s);this.m_attributeLocations[s]={location:a}}}findUniformInfo(t){const e=y.getProgramParameter(t,y.ACTIVE_UNIFORMS);for(let r=0;r<e;r++){const n=y.getActiveUniform(t,r);let s=n.name;s.substr(-3)==="[0]"&&(s=s.substr(0,s.length-3));const a=y.getUniformLocation(t,s);this.m_uniformLocations[s]={location:a,type:n.type}}}}class ei extends he{constructor(){super()}}class mt extends ei{static get Default(){return mt.s_default||(mt.s_default=new mt,mt.s_default.m_spec.wrapModeS="clamp_to_edge",mt.s_default.m_spec.wrapModeT="clamp_to_edge",mt.s_default.m_spec.minFilter="linear"),mt.s_default}static get Aligned(){return mt.s_aligned||(mt.s_aligned=new mt,mt.s_aligned.m_spec.wrapModeS="clamp_to_edge",mt.s_aligned.m_spec.wrapModeT="clamp_to_edge",mt.s_aligned.m_spec.minFilter="nearest",mt.s_aligned.m_spec.magFilter="nearest"),mt.s_aligned}static get RenderTarget(){return mt.Default}constructor(t="repeat",e="repeat",r="nearest_mipmap_linear",n="linear"){super(),this.m_spec={wrapModeS:t,wrapModeT:e,minFilter:r,magFilter:n}}clone(){return new mt(this.m_spec.wrapModeS,this.m_spec.wrapModeT,this.m_spec.minFilter,this.m_spec.magFilter)}toJson(){return this.m_spec}get wrapModeS(){return this.m_spec.wrapModeS}get wrapModeT(){return this.m_spec.wrapModeT}get minFilter(){return this.m_spec.minFilter}get magFilter(){return this.m_spec.magFilter}set(t,e,r,n){this.m_spec.wrapModeS=t,this.m_spec.wrapModeT=e,this.m_spec.minFilter=r,this.m_spec.magFilter=n}bind(){const t=Pt.toGLWrapMode,e=Pt.toGLFilter,r=this.m_spec;y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,t(r.wrapModeS)),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,t(r.wrapModeT)),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,e(r.minFilter)),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,e(r.magFilter))}}mt.s_default=void 0;mt.s_aligned=void 0;class mr extends oe{constructor(t){super(),this.set(t)}get type(){}get source(){return this.m_data}set(t){this.m_data=t}doFree(t){y.deleteShader(t)}doLoad(t){y.shaderSource(t,this.m_data),y.compileShader(t);let e=y.getShaderParameter(t,y.COMPILE_STATUS);e||console.error("["+this.type+"]","Shader compile:",e);const r=y.getShaderInfoLog(t);r.length>0&&(console.error(`ShaderInfoLog:
`+r),console.warn(`
`+Hr.lineNumber(this.m_data)))}}class Xe extends mr{constructor(t){super(t)}get type(){return"vertex"}toJson(){return{type:"vertex"}}clone(){return new Xe(this.m_data)}doAlloc(){return y.createShader(y.VERTEX_SHADER)}}class qe extends mr{constructor(t){super(t)}get type(){return"fragment"}toJson(){return{type:"fragment"}}clone(){return new qe(this.m_data)}doAlloc(){return y.createShader(y.FRAGMENT_SHADER)}}class Qe extends ze{constructor(){super(),this.name="ShaderSet",this.isTransparent=!1}clone(){return new Qe}toString(){let t="",e="";return this.forEach(r=>{r.type==="vertex"&&(t=r.data),r.type==="fragment"&&(e=r.data)}),this.name+this.isTransparent+t+e}}class yt extends he{constructor(t){super(),this.matrix=ht(),t&&(this.matrix=t)}copy(t){this.matrix=$t(t.matrix)}clone(){return new yt($t(this.matrix))}toJson(){const t=this.matrix;return{matrix:Array.prototype.slice.call(t)}}}yt.Default=new yt;class ri extends ur{constructor(t){super(t)}bind(){this.m_list.forEach(t=>{t.bind()})}}class ni extends ri{constructor(t,e,r=void 0){const n=new ee;super(n),this.m_transform=new yt(ht()),this.m_transformWorld=new yt(ht()),this.name="TransformBufferObject",this.m_dirty=!1,this.m_drawable=e,this.m_transform=t,this.m_transformWorld=t,this.builtInUniforms=r}set builtInUniforms(t){if(this.m_builtInUniforms=t,!t)return;const r=re.current().uniformLocations,n=Object.keys(r),s=new ee;t.forEach(a=>{n.indexOf(a.name)!==-1&&s.push(a)}),this.m_list=s}get transform(){return this.m_transform}set transform(t){this.m_transform=t,this.m_dirty=!0}get transformWorld(){return this.m_transformWorld}set transformWorld(t){this.m_transformWorld=t}updateMatrixWorld(){let t=Kt.transformFromRoot(this.m_drawable);return this.transformWorld=new yt(t),this}bind(){this.m_dirty&&(this.updateMatrixWorld(),this.m_dirty=!1);const t=this.m_builtInUniforms,e=this.m_builtInUniforms.clone();e.modelMatrix=this.m_transformWorld.matrix,e.update(),this.builtInUniforms=e,super.bind(),this.builtInUniforms=t}}class ii extends ur{constructor(t){super(t),this.load()}bind(){y.getExtension("OES_vertex_array_object").bindVertexArrayOES(this.m_id)}unbind(){y.getExtension("OES_vertex_array_object").bindVertexArrayOES(null)}alloc(){const t=y.getExtension("OES_vertex_array_object");this.m_id=t.createVertexArrayOES()}free(){this.m_id&&(y.getExtension("OES_vertex_array_object").deleteVertexArrayOES(this.m_id),this.m_id=void 0)}load(){this.alloc(),this.bind(),this.m_list.forEach(t=>{t.bind()}),this.unbind()}}class It extends oe{get spec(){return this.m_spec}constructor(t,e,r,n=5126,s=0,a=0,o=!1){super(),this.m_spec={name:t,size:e,componentType:n,stride:s,offset:a,normalized:o},this.m_data=r}clone(){return new It(this.m_spec.name,this.m_spec.size,this.m_data instanceof ArrayBuffer?this.m_data.slice(0):new Float32Array(this.m_data),this.m_spec.componentType,this.m_spec.stride,this.m_spec.offset,this.m_spec.normalized)}toJson(){return this.m_spec}get name(){return this.m_spec.name}set(t,e,r){this.m_spec={name:t,size:e},this.m_data=r,this.m_state>=xt.Buffered&&(this.m_state=xt.Allocated)}get size(){return this.m_spec.size}doAlloc(){return y.createBuffer()}doFree(t){y.deleteBuffer(t)}doLoad(t){this.ext=y.getExtension("ANGLE_instanced_arrays"),y.bindBuffer(y.ARRAY_BUFFER,t),y.bufferData(y.ARRAY_BUFFER,this.m_data,y.STATIC_DRAW)}doBind(t){y.bindBuffer(y.ARRAY_BUFFER,t);const e=this.findAttributeInfo();if(!e)return;const{size:r,componentType:n=5126,normalized:s=!1,stride:a=0,offset:o=0}=this.m_spec;this.ext&&this.ext.vertexAttribDivisorANGLE(e.location,0),y.vertexAttribPointer(e.location,r,this.componentTypeToGL(n),s,a,o),y.enableVertexAttribArray(e.location)}doUnbind(){y.bindBuffer(y.ARRAY_BUFFER,null)}findAttributeInfo(){return re.current().attributeLocations[this.m_spec.name]}componentTypeToGL(t){switch(t){case 5120:return y.BYTE;case 5121:return y.UNSIGNED_BYTE;case 5122:return y.SHORT;case 5123:return y.UNSIGNED_SHORT;case 5125:return y.UNSIGNED_INT;case 5126:return y.FLOAT;default:throw new Error(`Unknown componentType: ${t}`)}}static disableVBO(){let t=y.getParameter(y.MAX_VERTEX_ATTRIBS);for(let e=0;e<t;e++)y.disableVertexAttribArray(e)}}class Me extends ze{constructor(){super()}push(t){t instanceof ue?this.m_ibo=t:t instanceof It&&this.add(t)}get ibo(){return this.m_ibo}clone(){let t=new Me;return this.forEach(e=>{t.push(e.clone())}),this.m_ibo&&t.push(this.m_ibo.clone()),t}}class kr extends he{constructor(t={color:[.8,.9,1,1],depth:1}){super(),this.m_spec={x:0,y:0,width:100,height:100,clearMask:{color:[.8,.9,1,1],depth:1}},this.m_spec.clearMask=t}toJson(){return this.m_spec}set(t){this.m_spec.clearMask=t}get pos(){return[this.m_spec.x,this.m_spec.y]}set pos(t){this.m_spec.x=t[0],this.m_spec.y=t[1]}get size(){return[this.m_spec.width,this.m_spec.height]}set size(t){this.m_spec.width=t[0],this.m_spec.height=t[1]}clear(){let t=0;if(this.m_spec.clearMask.hasOwnProperty("color")){const e=this.m_spec.clearMask.color;y.colorMask(!0,!0,!0,!0),y.clearColor(e[0],e[1],e[2],e[3]),t|=y.COLOR_BUFFER_BIT}if(this.m_spec.clearMask.hasOwnProperty("depth")){const e=this.m_spec.clearMask.depth;y.depthMask(!0),y.clearDepth(e),t|=y.DEPTH_BUFFER_BIT}t!==0&&y.clear(t)}setViewport(){y.viewport(this.m_spec.x,this.m_spec.y,this.m_spec.width,this.m_spec.height)}render(){this.setViewport(),this.clear()}}class qr extends ae{constructor(){super(),this.m_version=1,this.name="Model"}get version(){return this.m_version}update(){this.m_version++}}class _e{constructor(t,e){this.enabled=!0,this.m_model=new qr,this.m_version=0,this.name="RenderPass",this.type="RenderPass",t&&t.camera?(this.camera=t.camera,delete t.camera):this.camera=new fr,t.name&&(this.name=t.name,delete t.name),t&&this.camera.viewport.set(t),e&&(this.m_fbo=e)}get model(){return this.m_model}set model(t){this.m_model!==t&&(this.m_model=t,this.m_version=0)}get size(){return this.camera.viewportSize}set size(t){this.camera.viewportSize=t,this.m_fbo&&(this.m_fbo.size=t)}get queue(){return this.m_queue}get queueVBO(){const t=[];return this.m_queue.forEach(e=>{e.m_spec&&e.m_spec.name&&e.m_spec.name==="aVertex"&&t.push(e)}),t}updateQueue(){this.m_version!==this.m_model.version&&(this.destroyQueue(),this.createQueue(),this.m_version=this.m_model.version)}createQueue(){const t=[],e=(o,c)=>{o.visible&&o instanceof ae?o.forEach(d=>{let v=null;d.transform&&(v=new yt($t(d.transform.matrix))),c&&(v?Lt(v.matrix,c.matrix,v.matrix):v=new yt($t(c.matrix))),e(d,v)}):o.visible&&o instanceof kt&&o.drawables.forEach(d=>{if(!d.visible)return;let v=ht();c&&Lt(v,c.matrix,d.tbo.transform.matrix),d.tbo.transformWorld=new yt(v),t.push(d)})};e(this.m_model,this.m_model.transform);const r=new Map,n=new Map;t.forEach(o=>{var c;const d=o.effect.shaders,v=d.toString();r.has(v)||n.set(v,d),((c=r.get(v))!==null&&c!==void 0?c:r.set(v,[]).get(v)).push(o)});const s=[];n.forEach((o,c)=>{o.isTransparent?s.push(c):s.unshift(c)});const a=[];a.push(Bt.Default),a.push(ie.Default),a.push(new ut(!0)),a.push(Ht.Default),s.forEach(o=>{const c=r.get(o),d=n.get(o),v=new re(d);v.name="Program["+d.name+"]",v.bind(),a.push(v),c.forEach(_=>{_.tbo.builtInUniforms=this.camera.builtInUniforms,a.push(_.tbo),_.effect.states.forEach(b=>{a.push(b)}),_.geometry.vbos&&(_.geometry.vbos.forEach(b=>{a.push(b)}),_.geometry.vbos.ibo&&a.push(_.geometry.vbos.ibo)),_.effect.uniforms.forEach(b=>{[].indexOf(b.name)===-1&&a.push(b)}),_.geometry.drawers&&_.geometry.drawers.forEach(b=>{a.push(b)})})}),this.m_queue=a}destroyQueue(){this.m_queue&&(this.m_queue.forEach(t=>{(t instanceof re||t instanceof ii)&&t.free()}),this.m_queue)}render(){this.enabled&&(this.m_fbo&&this.m_fbo.bind(),this.updateQueue(),this.camera.viewport.render(),this.m_queue&&this.m_queue.forEach(t=>{t.bind()}),this.m_fbo&&this.m_fbo.unbind())}get fbo(){return this.m_fbo}}_e.type="RenderPass";class Ze extends Array{constructor(){super(),this.enabled=!0,this.name="RenderPassGroup"}get size(){if(this.length>0)return this[0].size}set size(t){this.forEach(e=>{e.size=t})}render(){this.enabled&&this.forEach(t=>{t.render()})}debugRender(){this.enabled&&(console.log(`===${this.name}=========================================`),console.time("ALL TIME"),this.forEach(t=>{t.enabled&&(console.log(" ~ RenderPassGroup ~ this.forEach ~ renderPass:",t),console.time(t.name),t.render(),console.timeEnd(t.name))}),console.timeEnd("ALL TIME"),console.log(`=========================================${this.name}===`))}}class Mr extends _e{constructor(t){const e=new $e({color:{format:"rgba",type:"unsigned_byte"},depth:{format:"depth_component16"}});super(t,e)}}class Jr extends Ze{constructor(t){super(),this.name="scene",this.m_renderContext=t}render(){this.m_renderContext.makeCurrent(),super.render()}debugRender(){this.m_renderContext.makeCurrent(),super.debugRender()}get renderContext(){return this.m_renderContext}set renderContext(t){this.m_renderContext=t}free(t){this.m_renderContext.makeCurrent(),Array.isArray(t)?t.forEach(e=>{e.free()}):t.free()}}class pr extends _e{constructor(t,e){super({}),this.VertexData=[],this.scalarData=[],this.mapId2Selectable=new Map,this.mapId2SelectableId=new Map,this.mapId2SelectableFaceId=new Map,this.arySelectableTriangle=[],this.arySelectableLine=[],this.arySelectablePoint=[],this.idVertices=1,this.lineStart=193<<24>>>0,this.triangleStart=129<<24>>>0,this.pointStart=51<<24>>>0,this.currentSelectPartType="",this.drawable=(s,a,o,c)=>{const d=new Vt;d.push(a),d.push(o.clone()),c&&d.push(new ut(!0)),s.drawables.push(d)},this.m_snapshot=new Nn(e),this.m_snapshot.alloc(),this.camera.builtInUniforms=t;const r=new pt;r.vertexCompiler.assemblePosition(),r.vertexCompiler.attach("position = vec4(position.x,position.y,position.z-0.01 ,position.w);"),r.fragmentCompiler.attach("color = vec4(0, 1, 0, 1);"),this.m_effLine=r.generate(),this.m_lineFboEff=new Xr().init(),this.m_pointFboEff=this.createFBOEffect().generate(),this.m_fboEff=this.createInstanceFBOEffect().generate();const n=new pt;n.vertexCompiler.assemblePosition(),n.vertexCompiler.attach("position = vec4(position.x,position.y,position.z-0.001 ,position.w);"),n.fragmentCompiler.attach("color = vec4(0.2, 0.7 , 1, 1);")}createInstanceFBOEffect(){const t=new pt;return t.vertexCompiler.assembleInstancedPositionColor(),t.vertexCompiler.attach("position = vec4(position.x,position.y,position.z-0.01 ,position.w);"),t.fragmentCompiler.assembleInstancedColor(),t.vertexCompiler.assemblePointSize(),t.uniforms.add(new it("uPointSize",5)),t}createFBOEffect(){const t=new pt;return t.vertexCompiler.assemblePosition(),t.vertexCompiler.attach("position = vec4(position.x,position.y,position.z-0.01 ,position.w);"),t.fragmentCompiler.assembleColor(),t.vertexCompiler.assemblePointSize(),t.uniforms.add(new it("uPointSize",5)),t.uniforms.add(new it("uColor",new Xt(1,1,1,1).toRgbaArray())),t}build(t,e={}){this.scalarData=t.model.scalar?t.model.scalar:[],this.updateIdModel(t,e)}getIdRenderPass(){this.idRenderPass=new Ze,this.idRenderPass.enabled=!1;let t=new Mr({color:[0,0,0,0],depth:1});t.name="Selector.idRenderPass1",this.idRenderPass.push(t),t.camera.builtInUniforms=this.camera.builtInUniforms;let e=new Mr({color:[0,0,0,0],depth:1});return e.name="Selector.idRenderPass2",e.enabled=!1,this.idRenderPass.push(e),this.idRenderPass}updateIdModel(t,e){const r=this.idRenderPass[0].model;r.clear(),this.mapId2Selectable.clear(),this.mapId2SelectableId.clear(),this.mapId2SelectableFaceId.clear(),this.database=t,this.data=e;const n=e.seeNode?e.seeNode:!1,s=e.postPart?e.postPart:!1,a=d=>{const v=(d&255)/255;d>>>=8;const _=(d&255)/255;d>>>=8;const b=(d&255)/255;d>>>=8;const f=(d&255)/255;return new Float32Array([v,_,b,f])};if(!t)return;const o=t.model;let c;o?(c=o.parts,this.dataParts=o.parts):this.dataParts=[],c.forEach(d=>{var v,_;if((d.type==1||s)&&n){const b=d.vbos,f=(v=Array.from(b.values()).find(g=>g.name=="aVertex"))===null||v===void 0?void 0:v.data;this.VertexData=f;const m=(_=Array.from(d.vbos.values()).find(g=>g.name=="aVertex"))===null||_===void 0?void 0:_.data,l=d.vbos.ibo;this.triangleStart-this.pointStart;let p=this.lineStart-this.triangleStart;{const g=[];for(let X=0;X<l.data.length/3;++X){const T=l.data.length/3;let U=Math.trunc(X/T*p+this.triangleStart);const u=a(U);g.push(...u,...u,...u),this.mapId2SelectableFaceId.set(U,X)}const x=new It("aColor",4,new Float32Array(g)),A=((X,T)=>{const U=new Array(T.length*3);return T.forEach((u,W)=>{U[W*3]=X[u*3],U[W*3+1]=X[u*3+1],U[W*3+2]=X[u*3+2]}),U})(m,l.data),R=new It("aVertex",3,new Float32Array(A)),F=new Gt;F.push(R),F.push(x);const L=vt.createFaceColor().generate(),j=new Vt,B=new pe("triangles",0,l.data.length);F.push(B),j.push(F),j.push(L);const Q=new kt;Q.addDrawable(j),r.add(Q)}}else this.VertexData=[];if(d.visible&&d.type!=1){const b=d.vbos,f=new ke,m=[];let l=0;b.ibo&&b.ibo.data&&(l=b.ibo.data.length),d.type==Ge.geom&&(l=d.edges.vbos.ibo.data.length);let p=this.lineStart+Math.floor(Math.random()*(4294967295-this.lineStart));m.push({count:l,offset:0,color:a(p),type:d.type}),f.push(new pr.FaceDrawer(m));const g=this.m_lineFboEff.clone(),x=new Vt;x.push(b),x.push(g),x.push(f);const w=new kt;w.drawables.push(x),w.id=""+d.id,r.add(w),this.mapId2Selectable.set(p,w)}}),this.selectModel=r,r.update(),this.updateDilationModel()}updateDilationModel(){const t=this.idRenderPass[1].model;t.clear();const e=new kt;let r=new Fn(this.idRenderPass[0].size[0],this.idRenderPass[0].size[1]);const n=new It("aVertex",2,r.vertices),s=new It("aNormal",3,r.normals),a=new ue(r.indices),o=new Ie("triangles",r.indices.length,"unsigned_short",0),c=new Gt;c.push(n),c.push(s),c.push(a);const d=new It("aTexCoord",2,r.uvs);c.push(d),c.push(o);let v=this.idRenderPass[0].fbo.buffers.color,_=vt.createDilationColor(v,129,193,new Int32Array(this.idRenderPass[0].size),0).generate();const b=new Vt;b.push(c),b.push(_),e.addDrawable(b),t.add(e),t.update(),this.idRenderPass[1].enabled=!0}updateTexture(t=!1){t&&this.updateIdModel(this.database,this.data),this.idRenderPass.enabled=!0,this.idRenderPass.render();let e=1;this.idRenderPass&&this.idRenderPass[e].fbo&&(this.imageData=this.idRenderPass[e].fbo.read()),this.idRenderPass.enabled=!1}getId(t,e){var r,n,s,a;let o=null,c=-1;const d=new qr;if(this.model.clear(),this.imageData){let l=this.imageData.width*(this.imageData.height-t[1]-1)*4+t[0]*4;this.imageData.data[l],this.imageData.data[l]+this.imageData.data[l+1]+this.imageData.data[l+2]+this.imageData.data[l+3]>0&&(o=On.color2Id(this.imageData.data[l],this.imageData.data[l+1],this.imageData.data[l+2],this.imageData.data[l+3]))}if(o===null)return this.model.update(),{partId:void 0};if(o<0)return{partId:o};if(this.mapId2SelectableId.get(o))c=Number(this.mapId2SelectableId.get(o)),this.currentSelectPartType="point";else if(this.mapId2Selectable.get(o)){const l=this.mapId2Selectable.get(o);l instanceof kt&&(c=Number(l.id)),this.currentSelectPartType="line"}else if(this.mapId2SelectableFaceId.get(o)){c=Number(this.mapId2SelectableFaceId.get(o)),this.currentSelectPartType="triangle";const l=(r=Array.from(this.dataParts[0].vbos.values()).find(U=>U.name=="aVertex"))===null||r===void 0?void 0:r.data,p=this.dataParts[0].vbos.ibo,g=[p.data[c*3],p.data[c*3+1],p.data[c*3+2]],x=[l[g[0]*3],l[g[0]*3+1],l[g[0]*3+2],l[g[1]*3],l[g[1]*3+1],l[g[1]*3+2],l[g[2]*3],l[g[2]*3+1],l[g[2]*3+2]],w=new It("aVertex",3,new Float32Array(x)),A=(n=Array.from(this.dataParts[0].faces.vbos.values()).find(U=>U.name=="aScalar"))===null||n===void 0?void 0:n.data;if(!A)return{partId:void 0};const R=new It("aScalar",1,new Float32Array([A[g[0]],A[g[1]],A[g[2]]])),F=new Gt;F.push(w),F.push(R);const L=vt.createColor().generate(),j=new Vt,B=new pe("triangles",0,3);F.push(B),j.push(F),j.push(L);const Q=new kt;Q.addDrawable(j);const X=new si(this.camera);X.setModel(Q);const T=X.rayCast(t);if(T[0])this.selectPostion=T[0].point,this.selectScalar=(s=T[0].attributes)===null||s===void 0?void 0:s.aScalar;else return{partId:void 0}}let v;c>0&&this.VertexData.length==0&&((a=this.dataParts)===null||a===void 0||a.map(l=>{if(l.id==Number(c)){v=l;let p=new kt;const g=this.m_effLine.clone();this.drawable(p,l.edges,g,!0),d.add(p)}}));let _={x:0,y:0,z:0},b=[],f;if(c>0&&this.VertexData.length>0){const l=new kt,p=this.m_pointFboEff.clone(),g=new Gt;if(this.currentSelectPartType=="triangle")if(this.selectPostion){const x=new Float32Array([this.selectPostion[0],this.selectPostion[1],this.selectPostion[2]]),w=new It("aVertex",3,x);g.push(w),g.push(new pe("points",0,1));const A=new Vt;A.push(g),A.push(p),l.addDrawable(A),d.add(l),f=this.dataParts[0].vbos.ibo.data[c*3],b=this.scalarData.map(F=>{let L=F.children[0].data[0].value;return{title:F.label,value:Array.from(L.values())[f]}}),_={x:x[0],y:x[1],z:x[2]}}else return{partId:void 0}}e&&(this.model=d);const m=Math.floor(this.selectScalar*100)/100;return this.model.update(),f&&(c=f),{partId:c,resData:v,nodeData:{position:_,activeScalar:b,selectScalar:m}}}update(t=!1){this.updateTexture(t)}flip(t){const e=t.width,r=t.height,n=Math.floor(r/2),s=t.data;for(let a=0;a<n;a++){const o=a*e*4,c=(r-a-1)*e*4;for(let d=0;d<e*4;d++){const v=s[o+d];s[o+d]=s[c+d],s[c+d]=v}}return t}saveImg(){if(this.imageData){let t=this.flip(this.m_snapshot.take(this.camera.builtInUniforms,this.idRenderPass[0].model));new Er().save(t,"fbo0");let r=this.flip(this.m_snapshot.take(this.camera.builtInUniforms,this.idRenderPass[1].model));new Er().save(r,"fbo1")}}dispose(){this.m_snapshot.free(),te(this.m_fboEff),te(this.m_effLine),te(this.m_lineFboEff),te(this.m_pointFboEff),this.idRenderPass&&this.idRenderPass.forEach(t=>{(t instanceof _e||t instanceof Ze)&&te(t)})}}pr.FaceDrawer=class extends Ie{constructor(i){super("line_strip",2,"unsigned_int",0),this.faceColors=i}draw(){const t=re.current().uniformLocations.uColor.location;this.faceColors.forEach(e=>{y.uniform4fv(t,e.color),(e.type==Ge.geom||e.type==4)&&y.drawArrays(y.LINE_STRIP,0,e.count)})}};class si{constructor(t){this.selectModel=new ae,this.ray=new ar,this.camera=t}setModel(t){t instanceof ae?this.selectModel=t:t instanceof kt?this.selectModel.addPart(t):console.error("The parameter can only be of the type PartGroup | Part. Please check and ensure that the passed parameter conforms to this type requirement.")}rayBox(t,e){const r=[];if(!this.selectModel)return r;const n=this.ray.setFromCamera(t,this.camera);new Ut().expandByPartGroup(this.selectModel);const s=a=>{a.forEach(o=>{if(o.type==="PartGroup")s(o);else{const c=o.drawables.some(v=>{let _=!1;return v.geometry.drawers.forEach(b=>{b.mode=="lines",_=!0}),_});let d=new Ut;d.copy(o.boundingBox),e&&c&&d.expand(2*e),n.intersectsBox(d)&&r.push(o)}})};return s(this.selectModel),r}rayCast(t){const e=[],r=this.getTolerance(4),n=this.rayBox(t,r);let s=this.ray.clone();return n.forEach(a=>{a.drawables.forEach(o=>{const c=o.raycast({ray:s,intersectionTolerance:r});c.length>0&&e.push(...c)})}),e}getTolerance(t=4){const e=this.camera.builtInUniforms.viewportSize,r=this.camera.builtInUniforms.projectionMatrix,s=At.getOrthoSize(r)[0]/e[0];return t*s}debugRay(){let t=Ae(et(),this.ray.direction,1e4);t=dt(et(),this.ray.origin,t);const e=new Un(this.ray.origin,t);return e.update({point1:{x:this.ray.origin[0],y:this.ray.origin[1],z:this.ray.origin[2]},point2:{x:t[0],y:t[1],z:t[2]}}),e}}function jt(i,t){let e=mn(Pr(),fe(i[0],i[1],i[2],1),t);return K(e[0]/e[3],e[1]/e[3],e[2]/e[3])}function ai(i,t){const e=i[0],r=i[1],n=i[2],s=et();return s[0]=t[0]*e+t[4]*r+t[8]*n,s[1]=t[1]*e+t[5]*r+t[9]*n,s[2]=t[2]*e+t[6]*r+t[10]*n,wt(et(),s)}class Ut{constructor(t,e){this.m_min=K(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.m_max=K(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),t&&(this.min=t),e&&(this.max=e)}get min(){return this.m_min}set min(t){le(this.m_min,t)}get max(){return this.m_max}set max(t){le(this.m_max,t)}get size(){return this.isEmpty?K(0,0,0):Tt(et(),this.max,this.min)}get length(){return zt(this.size)}get isEmpty(){return this.max[0]<this.min[0]||this.max[1]<this.min[1]||this.max[2]<this.min[2]}center(){const t=et();dt(t,this.m_min,this.m_max);const e=t.length;for(let r=0;r<e;++r)t[r]/=2;return t}expandByPart(t,e=!1,r="aVertex"){return this.unset(),t.drawables.forEach(n=>{e&&n.computeBoundingBox(r),this.add(n.boundingBox)}),t.updateTransformWorld(),this.transform(t.transformWorld.matrix),t.m_boundingBox=this,this}expandByPartGroup(t,e=!1,r="aVertex",n=!0){return this.unset(),t.forEach(s=>{s.type==="PartGroup"?this.add(new Ut().expandByPartGroup(s,e,r,!1)):this.add(new Ut().expandByPart(s,e,r))}),n&&(t.updateTransformWorld(),this.transform(t.transformWorld.matrix)),t.m_boundingBox=this,this}expandByGroupWithFilter(t,e,r=!1,n="aVertex"){return this.unset(),t.forEach(s=>{s.type==="PartGroup"?this.add(new Ut().expandByGroupWithFilter(s,e,r,n)):this.add(new Ut().expandByPartWithFilter(s,e,r,n))}),t.updateTransformWorld(),this.transform(t.transformWorld.matrix),this}expandByPartWithFilter(t,e,r=!1,n="aVertex"){return this.unset(),e(t)&&t.drawables.forEach(s=>{r&&s.computeBoundingBox(n),this.add(s.boundingBox)}),t.updateTransformWorld(),this.transform(t.transformWorld.matrix),this}expandByDrawable(t,e=!1,r="aVertex"){return this.unset(),e&&t.computeBoundingBox(r),this.copy(t.boundingBox)}expandByVBO(t){if(!t)throw new Error("vbo");return this.update(t.data)}update(t){this.unset();const e=Math.floor(t.length/3);for(let r=0;r<e;r++)this.addPoint(K(t[r*3],t[r*3+1],t[r*3+2]));return this}extent(){const t=et();return Tt(t,this.m_max,this.m_min),t}setAbsMax(){const t=this.m_min,e=this.m_max,r=Math.min(-Math.abs(t[0]),-Math.abs(e[0]),-Math.abs(t[1]),-Math.abs(e[1]),-Math.abs(t[2]),-Math.abs(e[2])),n=Math.max(Math.abs(t[0]),Math.abs(e[0]),Math.abs(t[1]),Math.abs(e[1]),Math.abs(t[2]),Math.abs(e[2]));return ge(this.m_min,r,r,r),ge(this.m_max,n,n,n),this}expand(t){const e=t/2,r=this.m_min.length;for(let s=0;s<r;s++)this.m_min[s]-=e;const n=this.m_max.length;for(let s=0;s<n;s++)this.m_max[s]+=e}copy(t){return this.min=St(t.min),this.max=St(t.max),this}clone(){const t=new Ut;return t.copy(this),t}isValid(){const t=this.m_min,e=this.m_max;return t[0]<=e[0]&&t[1]<=e[1]&&t[2]<=e[2]}unset(){ge(this.m_min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),ge(this.m_max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}addPoint(t){const e=this.m_min,r=this.m_max;ge(this.m_min,Math.min(e[0],t[0]),Math.min(e[1],t[1]),Math.min(e[2],t[2])),ge(this.m_max,Math.max(r[0],t[0]),Math.max(r[1],t[1]),Math.max(r[2],t[2]))}add(t){t instanceof Ut?t.isValid()&&(this.addPoint(t.m_min),this.addPoint(t.m_max)):this.addPoint(t)}scale(t){Ae(this.m_min,this.m_min,t),Ae(this.m_max,this.m_max,t)}transform(t){if(!this.isValid())return;const e=this.m_min,r=this.m_max;let n=et();const s=new Ut;Jt(n,K(e[0],e[1],e[2]),t),s.add(n),Jt(n,K(r[0],e[1],e[2]),t),s.add(n),Jt(n,K(e[0],r[1],e[2]),t),s.add(n),Jt(n,K(r[0],r[1],e[2]),t),s.add(n),Jt(n,K(e[0],e[1],r[2]),t),s.add(n),Jt(n,K(r[0],e[1],r[2]),t),s.add(n),Jt(n,K(e[0],r[1],r[2]),t),s.add(n),Jt(n,K(r[0],r[1],r[2]),t),s.add(n),this.copy(s)}intersectsWithAABB(t){const e=this.min,r=this.max,n=t.min,s=t.max,a=e[0]<=s[0]&&r[0]>=n[0],o=e[1]<=s[1]&&r[1]>=n[1],c=e[2]<=s[2]&&r[2]>=n[2];return a&&o&&c}}class Ct{constructor(t=0,e=1){this.m_min=t,this.m_max=e}get min(){return this.m_min}set min(t){this.m_min=t}get max(){return this.m_max}set max(t){this.m_max=t}set(t,e){this.m_min=t,this.m_max=e}copy(t){this.m_min=t.m_min,this.m_max=t.m_max}clone(){const t=new Ct;return t.copy(this),t}toArray(){return new Float32Array([this.m_min,this.m_max])}center(){return(this.m_min+this.m_max)/2}length(){return this.m_max-this.m_min}inRange(t){return this.m_max>=t&&this.m_min<=t}relativeOf(t){return t<this.m_min?0:t>this.m_max?1:(t-this.m_min)/(this.m_max-this.m_min)}isValid(){return this.min<=this.max}addValue(t){this.min=Math.min(this.min,t),this.max=Math.max(this.max,t)}add(t){t instanceof Ct?(this.addValue(t.min),this.addValue(t.max)):this.addValue(t)}}class oi{constructor(){this.m_eye=K(0,0,1),this.m_right=K(1,0,0),this.m_up=K(0,1,0),this.m_dir=K(0,0,-1)}get eye(){return this.m_eye}set eye(t){this.m_eye=t}get right(){return this.m_right}set right(t){this.m_right=t}get up(){return this.m_up}set up(t){this.m_up=t}get dir(){return this.m_dir}set dir(t){this.m_dir=t}}var de;(function(i){i.getSpecificaiton=t=>{const e=ht();me(e,t);const r=e,n=new oi;return n.eye=K(r[12],r[13],r[14]),n.right=K(r[0],r[1],r[2]),n.up=K(r[4],r[5],r[6]),n.dir=K(r[8],r[9],r[10]),n},i.setSpecificaiton=(t,e)=>{const r=et();wt(r,e.up);const n=et();wt(n,e.dir);const s=et();Rt(s,r,n);const a=t;a[0]=s[0],a[1]=s[1],a[2]=s[2],a[4]=r[0],a[5]=r[1],a[6]=r[2],a[8]=n[0],a[9]=n[1],a[10]=n[2],a[12]=e.eye[0],a[13]=e.eye[1],a[14]=e.eye[2],me(t,t)},i.lookAt=(t,e,r,n)=>{const s=et();wt(s,n);const a=et();Tt(a,e,r),wt(a,a);const o=et();Rt(o,s,a),wt(o,o);const c=t;c[0]=o[0],c[1]=o[1],c[2]=o[2],c[4]=s[0],c[5]=s[1],c[6]=s[2],c[8]=a[0],c[9]=a[1],c[10]=a[2],c[12]=e[0],c[13]=e[1],c[14]=e[2],me(t,t)}})(de||(de={}));var At;(function(i){i.getOrthoSize=t=>{const e=2/t[0],r=2/t[5];return[e,r]},i.setOrthoSize=(t,e)=>{const r=-e[0]/2,n=e[0]/2,s=-e[1]/2,a=e[1]/2;t[0]=2/(n-r),t[5]=2/(a-s),t[12]=-(n+r)/(n-r),t[13]=-(a+s)/(a-s)},i.getOrthoRange=t=>{const e=(t[14]-1)/(t[14]+1),r=2/(t[10]*(1-e)),n=r*e;return new Ct(r,n)},i.setOrthoRange=(t,e)=>{const r=e.min,n=e.max;t[10]=-2/(n-r),t[14]=-(n+r)/(n-r)},i.getAspect=t=>{const e=i.getOrthoSize(t);return e[1]>0?e[0]/e[1]:0},i.setAspect=(t,e)=>{const r=i.getOrthoSize(t);r[0]=r[1]*e,i.setOrthoSize(t,r)}})(At||(At={}));class Je{constructor(t){this.m_uniforms=t}}class ci extends Je{constructor(t,e){super(t),this.m_current=e}update(t){const e=ir();Nr(e,t,this.m_current),e[1]=-e[1],this.m_current=t;const r=this.m_uniforms.viewMatrix,n=this.m_uniforms.viewportSize,s=r,a=K(s[0],s[4],s[8]),o=K(s[1],s[5],s[9]),c=K(s[2],s[6],s[10]),d=_n(e)/n[1]*Math.PI*2;gn(e,e),wt(a,a);for(let g=0;g<a.length;++g)a[g]*=e[0];wt(o,o);for(let g=0;g<o.length;++g)o[g]*=e[1];const v=et();dt(v,v,a),dt(v,v,o);const _=St(c);Rt(_,_,v),wt(_,_);const b=er();Fr(b,_,d);const f=this.m_uniforms.orbitPoint,m=St(f);Rr(m,m);const l=ht();Ve(l,l,f);const p=ht();ln(p,b),Lt(l,l,p),Ve(l,l,m),Lt(r,r,l),this.m_uniforms.viewMatrix=r}}class li extends Je{constructor(t,e){super(t),this.m_current=e}update(t){const e=ir();Nr(e,t,this.m_current),e[1]=-e[1],this.m_current=t;const r=this.m_uniforms.viewMatrix,n=this.m_uniforms.viewportSize,s=r,a=K(s[0],s[4],s[8]),o=K(s[1],s[5],s[9]);K(s[2],s[6],s[10]);const c=this.m_uniforms.projectionMatrix,d=At.getOrthoSize(c),v=Wt(d[0]*e[0]/n[0],d[1]*e[1]/n[1]);wt(a,a);for(let f=0;f<a.length;++f)a[f]*=v[0];wt(o,o);for(let f=0;f<o.length;++f)o[f]*=v[1];const _=et();dt(_,_,a),dt(_,_,o);const b=ht();Ve(b,b,_),Lt(r,r,b),this.m_uniforms.viewMatrix=r}}class Yt extends Je{constructor(t){super(t),this.range=new Ct}update(){}updateRangeMVP(t){const e=this.m_uniforms.viewportSize,r=e[0]/e[1],n=t.extent(),s=zt(n)*Yt.s_factor,a=zt(n)*1.125,o=a*r,c=1,d=s*1.2,v=ht();At.setOrthoSize(v,[o,a]),this.range.set(c,d),At.setOrthoRange(v,this.range),this.m_uniforms.projectionMatrix=v}eyeHome(t,e,r=[-1,2,-1],n=35.264){const s=this.m_uniforms.viewportSize,a=s[0]/s[1],o=e.center(),c=t.extent(),d=e.extent(),v=zt(d)*Yt.s_factor;let _=zt(c)*1.125;(_===1/0||isNaN(_))&&(_=zt(d)*1.125);const b=_*a,f=v*.5,m=v*1.5,l=o,p=et(),g=v*Math.sqrt(3)/3;wt(r,r);const x=Math.tan(n*Math.PI/180)*Math.pow(g*g*2,.5);r[0]>0?dt(p,l,K(x,g,g)):r[1]>0?dt(p,l,K(g,x,g)):r[2]>0&&dt(p,l,K(g,g,x));const w=ht();un(w,p,l,r),this.m_uniforms.viewMatrix=w;const A=ht();At.setOrthoSize(A,[b,_]),this.range.set(f,m),At.setOrthoRange(A,this.range),this.m_uniforms.projectionMatrix=A,this.m_uniforms.orbitPoint=o}updateRange(t){const e=t.center(),r=t.extent(),n=zt(r)*Yt.s_factor,s=n*.5,a=n*1.5;this.range.set(s,a);const o=$t(this.m_uniforms.projectionMatrix);At.setOrthoRange(o,this.range),this.m_uniforms.projectionMatrix=o,this.m_uniforms.orbitPoint=e}home(t,e=[-1,2,-1]){const r=this.m_uniforms.viewportSize,n=r[0]/r[1],s=t.center(),a=t.extent(),o=zt(a)*Yt.s_factor,c=zt(a)*1.125,d=c*n,v=o*.5,_=o*1.5,b=s,f=et(),m=o*Math.sqrt(3)/3;dt(f,b,K(m,m,m)),wt(e,e);const l=ht();de.lookAt(l,f,b,e),this.m_uniforms.viewMatrix=l;const p=ht();At.setOrthoSize(p,[d,c]),this.range.set(v,_),At.setOrthoRange(p,this.range),this.m_uniforms.projectionMatrix=p,this.m_uniforms.orbitPoint=s}fit(t){const e=this.m_uniforms.viewportSize,r=e[0]/e[1],n=t.center(),s=t.extent(),a=zt(s)*Yt.s_factor,o=zt(s)*1.125,c=o*r,d=a*.5,v=a*1.5,_=this.m_uniforms.viewMatrix,b=de.getSpecificaiton(_),f=St(n);dt(f,f,b.dir),wt(f,f);for(let l=0;l<f.length;++l)f[l]*=a;b.eye=f,de.setSpecificaiton(_,b),this.m_uniforms.viewMatrix=_;const m=ht();At.setOrthoSize(m,[c,o]),this.range.set(d,v),At.setOrthoRange(m,this.range),this.m_uniforms.projectionMatrix=m}lookFrom(t,e,r){const n=e.center(),s=e.extent(),a=zt(s)*Yt.s_factor,o=n;let c=et();dt(c,St(n),K(0,0,a));let d;switch(t){case"x":dt(c,St(n),K(a,0,0)),d=r||K(0,1,0);break;case"y":dt(c,St(n),K(0,a,0)),d=r||K(0,0,-1);break;case"z":dt(c,St(n),K(0,0,a)),d=r||K(0,1,0);break;case"-x":dt(c,St(n),K(-a,0,0)),d=r||K(0,1,0);break;case"-y":dt(c,St(n),K(0,-a,0)),d=r||K(0,0,1);break;case"-z":dt(c,St(n),K(0,0,-a)),d=r||K(0,1,0);break;default:d=r||K(0,1,0)}const v=ht();de.lookAt(v,c,o,d),this.m_uniforms.viewMatrix=v;const _=this.m_uniforms.viewportSize,b=_[0]/_[1],f=zt(s)*1.125,m=f*b,l=a*.5,p=a*1.5,g=ht();At.setOrthoSize(g,[m,f]),At.setOrthoRange(g,new Ct(l,p)),this.m_uniforms.projectionMatrix=g,this.m_uniforms.orbitPoint=n}lookFromByExtent(t,e,r,n){const s=e.center(),a=e.extent(),o=zt(a)*Yt.s_factor,c=s;let d=et();dt(d,St(s),K(0,0,o));let v;switch(t){case"x":dt(d,St(s),K(o,0,0)),v=n||K(0,1,0);break;case"y":dt(d,St(s),K(0,o,0)),v=n||K(0,0,-1);break;case"z":dt(d,St(s),K(0,0,o)),v=n||K(0,1,0);break;case"-x":dt(d,St(s),K(-o,0,0)),v=n||K(0,1,0);break;case"-y":dt(d,St(s),K(0,-o,0)),v=n||K(0,0,1);break;case"-z":dt(d,St(s),K(0,0,-o)),v=n||K(0,1,0);break;default:v=n||K(0,1,0)}const _=ht();de.lookAt(_,d,c,v),this.m_uniforms.viewMatrix=_;const b=this.m_uniforms.viewportSize,f=b[0]/b[1];let m,l;r==="width"?(m=a[0],l=m/f):r==="height"&&(l=a[1],m=a[0]*f);const p=o*.5,g=o*1.5,x=ht();At.setOrthoSize(x,[m,l]),At.setOrthoRange(x,new Ct(p,g)),this.m_uniforms.projectionMatrix=x,this.m_uniforms.orbitPoint=s}}Yt.s_factor=3;class ui extends Je{constructor(t){super(t)}update(t,e){const r=this.m_uniforms.projectionMatrix,n=At.getOrthoSize(r);n[0]=n[0]*e,n[1]=n[1]*e,At.setOrthoSize(r,n),this.m_uniforms.projectionMatrix=r;const s=this.m_uniforms.viewMatrix,a=this.m_uniforms.viewportSize,o=s,c=K(o[0],o[4],o[8]),d=K(o[1],o[5],o[9]);K(o[2],o[6],o[10]);const v=((t[0]+.5)/a[0]-.5)*(1/e-1)*n[0];wt(c,c);for(let m=0;m<c.length;++m)c[m]*=v;Rr(c,c);const _=((t[1]+.5)/a[1]-.5)*(1/e-1)*n[1];wt(d,d);for(let m=0;m<d.length;++m)d[m]*=_;const b=et();dt(b,c,d);const f=ht();Ve(f,f,b),Lt(s,s,f),this.m_uniforms.viewMatrix=s}}var rr=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});function hi(){var i=new rr(2);return rr!=Float32Array&&(i[0]=0,i[1]=0),i}function nr(i,t){var e=new rr(2);return e[0]=i,e[1]=t,e}(function(){var i=hi();return function(t,e,r,n,s,a){var o,c;for(e||(e=2),r||(r=0),n?c=Math.min(n*e+r,t.length):c=t.length,o=r;o<c;o+=e)i[0]=t[o],i[1]=t[o+1],s(i,i,a),t[o]=i[0],t[o+1]=i[1];return t}})();class fi{m_buildInUniforms;m_action;m_type="none";onRender;dpr;constructor({builtInUniforms:t,onRender:e,dpr:r=1}){this.m_buildInUniforms=t,this.onRender=e,this.dpr=r}bindEvents(t){t.addEventListener("mousedown",this.handleMouseDown.bind(this),!1),t.addEventListener("mousemove",this.handleMouseMove.bind(this),!1),t.addEventListener("mouseup",this.handleMouseUp.bind(this),!1)}unbindEvents(t){t.removeEventListener("mousedown",this.handleMouseDown.bind(this)),t.removeEventListener("mousemove",this.handleMouseMove.bind(this)),t.removeEventListener("mouseup",this.handleMouseUp.bind(this))}handleMouseDown(t){const e=nr(t.offsetX*this.dpr,t.offsetY*this.dpr);switch(t.button){case 0:this.begin("orbit",e);break;case 2:this.begin("pan",e);break}}handleMouseMove(t){const e=nr(t.offsetX*this.dpr,t.offsetY*this.dpr);this.move(e)}handleMouseUp(){this.end()}begin(t,e){switch(t){case"pan":this.m_action=new li(this.m_buildInUniforms,e),this.m_type=t;break;case"orbit":this.m_action=new ci(this.m_buildInUniforms,e),this.m_type=t;break}(t==="pan"||t==="orbit")&&this.onRender()}move(t){this.m_action&&(this.m_action.update(t),this.onRender())}end(){this.m_action&&(this.m_action=void 0,this.m_type="none",this.onRender())}destroy(t){this.unbindEvents(t)}}const di=i=>new fi(i);class _i{canvas;renderContext;renderPass;scene;mouseHandler;dpr=window.devicePixelRatio||1;get model(){return this.renderPass.model}get builtInUniforms(){return this.renderPass.camera.builtInUniforms}constructor(t,e){if(!t)throw new Error("Canvas element is required.");this.canvas=t;const r=this.canvas.getContext("webgl2",{stencil:!1});if(!r)throw new Error("WebGL2 context is not supported.");this.renderContext=new Or(r,[]),this.renderPass=new _e({color:[.8,.8,.8,1],depth:1}),this.scene=new Jr(this.renderContext),this.scene.push(this.renderPass),this.setSize(e.width,e.height),this.mouseHandler=di({builtInUniforms:this.builtInUniforms,onRender:()=>{this.scene&&this.scene.render()},dpr:this.dpr}),this.canvas.oncontextmenu=n=>{n.preventDefault()}}addPart(t){this.model.add(t),this.model.update()}addGeneralEventListener(){this.addMouseEventListener(),this.addMouseWheelEventListener(),this.addWindowResizeListener()}addMouseEventListener(){this.mouseHandler.bindEvents(this.canvas)}addMouseWheelEventListener(){this.canvas.addEventListener("wheel",t=>{const e=new ui(this.builtInUniforms),r=nr(t.offsetX*this.dpr,t.offsetY*this.dpr);e.update(r,t.deltaY<0?1.1:1/1.1),this.scene.render()},!1)}addWindowResizeListener(){window.addEventListener("resize",()=>{this.canvas.width=window.innerWidth/2,this.canvas.height=window.innerHeight/2,this.scene.size=[this.canvas.width,this.canvas.height],this.scene.render()})}updateCamera(){const t=new Yt(this.builtInUniforms);this.model.computeBoundingBox();const e=this.model.boundingBox;t.home(e),this.scene.render()}removeMouseEventListener(){this.mouseHandler.unbindEvents(this.canvas)}setSize(t,e){if(t<=0||e<=0){console.warn("Invalid canvas size.");return}this.scene.size=[t,e]}dispose(){console.log("Piqiu3DRenderer disposed.")}}export{pi as C,mi as G,_i as P};
